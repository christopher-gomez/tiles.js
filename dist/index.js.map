{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"THREE\"","webpack:///./node_modules/prng-parkmiller-js/pm_prng.js","webpack:///./node_modules/simplex-noise/simplex-noise.js","webpack:///./node_modules/three-orbitcontrols/OrbitControls.js","webpack:///./src/lib/grids/HexGrid.js","webpack:///./src/lib/lib/LinkedList.js","webpack:///./src/lib/lib/Signal.js","webpack:///./src/lib/utils/Loader.js","webpack:///./src/lib/utils/MouseCaster.js","webpack:///./src/lib/utils/Tools.js","webpack:///./src/lib/tm.ts","webpack:///./src/lib/grids/Cell.js","webpack:///./src/lib/grids/SqrGrid.js","webpack:///./src/lib/grids/Tile.js","webpack:///./src/lib/pathing/AStarFinder.js","webpack:///./src/lib/pathing/PathUtil.js","webpack:///./src/lib/utils/Scene.js","webpack:///./src/lib/utils/SelectionManager.js","webpack:///./src/lib/Board.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","PM_PRNG","this","seed","nextInt","gen","nextDouble","nextBoolean","nextIntRange","min","max","Math","round","nextDoubleRange","result","F2","sqrt","G2","G3","F4","G4","SimplexNoise","randomOrSeed","random","s0","s1","s2","mash","data","toString","length","h","charCodeAt","arguments","alea","buildPermutationTable","perm","Uint8Array","permMod12","aux","grad3","Float32Array","grad4","noise2D","xin","yin","i1","j1","n0","n1","n2","floor","j","x0","y0","x1","y1","x2","y2","ii","jj","t0","gi0","t1","gi1","t2","gi2","noise3D","zin","n3","k1","i2","j2","k2","k","z0","z1","z2","x3","y3","z3","kk","t3","gi3","noise4D","x","y","z","w","n4","l1","l2","i3","j3","k3","l3","w0","rankx","ranky","rankz","rankw","w1","w2","w3","x4","y4","z4","w4","ll","t4","gi4","_buildPermutationTable","THREE","OrbitControls","domElement","offset","quat","quatInverse","lastPosition","lastQuaternion","undefined","document","enabled","target","Vector3","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","position","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","changeEvent","update","state","STATE","NONE","Quaternion","setFromUnitVectors","up","inverse","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","makeSafe","radius","scale","addScaledVector","panOffset","add","setFromSpherical","lookAt","multiplyScalar","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","removeEventListener","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","window","onKeyDown","type","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","v","panLeft","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","body","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","right","left","clientWidth","top","bottom","console","warn","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","event","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","handleTouchMoveRotate","subVectors","handleTouchMovePan","handleTouchMoveDolly","preventDefault","focus","button","ctrlKey","metaKey","shiftKey","handleMouseDownDolly","addEventListener","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","stopPropagation","handleMouseWheel","needsUpdate","keyCode","handleKeyDown","handleTouchStartDollyPan","DOLLY_ROTATE","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","EventDispatcher","constructor","MapControls","default","HexGrid","config","TM","HEX","size","cellSize","cells","numCells","extrudeSettings","autogenerated","verts","push","_createVertex","cellShape","moveTo","lineTo","autoClose","cellGeo","vertices","verticesNeedUpdate","cellShapeGeo","_cellWidth","_cellLength","SQRT3","_hashDelimeter","_directions","Cell","_diagonals","_list","_vec3","_cel","_conversionVec","_geoCache","_matCache","cellToPixel","cell","q","pixelToCell","pos","TWO_THIRDS","_cubeRound","getCellAt","cellToHash","getNeighbors","diagonal","filter","getRandomCell","Tools","randomInt","cellA","cellB","abs","clearPath","_calcCost","_priority","_parent","_visited","traverse","cb","generateTile","material","height","geo","amount","tile","Tile","geometry","generateTiles","tiles","settings","tileScale","bevelEnabled","bevelSegments","steps","bevelSize","bevelThickness","merge","generate","log","generateOverlay","overlayObj","overlayMat","createPointsGeometry","line","rotation","DEG_TO_RAD","remove","load","url","self","getJSON","callback","json","fromJSON","cache","toJSON","walkable","userData","TAU","cos","sin","rx","ry","rz","xDiff","yDiff","zDiff","Node","obj","next","prev","free","LinkedList","first","last","objToNodeMap","uniqueID","Date","now","sortArray","slice","getNode","addNode","node","generateID","err","error","swapObjects","newObj","Error","showDebug","dump","has","moveUp","b","a","oldCNext","moveDown","sort","compare","clear","shift","pop","concat","list","msg","SignalBinding","signal","listener","isOnce","listenerContext","priority","_listener","context","execute","paramsArr","handlerReturn","params","active","apply","detach","isBound","_destroy","Signal","_bindings","_prevParams","validateListener","fnName","replace","_registerListener","binding","prevIndex","_indexOfListener","_addBinding","memorize","splice","cur","addOnce","removeAll","getNumListeners","halt","_shouldPropagate","dispatch","bindings","Array","forget","Loader","manager","imageLoader","crossOrigin","init","loadTexture","mapping","onLoad","onError","texture","image","evt","sourceFile","MouseCaster","group","camera","down","rightDown","pickedObject","selectedObject","allHits","ctrl","wheel","screenPosition","_camera","_raycaster","_preventDefault","_onDocumentMouseMove","_onDocumentMouseDown","_onDocumentMouseUp","_onMouseWheel","setFromCamera","hit","intersects","intersectObject","structure","point","which","innerWidth","innerHeight","delta","wheelDelta","detail","OVER","OUT","DOWN","CLICK","WHEEL","rng1","rng2","gen1","gen2","clamp","val","sign","noise1","nx","ny","noise2","normalize","getShortRotation","isPlainObject","nodeType","src","array","isArray","dst","forEach","e","indexOf","nwf","system","Performance","elapsedTime","performance","empty","lastChild","removeChild","radixSort","arr","idxBegin","idxEnd","bit","idx","idxOnes","mask","tmp","randomizeRGB","base","range","rgb","split","color","rgb_","parseInt","substring","xhr","XMLHttpRequest","uri","onreadystatechange","status","statusText","JSON","parse","responseText","open","setRequestHeader","send","VERSION","RAD_TO_DEG","equals","SqrGrid","SQR","_fullCellSize","half","ceil","objectType","TILE","entity","selected","highlight","mesh","emissive","_emissive","getHex","select","setHex","terrain","elevation","deselect","toggle","parent","setTerrain","moisture","AStarFinder","finderConfig","allowDiagonal","heuristicFilter","findPath","startNode","endNode","heuristic","grid","current","costSoFar","neighbors","PathUtil","backtrace","nodeA","nodeB","path","reverse","biBacktrace","pathA","pathB","pathLength","sum","interpolate","sx","sy","e2","expandPath","coord0","coord1","interpolated","interpolatedLen","expanded","len","smoothenPath","ex","ey","newPath","lastValidCoord","coord","testCoord","blocked","isWalkableAt","compressPath","lx","ly","ldx","ldy","sq","compressed","px","py","Scene","sceneConfig","controlConfig","sceneSettings","alpha","antialias","clearColor","sortObjects","fog","light","lightPosition","cameraType","cameraPosition","orthoZoom","controlSettings","noZoom","renderer","setClearColor","width","container","contolled","controls","aspect","setSize","attachTo","style","setPixelRatio","devicePixelRatio","appendChild","render","updateOrthoZoom","focusOn","SelectionManager","mouse","onSelect","onDeselect","toggleSelection","onMouse","fireSignal","clearSelection","Board","tileGroup","overlay","finder","setGrid","setEntityOnTile","heightOffset","addTile","snapTileToGrid","removeTile","removeAllTiles","children","getTileAtCell","snapToGrid","getRandomTile","startTile","endTile","newGrid","mat","opacity","generateTilemap","generateTerrain","ENT","STR","ABS"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","module.exports = require(\"THREE\");","/**\n * Implementation of the Park Miller (1988) \"minimal standard\" linear \n * congruential pseudo-random number generator.\n * \n * For a full explanation visit: http://www.firstpr.com.au/dsp/rand31/\n * \n * The generator uses a modulus constant (m) of 2^31 - 1 which is a\n * Mersenne Prime number and a full-period-multiplier of 16807.\n * Output is a 31 bit unsigned integer. The range of values output is\n * 1 to 2,147,483,646 (2^31-1) and the seed must be in this range too.\n * \n * David G. Carta's optimisation which needs only 32 bit integer math,\n * and no division is actually *slower* in flash (both AS2 & AS3) so\n * it's better to use the double-precision floating point version.\n * \n * @author Michael Baczynski, www.polygonal.de\n * @author Alexander Veenendaal, opendoorgonorth.com\n */\n(function (definition) {\n\n    // This file will function properly as a <script> tag, or a module\n    // using CommonJS and NodeJS or RequireJS module formats.  In\n    // Common/Node/RequireJS, the module exports the PM_PRNG API and when\n    // executed as a simple <script>, it creates a PM_PRNG global instead.\n\n    // RequireJS\n    if (typeof define === \"function\") {\n        define(definition);\n\n    // CommonJS\n    } else if (typeof exports === \"object\") {\n        definition(void 0, exports);\n\n    // <script>\n    } else {\n        definition(void 0, PM_PRNG = {});\n    }\n\n})(function (require, exports) {\n\nvar PM_PRNG = function(){\n    this.seed = 1;\n}\n\n/**\n * provides the next pseudorandom number\n * as an unsigned integer (31 bits)\n */\nPM_PRNG.prototype.nextInt = function(){\n    return this.gen();\n}\n\n/**\n * provides the next pseudorandom number\n * as a float between nearly 0 and nearly 1.0.\n */\nPM_PRNG.prototype.nextDouble = function() {\n    return (this.gen() / 2147483647);\n}\n\n/**\n * provides the next pseudorandom number\n * as a boolean\n*/\nPM_PRNG.prototype.nextBoolean = function(){\n    return (this.gen() % 2) === 0;\n}\n\n/**\n * provides the next pseudorandom number\n * as an unsigned integer (31 bits) betweeen\n * a given range.\n */\nPM_PRNG.prototype.nextIntRange = function(min, max){\n    // min -= .4999;\n    // max += .4999;\n    return Math.round(min + ((max - min) * this.nextDouble()));\n}\n\n/**\n * provides the next pseudorandom number\n * as a float between a given range.\n */\nPM_PRNG.prototype.nextDoubleRange = function(min, max){\n    return min + ((max - min) * this.nextDouble());\n}\n\nPM_PRNG.prototype.gen = function(){\n    //integer version 1, for max int 2^46 - 1 or larger.\n    return this.seed = (this.seed * 16807) % 2147483647;\n\n    /**\n     * integer version 2, for max int 2^31 - 1 (slowest)\n     */\n    // var test = 16807 * (this.seed % 127773 >> 0) - 2836 * (this.seed / 127773 >> 0);\n    // return this.seed = (test > 0 ? test : test + 2147483647);\n\n    /**\n     * david g. carta's optimisation is 15% slower than integer version 1\n     */\n    // var hi = 16807 * (this.seed >> 16);\n    // var lo = 16807 * (this.seed & 0xFFFF) + ((hi & 0x7FFF) << 16) + (hi >> 15);\n    // return this.seed = (lo > 0x7FFFFFFF ? lo - 0x7FFFFFFF : lo);\n}\n\n\nexports.create = function(seed){\n    var result = new PM_PRNG();\n    result.seed = (typeof seed === \"undefined\") ? 1 : seed;\n    return result;\n}\n\n});","/*\n * A fast javascript implementation of simplex noise by Jonas Wagner\n\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\nBetter rank ordering method by Stefan Gustavson in 2012.\n\n\n Copyright (c) 2018 Jonas Wagner\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n */\n(function() {\n  'use strict';\n\n  var F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\n  var G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\n  var F3 = 1.0 / 3.0;\n  var G3 = 1.0 / 6.0;\n  var F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\n  var G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\n\n  function SimplexNoise(randomOrSeed) {\n    var random;\n    if (typeof randomOrSeed == 'function') {\n      random = randomOrSeed;\n    }\n    else if (randomOrSeed) {\n      random = alea(randomOrSeed);\n    } else {\n      random = Math.random;\n    }\n    this.p = buildPermutationTable(random);\n    this.perm = new Uint8Array(512);\n    this.permMod12 = new Uint8Array(512);\n    for (var i = 0; i < 512; i++) {\n      this.perm[i] = this.p[i & 255];\n      this.permMod12[i] = this.perm[i] % 12;\n    }\n\n  }\n  SimplexNoise.prototype = {\n    grad3: new Float32Array([1, 1, 0,\n      -1, 1, 0,\n      1, -1, 0,\n\n      -1, -1, 0,\n      1, 0, 1,\n      -1, 0, 1,\n\n      1, 0, -1,\n      -1, 0, -1,\n      0, 1, 1,\n\n      0, -1, 1,\n      0, 1, -1,\n      0, -1, -1]),\n    grad4: new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\n      0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\n      1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\n      -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\n      1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\n      -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\n      1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\n      -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]),\n    noise2D: function(xin, yin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0 = 0; // Noise contributions from the three corners\n      var n1 = 0;\n      var n2 = 0;\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin) * F2; // Hairy factor for 2D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var t = (i + j) * G2;\n      var X0 = i - t; // Unskew the cell origin back to (x,y) space\n      var Y0 = j - t;\n      var x0 = xin - X0; // The x,y distances from the cell origin\n      var y0 = yin - Y0;\n      // For the 2D case, the simplex shape is an equilateral triangle.\n      // Determine which simplex we are in.\n      var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n      if (x0 > y0) {\n        i1 = 1;\n        j1 = 0;\n      } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n      else {\n        i1 = 0;\n        j1 = 1;\n      } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n      // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n      // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n      // c = (3-sqrt(3))/6\n      var x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n      var y1 = y0 - j1 + G2;\n      var x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n      var y2 = y0 - 1.0 + 2.0 * G2;\n      // Work out the hashed gradient indices of the three simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      // Calculate the contribution from the three corners\n      var t0 = 0.5 - x0 * x0 - y0 * y0;\n      if (t0 >= 0) {\n        var gi0 = permMod12[ii + perm[jj]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\n      }\n      var t1 = 0.5 - x1 * x1 - y1 * y1;\n      if (t1 >= 0) {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\n      }\n      var t2 = 0.5 - x2 * x2 - y2 * y2;\n      if (t2 >= 0) {\n        var gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to return values in the interval [-1,1].\n      return 70.0 * (n0 + n1 + n2);\n    },\n    // 3D simplex noise\n    noise3D: function(xin, yin, zin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0, n1, n2, n3; // Noise contributions from the four corners\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin + zin) * F3; // Very nice and simple skew factor for 3D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var k = Math.floor(zin + s);\n      var t = (i + j + k) * G3;\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var x0 = xin - X0; // The x,y,z distances from the cell origin\n      var y0 = yin - Y0;\n      var z0 = zin - Z0;\n      // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n      // Determine which simplex we are in.\n      var i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n      var i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n      if (x0 >= y0) {\n        if (y0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // X Y Z order\n        else if (x0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // X Z Y order\n        else {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // Z X Y order\n      }\n      else { // x0<y0\n        if (y0 < z0) {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Z Y X order\n        else if (x0 < z0) {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Y Z X order\n        else {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // Y X Z order\n      }\n      // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n      // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n      // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n      // c = 1/6.\n      var x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n      var y1 = y0 - j1 + G3;\n      var z1 = z0 - k1 + G3;\n      var x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\n      var y2 = y0 - j2 + 2.0 * G3;\n      var z2 = z0 - k2 + 2.0 * G3;\n      var x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\n      var y3 = y0 - 1.0 + 3.0 * G3;\n      var z3 = z0 - 1.0 + 3.0 * G3;\n      // Work out the hashed gradient indices of the four simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      // Calculate the contribution from the four corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to stay just inside [-1,1]\n      return 32.0 * (n0 + n1 + n2 + n3);\n    },\n    // 4D simplex noise, better simplex rank ordering method 2012-03-09\n    noise4D: function(x, y, z, w) {\n      var perm = this.perm;\n      var grad4 = this.grad4;\n\n      var n0, n1, n2, n3, n4; // Noise contributions from the five corners\n      // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n      var s = (x + y + z + w) * F4; // Factor for 4D skewing\n      var i = Math.floor(x + s);\n      var j = Math.floor(y + s);\n      var k = Math.floor(z + s);\n      var l = Math.floor(w + s);\n      var t = (i + j + k + l) * G4; // Factor for 4D unskewing\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var W0 = l - t;\n      var x0 = x - X0; // The x,y,z,w distances from the cell origin\n      var y0 = y - Y0;\n      var z0 = z - Z0;\n      var w0 = w - W0;\n      // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n      // To find out which of the 24 possible simplices we're in, we need to\n      // determine the magnitude ordering of x0, y0, z0 and w0.\n      // Six pair-wise comparisons are performed between each possible pair\n      // of the four coordinates, and the results are used to rank the numbers.\n      var rankx = 0;\n      var ranky = 0;\n      var rankz = 0;\n      var rankw = 0;\n      if (x0 > y0) rankx++;\n      else ranky++;\n      if (x0 > z0) rankx++;\n      else rankz++;\n      if (x0 > w0) rankx++;\n      else rankw++;\n      if (y0 > z0) ranky++;\n      else rankz++;\n      if (y0 > w0) ranky++;\n      else rankw++;\n      if (z0 > w0) rankz++;\n      else rankw++;\n      var i1, j1, k1, l1; // The integer offsets for the second simplex corner\n      var i2, j2, k2, l2; // The integer offsets for the third simplex corner\n      var i3, j3, k3, l3; // The integer offsets for the fourth simplex corner\n      // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\n      // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\n      // impossible. Only the 24 indices which have non-zero entries make any sense.\n      // We use a thresholding to set the coordinates in turn from the largest magnitude.\n      // Rank 3 denotes the largest coordinate.\n      i1 = rankx >= 3 ? 1 : 0;\n      j1 = ranky >= 3 ? 1 : 0;\n      k1 = rankz >= 3 ? 1 : 0;\n      l1 = rankw >= 3 ? 1 : 0;\n      // Rank 2 denotes the second largest coordinate.\n      i2 = rankx >= 2 ? 1 : 0;\n      j2 = ranky >= 2 ? 1 : 0;\n      k2 = rankz >= 2 ? 1 : 0;\n      l2 = rankw >= 2 ? 1 : 0;\n      // Rank 1 denotes the second smallest coordinate.\n      i3 = rankx >= 1 ? 1 : 0;\n      j3 = ranky >= 1 ? 1 : 0;\n      k3 = rankz >= 1 ? 1 : 0;\n      l3 = rankw >= 1 ? 1 : 0;\n      // The fifth corner has all coordinate offsets = 1, so no need to compute that.\n      var x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\n      var y1 = y0 - j1 + G4;\n      var z1 = z0 - k1 + G4;\n      var w1 = w0 - l1 + G4;\n      var x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\n      var y2 = y0 - j2 + 2.0 * G4;\n      var z2 = z0 - k2 + 2.0 * G4;\n      var w2 = w0 - l2 + 2.0 * G4;\n      var x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\n      var y3 = y0 - j3 + 3.0 * G4;\n      var z3 = z0 - k3 + 3.0 * G4;\n      var w3 = w0 - l3 + 3.0 * G4;\n      var x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\n      var y4 = y0 - 1.0 + 4.0 * G4;\n      var z4 = z0 - 1.0 + 4.0 * G4;\n      var w4 = w0 - 1.0 + 4.0 * G4;\n      // Work out the hashed gradient indices of the five simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      var ll = l & 255;\n      // Calculate the contribution from the five corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\n      }\n      var t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\n      if (t4 < 0) n4 = 0.0;\n      else {\n        var gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\n        t4 *= t4;\n        n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\n      }\n      // Sum up and scale the result to cover the range [-1,1]\n      return 27.0 * (n0 + n1 + n2 + n3 + n4);\n    }\n  };\n\n  function buildPermutationTable(random) {\n    var i;\n    var p = new Uint8Array(256);\n    for (i = 0; i < 256; i++) {\n      p[i] = i;\n    }\n    for (i = 0; i < 255; i++) {\n      var r = i + ~~(random() * (256 - i));\n      var aux = p[i];\n      p[i] = p[r];\n      p[r] = aux;\n    }\n    return p;\n  }\n  SimplexNoise._buildPermutationTable = buildPermutationTable;\n\n  function alea() {\n    // Johannes Baagøe <baagoe@baagoe.com>, 2010\n    var s0 = 0;\n    var s1 = 0;\n    var s2 = 0;\n    var c = 1;\n\n    var mash = masher();\n    s0 = mash(' ');\n    s1 = mash(' ');\n    s2 = mash(' ');\n\n    for (var i = 0; i < arguments.length; i++) {\n      s0 -= mash(arguments[i]);\n      if (s0 < 0) {\n        s0 += 1;\n      }\n      s1 -= mash(arguments[i]);\n      if (s1 < 0) {\n        s1 += 1;\n      }\n      s2 -= mash(arguments[i]);\n      if (s2 < 0) {\n        s2 += 1;\n      }\n    }\n    mash = null;\n    return function() {\n      var t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\n      s0 = s1;\n      s1 = s2;\n      return s2 = t - (c = t | 0);\n    };\n  }\n  function masher() {\n    var n = 0xefc8249d;\n    return function(data) {\n      data = data.toString();\n      for (var i = 0; i < data.length; i++) {\n        n += data.charCodeAt(i);\n        var h = 0.02519603282416938 * n;\n        n = h >>> 0;\n        h -= n;\n        h *= n;\n        n = h >>> 0;\n        h -= n;\n        n += h * 0x100000000; // 2^32\n      }\n      return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n    };\n  }\n\n  // amd\n  if (typeof define !== 'undefined' && define.amd) define(function() {return SimplexNoise;});\n  // common js\n  if (typeof exports !== 'undefined') exports.SimplexNoise = SimplexNoise;\n  // browser\n  else if (typeof window !== 'undefined') window.SimplexNoise = SimplexNoise;\n  // nodejs\n  if (typeof module !== 'undefined') {\n    module.exports = SimplexNoise;\n  }\n\n})();\n","/* three-orbitcontrols addendum */ var THREE = require('three');\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n * @author ScieCode / http://github.com/sciecode\n */\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nTHREE.OrbitControls = function ( object, domElement ) {\n\n\tthis.object = object;\n\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// \"target\" sets the location of focus, where the object orbits around\n\tthis.target = new THREE.Vector3();\n\n\t// How far you can dolly in and out ( PerspectiveCamera only )\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\t// How far you can zoom in and out ( OrthographicCamera only )\n\tthis.minZoom = 0;\n\tthis.maxZoom = Infinity;\n\n\t// How far you can orbit vertically, upper and lower limits.\n\t// Range is 0 to Math.PI radians.\n\tthis.minPolarAngle = 0; // radians\n\tthis.maxPolarAngle = Math.PI; // radians\n\n\t// How far you can orbit horizontally, upper and lower limits.\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n\tthis.minAzimuthAngle = - Infinity; // radians\n\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t// Set to true to enable damping (inertia)\n\t// If damping is enabled, you must call controls.update() in your animation loop\n\tthis.enableDamping = false;\n\tthis.dampingFactor = 0.05;\n\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t// Set to false to disable zooming\n\tthis.enableZoom = true;\n\tthis.zoomSpeed = 1.0;\n\n\t// Set to false to disable rotating\n\tthis.enableRotate = true;\n\tthis.rotateSpeed = 1.0;\n\n\t// Set to false to disable panning\n\tthis.enablePan = true;\n\tthis.panSpeed = 1.0;\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t// Set to true to automatically rotate around the target\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\tthis.autoRotate = false;\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n\t// Set to false to disable use of the keys\n\tthis.enableKeys = true;\n\n\t// The four arrow keys\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n\t// Mouse buttons\n\tthis.mouseButtons = { LEFT: THREE.MOUSE.ROTATE, MIDDLE: THREE.MOUSE.DOLLY, RIGHT: THREE.MOUSE.PAN };\n\n\t// Touch fingers\n\tthis.touches = { ONE: THREE.TOUCH.ROTATE, TWO: THREE.TOUCH.DOLLY_PAN };\n\n\t// for reset\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t//\n\t// public methods\n\t//\n\n\tthis.getPolarAngle = function () {\n\n\t\treturn spherical.phi;\n\n\t};\n\n\tthis.getAzimuthalAngle = function () {\n\n\t\treturn spherical.theta;\n\n\t};\n\n\tthis.saveState = function () {\n\n\t\tscope.target0.copy( scope.target );\n\t\tscope.position0.copy( scope.object.position );\n\t\tscope.zoom0 = scope.object.zoom;\n\n\t};\n\n\tthis.reset = function () {\n\n\t\tscope.target.copy( scope.target0 );\n\t\tscope.object.position.copy( scope.position0 );\n\t\tscope.object.zoom = scope.zoom0;\n\n\t\tscope.object.updateProjectionMatrix();\n\t\tscope.dispatchEvent( changeEvent );\n\n\t\tscope.update();\n\n\t\tstate = STATE.NONE;\n\n\t};\n\n\t// this method is exposed, but perhaps it would be better if we can make it private...\n\tthis.update = function () {\n\n\t\tvar offset = new THREE.Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tvar quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );\n\t\tvar quatInverse = quat.clone().inverse();\n\n\t\tvar lastPosition = new THREE.Vector3();\n\t\tvar lastQuaternion = new THREE.Quaternion();\n\n\t\treturn function update() {\n\n\t\t\tvar position = scope.object.position;\n\n\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t// angle from z-axis around y-axis\n\t\t\tspherical.setFromVector3( offset );\n\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t}\n\n\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t} else {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t}\n\n\t\t\t// restrict theta to be between desired limits\n\t\t\tspherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\n\n\t\t\t// restrict phi to be between desired limits\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\tspherical.makeSafe();\n\n\n\t\t\tspherical.radius *= scale;\n\n\t\t\t// restrict radius to be between desired limits\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t// move target to panned location\n\n\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t} else {\n\n\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t}\n\n\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t} else {\n\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t}\n\n\t\t\tscale = 1;\n\n\t\t\t// update condition is:\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\tif ( zoomChanged ||\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\tscope.dispatchEvent( changeEvent );\n\n\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\tzoomChanged = false;\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t};\n\n\t}();\n\n\tthis.dispose = function () {\n\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\n\t\tscope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\n\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\twindow.removeEventListener( 'keydown', onKeyDown, false );\n\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t};\n\n\t//\n\t// internals\n\t//\n\n\tvar scope = this;\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\tvar STATE = {\n\t\tNONE: - 1,\n\t\tROTATE: 0,\n\t\tDOLLY: 1,\n\t\tPAN: 2,\n\t\tTOUCH_ROTATE: 3,\n\t\tTOUCH_PAN: 4,\n\t\tTOUCH_DOLLY_PAN: 5,\n\t\tTOUCH_DOLLY_ROTATE: 6\n\t};\n\n\tvar state = STATE.NONE;\n\n\tvar EPS = 0.000001;\n\n\t// current position in spherical coordinates\n\tvar spherical = new THREE.Spherical();\n\tvar sphericalDelta = new THREE.Spherical();\n\n\tvar scale = 1;\n\tvar panOffset = new THREE.Vector3();\n\tvar zoomChanged = false;\n\n\tvar rotateStart = new THREE.Vector2();\n\tvar rotateEnd = new THREE.Vector2();\n\tvar rotateDelta = new THREE.Vector2();\n\n\tvar panStart = new THREE.Vector2();\n\tvar panEnd = new THREE.Vector2();\n\tvar panDelta = new THREE.Vector2();\n\n\tvar dollyStart = new THREE.Vector2();\n\tvar dollyEnd = new THREE.Vector2();\n\tvar dollyDelta = new THREE.Vector2();\n\n\tfunction getAutoRotationAngle() {\n\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t}\n\n\tfunction getZoomScale() {\n\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t}\n\n\tfunction rotateLeft( angle ) {\n\n\t\tsphericalDelta.theta -= angle;\n\n\t}\n\n\tfunction rotateUp( angle ) {\n\n\t\tsphericalDelta.phi -= angle;\n\n\t}\n\n\tvar panLeft = function () {\n\n\t\tvar v = new THREE.Vector3();\n\n\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\tv.multiplyScalar( - distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\tvar panUp = function () {\n\n\t\tvar v = new THREE.Vector3();\n\n\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t} else {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t}\n\n\t\t\tv.multiplyScalar( distance );\n\n\t\t\tpanOffset.add( v );\n\n\t\t};\n\n\t}();\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\tvar pan = function () {\n\n\t\tvar offset = new THREE.Vector3();\n\n\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t// perspective\n\t\t\t\tvar position = scope.object.position;\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\tvar targetDistance = offset.length();\n\n\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t// orthographic\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t} else {\n\n\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\tscope.enablePan = false;\n\n\t\t\t}\n\n\t\t};\n\n\t}();\n\n\tfunction dollyIn( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale /= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\tfunction dollyOut( dollyScale ) {\n\n\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\tscale *= dollyScale;\n\n\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\tfunction handleMouseDownRotate( event ) {\n\n\t\trotateStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownDolly( event ) {\n\n\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseDownPan( event ) {\n\n\t\tpanStart.set( event.clientX, event.clientY );\n\n\t}\n\n\tfunction handleMouseMoveRotate( event ) {\n\n\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMoveDolly( event ) {\n\n\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t}\n\n\t\tdollyStart.copy( dollyEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMovePan( event ) {\n\n\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\tpan( panDelta.x, panDelta.y );\n\n\t\tpanStart.copy( panEnd );\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t// no-op\n\n\t}\n\n\tfunction handleMouseWheel( event ) {\n\n\t\tif ( event.deltaY < 0 ) {\n\n\t\t\tdollyOut( getZoomScale() );\n\n\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\tdollyIn( getZoomScale() );\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleKeyDown( event ) {\n\n\t\tvar needsUpdate = false;\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase scope.keys.UP:\n\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.LEFT:\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.RIGHT:\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( needsUpdate ) {\n\n\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.update();\n\n\t\t}\n\n\n\t}\n\n\tfunction handleTouchStartRotate( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\trotateStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartPan( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartDolly( event ) {\n\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tdollyStart.set( 0, distance );\n\n\t}\n\n\tfunction handleTouchStartDollyPan( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\tif ( scope.enablePan ) handleTouchStartPan( event );\n\n\t}\n\n\tfunction handleTouchStartDollyRotate( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\tif ( scope.enableRotate ) handleTouchStartRotate( event );\n\n\t}\n\n\tfunction handleTouchMoveRotate( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\trotateEnd.set( x, y );\n\n\t\t}\n\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\trotateStart.copy( rotateEnd );\n\n\t}\n\n\tfunction handleTouchMovePan( event ) {\n\n\t\tif ( event.touches.length == 1 ) {\n\n\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\tpanEnd.set( x, y );\n\n\t\t}\n\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\tpan( panDelta.x, panDelta.y );\n\n\t\tpanStart.copy( panEnd );\n\n\t}\n\n\tfunction handleTouchMoveDolly( event ) {\n\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tdollyEnd.set( 0, distance );\n\n\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\tdollyIn( dollyDelta.y );\n\n\t\tdollyStart.copy( dollyEnd );\n\n\t}\n\n\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t}\n\n\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t}\n\n\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t// no-op\n\n\t}\n\n\t//\n\t// event handlers - FSM: listen for events and reset state\n\t//\n\n\tfunction onMouseDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\t// Prevent the browser from scrolling.\n\n\t\tevent.preventDefault();\n\n\t\t// Manually set the focus since calling preventDefault above\n\t\t// prevents the browser from setting it automatically.\n\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\n\n\t\tswitch ( event.button ) {\n\n\t\t\tcase 0:\n\n\t\t\t\tswitch ( scope.mouseButtons.LEFT ) {\n\n\t\t\t\t\tcase THREE.MOUSE.ROTATE:\n\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase THREE.MOUSE.PAN:\n\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch ( scope.mouseButtons.MIDDLE ) {\n\n\t\t\t\t\tcase THREE.MOUSE.DOLLY:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch ( scope.mouseButtons.RIGHT ) {\n\n\t\t\t\t\tcase THREE.MOUSE.ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase THREE.MOUSE.PAN:\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\n\t\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onMouseMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( state ) {\n\n\t\t\tcase STATE.ROTATE:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.DOLLY:\n\n\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction onMouseUp( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\thandleMouseUp( event );\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onMouseWheel( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t\thandleMouseWheel( event );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction onKeyDown( event ) {\n\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\n\n\t\thandleKeyDown( event );\n\n\t}\n\n\tfunction onTouchStart( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\tcase THREE.TOUCH.ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleTouchStartRotate( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase THREE.TOUCH.PAN:\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleTouchStartPan( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\tcase THREE.TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleTouchStartDollyPan( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase THREE.TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleTouchStartDollyRotate( event );\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tif ( state !== STATE.NONE ) {\n\n\t\t\tscope.dispatchEvent( startEvent );\n\n\t\t}\n\n\t}\n\n\tfunction onTouchMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( state ) {\n\n\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t}\n\n\tfunction onTouchEnd( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\thandleTouchEnd( event );\n\n\t\tscope.dispatchEvent( endEvent );\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onContextMenu( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\t//\n\n\tscope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\n\n\tscope.domElement.addEventListener( 'mousedown', onMouseDown, false );\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\n\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\n\n\twindow.addEventListener( 'keydown', onKeyDown, false );\n\n\t// force an update at start\n\n\tthis.update();\n\n};\n\nTHREE.OrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );\nTHREE.OrbitControls.prototype.constructor = THREE.OrbitControls;\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nTHREE.MapControls = function ( object, domElement ) {\n\n\tTHREE.OrbitControls.call( this, object, domElement );\n\n\tthis.mouseButtons.LEFT = THREE.MOUSE.PAN;\n\tthis.mouseButtons.RIGHT = THREE.MOUSE.ROTATE;\n\n\tthis.touches.ONE = THREE.TOUCH.PAN;\n\tthis.touches.TWO = THREE.TOUCH.DOLLY_ROTATE;\n\n};\n\nTHREE.MapControls.prototype = Object.create( THREE.EventDispatcher.prototype );\nTHREE.MapControls.prototype.constructor = THREE.MapControls;\n/* three-orbitcontrols addendum */ module.exports = exports.default = THREE.OrbitControls;\n","import TM from '../tm';\nimport * as THREE from 'three';\n/*\n\tGraph of hexagons. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\t[Cube/axial coordinate system](http://www.redblobgames.com/grids/hexagons/), \"flat top\" version only. Since this is 3D, just rotate your camera for pointy top maps.\n\tInterface:\n\ttype\n\tsize - number of cells (in radius); only used if the map is generated\n\tcellSize\n\tcells - a hash so we can have sparse maps\n\tnumCells\n\textrudeSettings\n\tautogenerated\n\tcellShape\n\tcellGeo\n\tcellShapeGeo\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\n// 'utils/Loader', 'graphs/Hex', 'utils/Tools'\nexport default class HexGrid {\n\n  constructor(config) {\n    config = config || {};\n    /*  ______________________________________________\n      GRID INTERFACE:\n    */\n    this.type = TM.HEX;\n    this.size = 5; // only used for generated maps\n    this.cellSize = typeof config.cellSize === 'undefined' ? 10 : config.cellSize;\n    this.cells = {};\n    this.numCells = 0;\n\n    this.extrudeSettings = null;\n    this.autogenerated = false;\n\n    // create base shape used for building geometry\n    var i, verts = [];\n    // create the skeleton of the hex\n    for (i = 0; i < 6; i++) {\n      verts.push(this._createVertex(i));\n    }\n    // copy the verts into a shape for the geometry to use\n    this.cellShape = new THREE.Shape();\n    this.cellShape.moveTo(verts[0].x, verts[0].y);\n    for (i = 1; i < 6; i++) {\n      this.cellShape.lineTo(verts[i].x, verts[i].y);\n    }\n    this.cellShape.lineTo(verts[0].x, verts[0].y);\n    this.cellShape.autoClose = true;\n\n    this.cellGeo = new THREE.BufferGeometry();\n    this.cellGeo.vertices = verts;\n    this.cellGeo.verticesNeedUpdate = true;\n\n    this.cellShapeGeo = new THREE.ShapeGeometry(this.cellShape);\n\n    /*  ______________________________________________\n      PRIVATE\n    */\n\n    this._cellWidth = this.cellSize * 2;\n    this._cellLength = (TM.SQRT3 * 0.5) * this._cellWidth;\n    this._hashDelimeter = '.';\n    // pre-computed permutations\n    this._directions = [new TM.Cell(+1, -1, 0), new TM.Cell(+1, 0, -1), new TM.Cell(0, +1, -1),\n    new TM.Cell(-1, +1, 0), new TM.Cell(-1, 0, +1), new TM.Cell(0, -1, +1)];\n    this._diagonals = [new TM.Cell(+2, -1, -1), new TM.Cell(+1, +1, -2), new TM.Cell(-1, +2, -1),\n    new TM.Cell(-2, +1, +1), new TM.Cell(-1, -1, +2), new TM.Cell(+1, -2, +1)];\n    // cached objects\n    this._list = [];\n    this._vec3 = new THREE.Vector3();\n    this._cel = new TM.Cell();\n    this._conversionVec = new THREE.Vector3();\n    this._geoCache = [];\n    this._matCache = [];\n  }\n  /*  ________________________________________________________________________\n\t\tHigh-level functions that the Board interfaces with (all grids implement)\n\t */\n\n  // grid cell (Hex in cube coordinate space) to position in pixels/world\n  cellToPixel(cell) {\n    this._vec3.x = cell.q * this._cellWidth * 0.75;\n    this._vec3.y = cell.h;\n    this._vec3.z = -((cell.s - cell.r) * this._cellLength * 0.5);\n    return this._vec3;\n  }\n\n  pixelToCell(pos) {\n    // convert a position in world space (\"pixels\") to cell coordinates\n    var q = pos.x * (HexGrid.TWO_THIRDS / this.cellSize);\n    var r = ((-pos.x / 3) + (TM.SQRT3 / 3) * pos.z) / this.cellSize;\n    this._cel.set(q, r, -q - r);\n    return this._cubeRound(this._cel);\n  }\n\n  getCellAt(pos) {\n    // get the Cell (if any) at the passed world position\n    var q = pos.x * (HexGrid.TWO_THIRDS / this.cellSize);\n    var r = ((-pos.x / 3) + (TM.SQRT3 / 3) * pos.z) / this.cellSize;\n    this._cel.set(q, r, -q - r);\n    this._cubeRound(this._cel);\n    return this.cells[this.cellToHash(this._cel)];\n  }\n\n  getNeighbors(cell, diagonal, filter) {\n    // always returns an array\n    var i, n, l = this._directions.length;\n    this._list.length = 0;\n    for (i = 0; i < l; i++) {\n      this._cel.copy(cell);\n      this._cel.add(this._directions[i]);\n      n = this.cells[this.cellToHash(this._cel)];\n      if (!n || (filter && !filter(cell, n))) {\n        continue;\n      }\n      this._list.push(n);\n    }\n    if (diagonal) {\n      for (i = 0; i < l; i++) {\n        this._cel.copy(cell);\n        this._cel.add(this._diagonals[i]);\n        n = this.cells[this.cellToHash(this._cel)];\n        if (!n || (filter && !filter(cell, n))) {\n          continue;\n        }\n        this._list.push(n);\n      }\n    }\n    return this._list;\n  }\n\n  getRandomCell() {\n    var c, i = 0, x = TM.Tools.randomInt(0, this.numCells);\n    for (c in this.cells) {\n      if (i === x) {\n        return this.cells[c];\n      }\n      i++;\n    }\n    return this.cells[c];\n  }\n\n  cellToHash(cell) {\n    return cell.q + this._hashDelimeter + cell.r + this._hashDelimeter + cell.s;\n  }\n\n  distance(cellA, cellB) {\n    var d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r), Math.abs(cellA.s - cellB.s));\n    d += cellB.h - cellA.h; // include vertical height\n    return d;\n  }\n\n  clearPath() {\n    var i, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      c._calcCost = 0;\n      c._priority = 0;\n      c._parent = null;\n      c._visited = false;\n    }\n  }\n\n  traverse(cb) {\n    var i;\n    for (i in this.cells) {\n      cb(this.cells[i]);\n    }\n  }\n\n  generateTile(cell, scale, material) {\n    var height = Math.abs(cell.h);\n    if (height < 1) height = 1;\n\n    var geo = this._geoCache[height];\n    if (!geo) {\n      this.extrudeSettings.amount = height;\n      geo = new THREE.ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n      this._geoCache[height] = geo;\n    }\n\n\t\t/*mat = this._matCache[c.matConfig.mat_cache_id];\n\t\tif (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n\t\t\tmat.map = Loader.loadTexture(c.matConfig.imgURL);\n\t\t\tdelete c.matConfig.imgURL;\n\t\t\tmat = new THREE[c.matConfig.type](c.matConfig);\n\t\t\tthis._matCache[c.matConfig.mat_cache_id] = mat;\n\t\t}*/\n\n    var tile = new TM.Tile({\n      size: this.cellSize,\n      scale: scale,\n      cell: cell,\n      geometry: geo,\n      material: material\n    });\n\n    cell.tile = tile;\n\n    return tile;\n  }\n\n  generateTiles(config) {\n    config = config || {};\n    var tiles = [];\n    var settings = {\n      tileScale: 0.95,\n      cellSize: this.cellSize,\n      material: null,\n      extrudeSettings: {\n        amount: 10,\n        bevelEnabled: true,\n        bevelSegments: 1,\n        steps: 1,\n        bevelSize: 0.5,\n        bevelThickness: 0.5\n      }\n    }\n    settings = TM.Tools.merge(settings, config);\n\n\t\t/*if (!settings.material) {\n\t\t\tsettings.material = new THREE.MeshPhongMaterial({\n\t\t\t\tcolor: TM.Tools.randomizeRGB('30, 30, 30', 10)\n\t\t\t});\n\t\t}*/\n\n    // overwrite with any new dimensions\n    this.cellSize = settings.cellSize;\n    this._cellWidth = this.cellSize * 2;\n    this._cellLength = (TM.SQRT3 * 0.5) * this._cellWidth;\n\n    this.autogenerated = true;\n    this.extrudeSettings = settings.extrudeSettings;\n\n    var i, t, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      t = this.generateTile(c, settings.tileScale, settings.material);\n      t.position.copy(this.cellToPixel(c));\n      t.position.y = 0;\n      tiles.push(t);\n    }\n    return tiles;\n  }\n\n  // create a flat, hexagon-shaped grid\n  generate(config) {\n    config = config || {};\n    this.size = typeof config.size === 'undefined' ? this.size : config.size;\n    var x, y, z, c;\n    for (x = -this.size; x < this.size + 1; x++) {\n      for (y = -this.size; y < this.size + 1; y++) {\n        z = -x - y;\n        if (Math.abs(x) <= this.size && Math.abs(y) <= this.size && Math.abs(z) <= this.size) {\n          console.log(x+\",\"+y+\",\"+z);\n          c = new TM.Cell(x, y, z);\n          this.add(c);\n        }\n      }\n    }\n  }\n\n  generateOverlay(size, overlayObj, overlayMat) {\n    var x, y, z;\n    var geo = this.cellShape.createPointsGeometry();\n    for (x = -size; x < size + 1; x++) {\n      for (y = -size; y < size + 1; y++) {\n        z = -x - y;\n        if (Math.abs(x) <= size && Math.abs(y) <= size && Math.abs(z) <= size) {\n          this._cel.set(x, y, z); // define the cell\n          var line = new THREE.Line(geo, overlayMat);\n          line.position.copy(this.cellToPixel(this._cel));\n          line.rotation.x = 90 * TM.DEG_TO_RAD;\n          overlayObj.add(line);\n        }\n      }\n    }\n    overlayObj.position.y = .5;\n  }\n\n  add(cell) {\n    var h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      // console.warn('A cell already exists there');\n      return;\n    }\n    this.cells[h] = cell;\n    this.numCells++;\n\n    return cell;\n  }\n\n  remove(cell) {\n    var h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      delete this.cells[h];\n      this.numCells--;\n    }\n  }\n\n  dispose() {\n    this.cells = null;\n    this.numCells = 0;\n    this.cellShape = null;\n    this.cellGeo.dispose();\n    this.cellGeo = null;\n    this.cellShapeGeo.dispose();\n    this.cellShapeGeo = null;\n    this._list = null;\n    this._vec3 = null;\n    this._conversionVec = null;\n    this._geoCache = null;\n    this._matCache = null;\n  }\n\n\t/*\n\t\tLoad a grid from a parsed json object.\n\t\tjson = {\n\t\t\textrudeSettings,\n\t\t\tsize,\n\t\t\tcellSize,\n\t\t\tautogenerated,\n\t\t\tcells: [],\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\tcache_id: 0,\n\t\t\t\t\ttype: 'MeshLambertMaterial',\n\t\t\t\t\tcolor, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n\t\t\t\t\timgURL: url\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tcacheId: 1, ...\n\t\t\t\t}\n\t\t\t\t...\n\t\t\t]\n\t\t}\n\t*/\n  load(url, cb, scope) {\n    var self = this;\n    TM.Tools.getJSON({\n      url: url,\n      callback: function (json) {\n        self.fromJSON(json);\n        cb.call(scope || null, json);\n      },\n      cache: false,\n      scope: self\n    });\n  }\n\n  fromJSON(json) {\n    var i, c;\n    var cells = json.cells;\n\n    this.cells = {};\n    this.numCells = 0;\n\n    this.size = json.size;\n    this.cellSize = json.cellSize;\n    this._cellWidth = this.cellSize * 2;\n    this._cellLength = (TM.SQRT3 * 0.5) * this._cellWidth;\n\n    this.extrudeSettings = json.extrudeSettings;\n    this.autogenerated = json.autogenerated;\n\n    for (i = 0; i < cells.length; i++) {\n      c = new TM.Cell();\n      c.copy(cells[i]);\n      this.add(c);\n    }\n  }\n\n  toJSON() {\n    var json = {\n      size: this.size,\n      cellSize: this.cellSize,\n      extrudeSettings: this.extrudeSettings,\n      autogenerated: this.autogenerated\n    };\n    var cells = [];\n    var c, k;\n\n    for (k in this.cells) {\n      c = this.cells[k];\n      cells.push({\n        q: c.q,\n        r: c.r,\n        s: c.s,\n        h: c.h,\n        walkable: c.walkable,\n        userData: c.userData\n      });\n    }\n    json.cells = cells;\n\n    return json;\n  }\n\n\t/*  ________________________________________________________________________\n\t\tHexagon-specific conversion math\n\t\tMostly commented out because they're inlined whenever possible to increase performance.\n\t\tThey're still here for reference.\n\t */\n\n  _createVertex(i) {\n    var angle = (TM.TAU / 6) * i;\n    return new THREE.Vector3((this.cellSize * Math.cos(angle)), (this.cellSize * Math.sin(angle)), 0);\n  }\n\n\t/*_pixelToAxial: function(pos) {\n\t\tvar q, r; // = x, y\n\t\tq = pos.x * ((2/3) / this.cellSize);\n\t\tr = ((-pos.x / 3) + (TM.SQRT3/3) * pos.y) / this.cellSize;\n\t\tthis._cel.set(q, r, -q-r);\n\t\treturn this._cubeRound(this._cel);\n\t}*/\n\n\t/*_axialToCube: function(h) {\n\t\treturn {\n\t\t\tq: h.q,\n\t\t\tr: h.r,\n\t\t\ts: -h.q - h.r\n\t\t};\n\t}*/\n\n\t/*_cubeToAxial: function(cell) {\n\t\treturn cell; // yep\n\t}*/\n\n\t/*_axialToPixel: function(cell) {\n\t\tvar x, y; // = q, r\n\t\tx = cell.q * this._cellWidth * 0.75;\n\t\ty = (cell.s - cell.r) * this._cellLength * 0.5;\n\t\treturn {x: x, y: -y};\n\t}*/\n\n\t/*_hexToPixel: function(h) {\n\t\tvar x, y; // = q, r\n\t\tx = this.cellSize * 1.5 * h.x;\n\t\ty = this.cellSize * TM.SQRT3 * (h.y + (h.x * 0.5));\n\t\treturn {x: x, y: y};\n\t}*/\n\n\t/*_axialRound: function(h) {\n\t\treturn this._cubeRound(this.axialToCube(h));\n\t}*/\n\n  _cubeRound(h) {\n    var rx = Math.round(h.q);\n    var ry = Math.round(h.r);\n    var rz = Math.round(h.s);\n\n    var xDiff = Math.abs(rx - h.q);\n    var yDiff = Math.abs(ry - h.r);\n    var zDiff = Math.abs(rz - h.s);\n\n    if (xDiff > yDiff && xDiff > zDiff) {\n      rx = -ry - rz;\n    }\n    else if (yDiff > zDiff) {\n      ry = -rx - rz;\n    }\n    else {\n      rz = -rx - ry;\n    }\n\n    return this._cel.set(rx, ry, rz);\n  }\n\n\t/*_cubeDistance: function(a, b) {\n\t\treturn Math.max(Math.abs(a.q - b.q), Math.abs(a.r - b.r), Math.abs(a.s - b.s));\n\t}*/\n}\n\nHexGrid.TWO_THIRDS = 2 / 3;","/*\n\tA high-speed doubly-linked list of objects. Note that for speed reasons (using a dictionary lookup of\n\tcached nodes) there can only be a single instance of an object in the list at the same time. Adding the same\n\tobject a second time will result in a silent return from the add method.\n\n\tIn order to keep a track of node links, an object must be able to identify itself with a uniqueID function.\n\n\tTo add an item use:\n\t<pre><code>\n\t\tlist.add(newItem);\n\t</code></pre>\n\t<p>\n\tYou can iterate using the first and next members, such as:\n\t<pre><code>\n\t\tvar node = list.first;\n\t\twhile (node)\n\t\t{\n\t\t\tnode.object().DOSOMETHING();\n\t\t\tnode = node.next();\n\t\t}\n\t</code></pre>\n */\n\nclass Node {\n  constructor() {\n    this.obj = null;\n    this.next = null;\n    this.prev = null;\n    this.free = true;\n  }\n}\n\nexport default class LinkedList {\n  constructor() {\n    this.first = null;\n    this.last = null;\n    this.length = 0;\n    this.objToNodeMap = {}; // a quick lookup list to map linked list nodes to objects\n    this.uniqueID = Date.now() + '' + Math.floor(Math.random() * 1000);\n\n    this.sortArray = [];\n  }\n\n  // static function for utility\n  static generateID(obj) {\n    return Math.random().toString(36).slice(2) + Date.now();\n  }\n\n  /*\n\t\t\tGet the LinkedListNode for this object.\n\t\t\t@param obj The object to get the node for\n\t\t */\n  getNode(obj) {\n    // objects added to a list must implement a uniqueID which returns a unique object identifier string\n    return this.objToNodeMap[obj.uniqueID];\n  }\n\n  /*\n    Adds a new node to the list -- typically only used internally unless you're doing something funky\n    Use add() to add an object to the list, not this.\n   */\n  addNode(obj) {\n    var node = new Node();\n    if (!obj.uniqueID) {\n      try {\n        obj.uniqueID = LinkedList.generateID();\n        // console.log('New ID: '+obj.uniqueID);\n      }\n      catch (err) {\n        console.error('[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier');\n        return null;\n      }\n    }\n\n    node.obj = obj;\n    node.free = false;\n    this.objToNodeMap[obj.uniqueID] = node;\n    return node;\n  }\n\n  swapObjects(node, newObj) {\n    this.objToNodeMap[node.obj.uniqueID] = null;\n    this.objToNodeMap[newObj.uniqueID] = node;\n    node.obj = newObj;\n  }\n\n  /*\n    Add an item to the list\n    @param obj The object to add\n   */\n  add(obj) {\n    var node = this.objToNodeMap[obj.uniqueID];\n\n    if (!node) {\n      node = this.addNode(obj);\n    }\n    else {\n      if (node.free === false) return;\n\n      // reusing a node, so we clean it up\n      // this caching of node/object pairs is the reason an object can only exist\n      // once in a list -- which also makes things faster (not always creating new node\n      // object every time objects are moving on and off the list\n      node.obj = obj;\n      node.free = false;\n      node.next = null;\n      node.prev = null;\n    }\n\n    // append this obj to the end of the list\n    if (!this.first) { // is this the first?\n      this.first = node;\n      this.last = node;\n      node.next = null; // clear just in case\n      node.prev = null;\n    }\n    else {\n      if (!this.last) {\n        throw new Error(\"[LinkedList.add] No last in the list -- that shouldn't happen here\");\n      }\n\n      // add this entry to the end of the list\n      this.last.next = node; // current end of list points to the new end\n      node.prev = this.last;\n      this.last = node;            // new object to add becomes last in the list\n      node.next = null;      // just in case this was previously set\n    }\n    this.length++;\n\n    if (this.showDebug) this.dump('after add');\n  }\n\n  has(obj) {\n    return !!this.objToNodeMap[obj.uniqueID];\n  }\n\n  /*\n    Moves this item upwards in the list\n    @param obj\n   */\n  moveUp(obj) {\n    this.dump('before move up');\n    var c = this.getNode(obj);\n    if (!c) throw \"Oops, trying to move an object that isn't in the list\";\n    if (!c.prev) return; // already first, ignore\n\n    // This operation makes C swap places with B:\n    // A <-> B <-> C <-> D\n    // A <-> C <-> B <-> D\n\n    var b = c.prev;\n    var a = b.prev;\n\n    // fix last\n    if (c == this.last) this.last = b;\n\n    var oldCNext = c.next;\n\n    if (a) a.next = c;\n    c.next = b;\n    c.prev = b.prev;\n\n    b.next = oldCNext;\n    b.prev = c;\n\n    // check to see if we are now first\n    if (this.first == b) this.first = c;\n  }\n\n  /*\n    Moves this item downwards in the list\n    @param obj\n   */\n  moveDown(obj) {\n    var b = this.getNode(obj);\n    if (!b) throw \"Oops, trying to move an object that isn't in the list\";\n    if (!b.next) return; // already last, ignore\n\n    // This operation makes B swap places with C:\n    // A <-> B <-> C <-> D\n    // A <-> C <-> B <-> D\n\n    var c = b.next;\n    this.moveUp(c.obj);\n\n    // check to see if we are now last\n    if (this.last == c) this.last = b;\n  }\n\n  /*\n    Take everything off the list and put it in an array, sort it, then put it back.\n   */\n  sort(compare) {\n    var sortArray = this.sortArray;\n    var i, l, node = this.first;\n    sortArray.length = 0;\n\n    while (node) {\n      sortArray.push(node.obj);\n      node = node.next;\n    }\n\n    this.clear();\n\n    sortArray.sort(compare);\n    // console.log(sortArray);\n    l = sortArray.length;\n    for (i = 0; i < l; i++) {\n      this.add(sortArray[i]);\n    }\n  }\n\n  /*\n    Removes an item from the list\n    @param obj The object to remove\n    @returns boolean true if the item was removed, false if the item was not on the list\n   */\n  remove(obj) {\n    var node = this.getNode(obj);\n    if (!node || node.free) {\n      return false; // ignore this error (trying to remove something not there)\n    }\n\n    // pull this object out and tie up the ends\n    if (node.prev) node.prev.next = node.next;\n    if (node.next) node.next.prev = node.prev;\n\n    // fix first and last\n    if (!node.prev) // if this was first on the list\n      this.first = node.next; // make the next on the list first (can be null)\n    if (!node.next) // if this was the last\n      this.last = node.prev; // then this node's previous becomes last\n\n    node.free = true;\n    node.prev = null;\n    node.next = null;\n\n    this.length--;\n\n    return true;\n  }\n\n  // remove the head and return it's object\n  shift() {\n    var node = this.first;\n    if (this.length === 0) return null;\n    // if (node == null || node.free == true) return null;\n\n    // pull this object out and tie up the ends\n    if (node.prev) {\n      node.prev.next = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    }\n\n    // make the next on the list first (can be null)\n    this.first = node.next;\n    if (!node.next) this.last = null; // make sure we clear this\n\n    node.free = true;\n    node.prev = null;\n    node.next = null;\n\n    this.length--;\n    return node.obj;\n  }\n\n  // remove the tail and return it's object\n  pop() {\n    var node = this.last;\n    if (this.length === 0) return null;\n\n    // pull this object out and tie up the ends\n    if (node.prev) {\n      node.prev.next = node.next;\n    }\n    if (node.next) {\n      node.next.prev = node.prev;\n    }\n\n    // this node's previous becomes last\n    this.last = node.prev;\n    if (!node.prev) this.first = null; // make sure we clear this\n\n    node.free = true;\n    node.prev = null;\n    node.next = null;\n\n    this.length--;\n    return node.obj;\n  }\n\n  /**\n   * Add the passed list to this list, leaving it untouched.\n   */\n  concat(list) {\n    var node = list.first;\n    while (node) {\n      this.add(node.obj);\n      node = node.next;\n    }\n  }\n\n  /**\n   * Clears the list out\n   */\n  clear() {\n    var next = this.first;\n\n    while (next) {\n      next.free = true;\n      next = next.next;\n    }\n\n    this.first = null;\n    this.length = 0;\n  }\n\n  dispose() {\n    var next = this.first;\n\n    while (next) {\n      next.obj = null;\n      next = next.next;\n    }\n    this.first = null;\n\n    this.objToNodeMap = null;\n  }\n\n  /*\n    Outputs the contents of the current list for debugging.\n   */\n  dump(msg) {\n    console.log('====================' + msg + '=====================');\n    var a = this.first;\n    while (a) {\n      console.log(\"{\" + a.obj.toString() + \"} previous=\" + (a.prev ? a.prev.obj : \"NULL\"));\n      a = a.next();\n    }\n    console.log(\"===================================\");\n    console.log(\"Last: {\" + (this.last ? this.last.obj : 'NULL') + \"} \" +\n      \"First: {\" + (this.first ? this.first.obj : 'NULL') + \"}\");\n  }\n}","class SignalBinding {\n  constructor(signal, listener, isOnce, listenerContext, priority) {\n    /**\n    * @property _listener - Handle bound to the signal.\n    * @private\n    */\n    this._listener = listener;\n\n    /**\n    * @property {boolean} isOnce - If binding should be executed just once.\n    * @private\n    */\n    this.isOnce = isOnce;\n\n    /**\n    * @property {object|undefined|null} context - Context on which listener will be executed (object that should represent the `this` variable inside listene).\n    */\n    this.context = listenerContext;\n\n    /**\n    * @property {Signal} signal - Reference to Signal object that listener is currently bound to.\n    * @private\n    */\n    this.signal = signal;\n\n    /**\n    * @property {number} _priority - Listener priority.\n    * @private\n    */\n    this._priority = priority || 0;\n  }\n  /**\n  * Call listener passing arbitrary parameters.\n  * If binding was added using `Signal.addOnce()` it will be automatically removed from signal dispatch queue, this method is used internally for the signal dispatch.\n  * @method SignalBinding#execute\n  * @param {array} [paramsArr] - Array of parameters that should be passed to the listener.\n  * @return {any} Value returned by the listener.\n  */\n  execute(paramsArr) {\n\n    var handlerReturn, params;\n\n    if (SignalBinding.active && !!this._listener) {\n      params = this.params ? this.params.concat(paramsArr) : paramsArr;\n      handlerReturn = this._listener.apply(this.context, params);\n\n      if (this.isOnce) {\n        this.detach();\n      }\n    }\n\n    return handlerReturn;\n\n  }\n\n  /**\n  * Detach binding from signal.\n  * alias to: @see mySignal.remove(myBinding.listener);\n  * @method SignalBinding#detach\n  * @return|null} Handle bound to the signal or `null` if binding was previously detached.\n  */\n  detach() {\n    return this.isBound() ? this.signal.remove(this._listener, this.context) : null;\n  }\n\n  /**\n  * @method SignalBinding#isBound\n  * @return {boolean} True if binding is still bound to the signal and has a listener.\n  */\n  isBound() {\n    return (!!this.signal && !!this._listener);\n  }\n\n  /**\n  * Delete instance properties\n  * @method SignalBinding#_destroy\n  * @private\n  */\n  _destroy() {\n    delete this.signal;\n    delete this._listener;\n    delete this.context;\n  }\n\n  /**\n  * @method SignalBinding#toString\n  * @return {string} String representation of the object.\n  */\n  toString() {\n    return '[SignalBinding isOnce:' + this.isOnce + ', isBound:' + this.isBound() + ', active:' + SignalBinding.active + ']';\n  }\n}\n\n/**\n      * If binding is active and should be executed.\n      * @property {boolean} active\n      * @default\n      */\nSignalBinding.active = true;\n\n/**\n* Default parameters passed to listener during `Signal.dispatch` and `SignalBinding.execute` (curried parameters).\n* @property {array|null} params\n* @default\n*/\nSignalBinding.params = null;\n\n/**\n    * @author       Miller Medeiros http://millermedeiros.github.com/js-signals/\n    * @author       Richard Davey <rich@photonstorm.com>\n    * @copyright    2014 Photon Storm Ltd.\n    * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\n    */\n\n/**\n* A Signal is used for object communication via a custom broadcaster instead of Events.\n*\n* @class Signal\n* @constructor\n*/\nexport default class Signal {\n  constructor() {\n    /**\n        * @property {Array.<SignalBinding>} _bindings - Internal variable.\n        * @private\n        */\n    this._bindings = [];\n\n    /**\n    * @property {any} _prevParams - Internal variable.\n    * @private\n    */\n    this._prevParams = null;\n\n    /*\n    // enforce dispatch to aways work on same context (#47)\n    var self = this;\n\n    /**\n    * @property } dispatch - The dispatch is what sends the Signal out.\n    //*\n    this.dispatch = () => {\n      this.prototype.dispatch.apply(self, arguments);\n    };*/\n  }\n  /**\n  * @method Signal#validateListener\n  * @param } listener - Signal handler.\n  * @param {string} fnName - name.\n  * @private\n  */\n  validateListener(listener, fnName) {\n    if (typeof listener !== 'function') {\n      throw new Error('Signal: listener is a required param of {fn}() and should be a.'.replace('{fn}', fnName));\n    }\n  }\n\n  /**\n  * @method Signal#_registerListener\n  * @private\n  * @param } listener - Signal handler.\n  * @param {boolean} isOnce - Should the listener only be called once?\n  * @param {object} [listenerContext] - The context under which the listener is invoked.\n  * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0).\n  * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n  */\n  _registerListener(listener, isOnce, listenerContext, priority) {\n    var prevIndex = this._indexOfListener(listener, listenerContext);\n    var binding;\n\n    if (prevIndex !== -1) {\n      binding = this._bindings[prevIndex];\n\n      if (binding.isOnce !== isOnce) {\n        throw new Error('You cannot add' + (isOnce ? '' : 'Once') + '() then add' + (!isOnce ? '' : 'Once') + '() the same listener without removing the relationship first.');\n      }\n    }\n    else {\n      binding = new SignalBinding(this, listener, isOnce, listenerContext, priority);\n      this._addBinding(binding);\n    }\n\n    if (Signal.memorize && this._prevParams) {\n      binding.execute(this._prevParams);\n    }\n\n    return binding;\n  }\n\n  /**\n  * @method Signal#_addBinding\n  * @private\n  * @param {SignalBinding} binding - An Object representing the binding between the Signal and listener.\n  */\n  _addBinding(binding) {\n    //  Simplified insertion sort\n    var n = this._bindings.length;\n\n    do {\n      n--;\n    }\n    while (this._bindings[n] && binding._priority <= this._bindings[n]._priority);\n\n    this._bindings.splice(n + 1, 0, binding);\n  }\n\n  /**\n  * @method Signal#_indexOfListener\n  * @private\n  * @param } listener - Signal handler.\n  * @return {number} The index of the listener within the private bindings array.\n  */\n  _indexOfListener(listener, context) {\n    var n = this._bindings.length;\n    var cur;\n\n    while (n--) {\n      cur = this._bindings[n];\n\n      if (cur._listener === listener && cur.context === context) {\n        return n;\n      }\n    }\n\n    return -1;\n  }\n\n  /**\n  * Check if listener was attached to Signal.\n  *\n  * @method Signal#has\n  * @param } listener - Signal handler.\n  * @param {object} [context] - Context on which listener will be executed (object that should represent the `this` variable inside listener).\n  * @return {boolean} If Signal has the specified listener.\n  */\n  has(listener, context) {\n    return this._indexOfListener(listener, context) !== -1;\n  }\n\n  /**\n  * Add a listener to the signal.\n  *\n  * @method Signal#add\n  * @param } listener - The to call when this Signal is dispatched.\n  * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n  * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n  * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n  */\n  add(listener, listenerContext, priority) {\n    this.validateListener(listener, 'add');\n\n    return this._registerListener(listener, false, listenerContext, priority);\n  }\n\n  /**\n  * Add listener to the signal that should be removed after first execution (will be executed only once).\n  *\n  * @method Signal#addOnce\n  * @param } listener - The to call when this Signal is dispatched.\n  * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n  * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n  * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n  */\n  addOnce(listener, listenerContext, priority) {\n    this.validateListener(listener, 'addOnce');\n\n    return this._registerListener(listener, true, listenerContext, priority);\n  }\n\n  /**\n  * Remove a single listener from the dispatch queue.\n  *\n  * @method Signal#remove\n  * @param } listener - Handler that should be removed.\n  * @param {object} [context] - Execution context (since you can add the same handler multiple times if executing in a different context).\n  * @return } Listener handler.\n  */\n  remove(listener, context) {\n    this.validateListener(listener, 'remove');\n\n    var i = this._indexOfListener(listener, context);\n\n    if (i !== -1) {\n      this._bindings[i]._destroy(); //no reason to a SignalBinding exist if it isn't attached to a signal\n      this._bindings.splice(i, 1);\n    }\n\n    return listener;\n  }\n\n  /**\n  * Remove all listeners from the Signal.\n  *\n  * @method Signal#removeAll\n  * @param {object} [context=null] - If specified only listeners for the given context will be removed.\n  */\n  removeAll(context) {\n    if (typeof context === 'undefined') { context = null; }\n\n    var n = this._bindings.length;\n\n    while (n--) {\n      if (context) {\n        if (this._bindings[n].context === context) {\n          this._bindings[n]._destroy();\n          this._bindings.splice(n, 1);\n        }\n      }\n      else {\n        this._bindings[n]._destroy();\n      }\n    }\n\n    if (!context) {\n      this._bindings.length = 0;\n    }\n  }\n\n  /**\n  * Gets the total number of listeneres attached to ths Signal.\n  *\n  * @method Signal#getNumListeners\n  * @return {number} Number of listeners attached to the Signal.\n  */\n  getNumListeners() {\n    return this._bindings.length;\n  }\n\n  /**\n  * Stop propagation of the event, blocking the dispatch to next listeners on the queue.\n  * IMPORTANT: should be called only during signal dispatch, calling it before/after dispatch won't affect signal broadcast.\n  * @see Signal.prototype.disable\n  *\n  * @method Signal#halt\n  */\n  halt() {\n    Signal._shouldPropagate = false;\n  }\n\n  /**\n  * Dispatch/Broadcast Signal to all listeners added to the queue.\n  *\n  * @method Signal#dispatch\n  * @param {any} [params] - Parameters that should be passed to each handler.\n  */\n  dispatch() {\n    if (!Signal.active) {\n      return;\n    }\n\n    var paramsArr = Array.prototype.slice.call(arguments);\n    var n = this._bindings.length;\n    var bindings;\n\n    if (Signal.memorize) {\n      this._prevParams = paramsArr;\n    }\n\n    if (!n) {\n      //  Should come after memorize\n      return;\n    }\n\n    bindings = this._bindings.slice(); //clone array in case add/remove items during dispatch\n    Signal._shouldPropagate = true; //in case `halt` was called before dispatch or during the previous dispatch.\n\n    //execute all callbacks until end of the list or until a callback returns `false` or stops propagation\n    //reverse loop since listeners with higher priority will be added at the end of the list\n    do {\n      n--;\n    }\n    while (bindings[n] && Signal._shouldPropagate && bindings[n].execute(paramsArr) !== false);\n  }\n\n  /**\n  * Forget memorized arguments.\n  * @see Signal.memorize\n  *\n  * @method Signal#forget\n  */\n  forget() {\n    this._prevParams = null;\n  }\n\n  /**\n  * Remove all bindings from signal and destroy any reference to external objects (destroy Signal object).\n  * IMPORTANT: calling any method on the signal instance after calling dispose will throw errors.\n  *\n  * @method Signal#dispose\n  */\n  dispose() {\n    this.removeAll();\n\n    delete this._bindings;\n    delete this._prevParams;\n  }\n\n  /**\n  *\n  * @method Signal#toString\n  * @return {string} String representation of the object.\n  */\n  toString() {\n    return '[Signal active:' + this.active + ' numListeners:' + this.getNumListeners() + ']';\n  }\n}\n/**\n        * If Signal should keep record of previously dispatched parameters and\n        * automatically execute listener during `add()`/`addOnce()` if Signal was\n        * already dispatched before.\n        * @property {boolean} memorize\n        */\nSignal.memorize = false;\n\n/**\n* @property {boolean} _shouldPropagate\n* @private\n*/\nSignal._shouldPropagate = true;\n\n/**\n* If Signal is active and should broadcast events.\n* IMPORTANT: Setting this property during a dispatch will only affect the next dispatch, if you want to stop the propagation of a signal use `halt()` instead.\n* @property {boolean} active\n* @default\n*/\nSignal.active = true;","import * as THREE from 'three';\n\nconst Loader = {\n  manager: null,\n  imageLoader: null,\n  crossOrigin: false,\n\n  init: function (crossOrigin) {\n    this.crossOrigin = crossOrigin || false;\n\n    this.manager = new THREE.LoadingManager(function () {\n      // called when all images are loaded, so call your state manager or something\n    }, function () {\n      // noop\n    }, function () {\n      console.warn('Error loading images');\n    });\n\n    this.imageLoader = new THREE.ImageLoader(this.manager);\n    this.imageLoader.crossOrigin = crossOrigin;\n  },\n\n  loadTexture: function (url, mapping, onLoad, onError) {\n    var texture = new THREE.Texture(null, mapping);\n    this.imageLoader.load(url, function (image) { // on load\n      texture.image = image;\n      texture.needsUpdate = true;\n      if (onLoad) onLoad(texture);\n    },\n      null, // on progress\n      function (evt) { // on error\n        if (onError) onError(evt);\n      });\n    texture.sourceFile = url;\n\n    return texture;\n  }\n}\n\nexport default Loader;","import TM from '../tm';\nimport * as THREE from 'three';\n/*\n\tTranslates mouse interactivity into 3D positions, so we can easily pick objects in the scene.\n\n\tLike everything else in ThreeJS, ray casting creates a ton of new objects each time it's used. This contributes to frequent garbage collections (causing frame hitches), so if you're limited to low-end hardware like mobile, it would be better to only update it when the user clicks, instead of every frame (so no hover effects, but on mobile those don't work anyway). You'll want to create a version that handles touch anyway.\n\n\tgroup - any Object3D (Scene, Group, Mesh, Sprite, etc) that the mouse will cast against\n\tcamera - the camera to cast from\n\t[element] - optional element to attach mouse event to\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nclass MouseCaster {\n  constructor(group, camera, element) {\n    this.down = false; // left click\n    this.rightDown = false;\n    // the object that was just clicked on\n    this.pickedObject = null;\n    // the object currently being 'held'\n    this.selectedObject = null;\n    // store the results of the last cast\n    this.allHits = null;\n    // disable the caster easily to temporarily prevent user input\n    this.active = true;\n\n    this.shift = false;\n    this.ctrl = false;\n    this.wheel = 0;\n\n    // you can track exactly where the mouse is in the 3D scene by using the z component\n    this.position = new THREE.Vector3();\n    this.screenPosition = new THREE.Vector2();\n    this.signal = new TM.Signal();\n    this.group = group;\n\n    // behind-the-scenes stuff you shouldn't worry about\n    this._camera = camera;\n    this._raycaster = new THREE.Raycaster();\n    this._preventDefault = false;\n\n    element = element || document;\n\n    element.addEventListener('mousemove', this._onDocumentMouseMove.bind(this), false);\n    element.addEventListener('mousedown', this._onDocumentMouseDown.bind(this), false);\n    element.addEventListener('mouseup', this._onDocumentMouseUp.bind(this), false);\n    element.addEventListener('mousewheel', this._onMouseWheel.bind(this), false);\n    element.addEventListener('DOMMouseScroll', this._onMouseWheel.bind(this), false); // firefox\n  }\n  update() {\n    if (!this.active) {\n      return;\n    }\n    this._raycaster.setFromCamera(this.screenPosition, this._camera);\n\n    var intersects = this._raycaster.intersectObject(this.group, true);\n    var hit, obj;\n\n    if (intersects.length > 0) {\n      // get the first object under the mouse\n      hit = intersects[0];\n      obj = hit.object.userData.structure;\n      if (this.pickedObject != obj) {\n        // the first object changed, meaning there's a different one, or none at all\n        if (this.pickedObject) {\n          // it's a new object, notify the old object is going away\n          this.signal.dispatch('out', this.pickedObject);\n        }\n        /*else {\n          // hit a new object when nothing was there previously\n        }*/\n        this.pickedObject = obj;\n        this.selectedObject = null; // cancel click, otherwise it'll confuse the user\n\n        this.signal.dispatch('over', this.pickedObject);\n      }\n      this.position.copy(hit.point);\n      this.screenPosition.z = hit.distance;\n    }\n    else {\n      // there isn't anything under the mouse\n      if (this.pickedObject) {\n        // there was though, we just moved out\n        this.signal.dispatch('out', this.pickedObject);\n      }\n      this.pickedObject = null;\n      this.selectedObject = null;\n    }\n\n    this.allHits = intersects;\n  }\n\n  preventDefault() {\n    this._preventDefault = true;\n  }\n\n  _onDocumentMouseDown(evt) {\n    evt = evt || window.event;\n    evt.preventDefault();\n    if (this._preventDefault) {\n      this._preventDefault = false;\n      return false;\n    }\n    if (this.pickedObject) {\n      this.selectedObject = this.pickedObject;\n    }\n    this.shift = evt.shiftKey;\n    this.ctrl = evt.ctrlKey;\n\n    this.down = evt.which === 1;\n    this.rightDown = evt.which === 3;\n\n    this.signal.dispatch('down', this.pickedObject);\n  }\n\n  _onDocumentMouseUp(evt) {\n    evt.preventDefault();\n    if (this._preventDefault) {\n      this._preventDefault = false;\n      return false;\n    }\n    this.shift = evt.shiftKey;\n    this.ctrl = evt.ctrlKey;\n\n    this.signal.dispatch('up', this.pickedObject);\n    if (this.selectedObject && this.pickedObject && this.selectedObject.uniqueID === this.pickedObject.uniqueID) {\n      this.signal.dispatch('click', this.pickedObject);\n    }\n\n    this.down = evt.which === 1 ? false : this.down;\n    this.rightDown = evt.which === 3 ? false : this.rightDown;\n  }\n\n  _onDocumentMouseMove(evt) {\n    evt.preventDefault();\n    this.screenPosition.x = (evt.clientX / window.innerWidth) * 2 - 1;\n    this.screenPosition.y = -(evt.clientY / window.innerHeight) * 2 + 1;\n  }\n\n  _onMouseWheel(evt) {\n    if (!this.active) {\n      return;\n    }\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    var delta = 0;\n    if (evt.wheelDelta !== undefined) { // WebKit / Opera / Explorer 9\n      delta = evt.wheelDelta;\n    }\n    else if (evt.detail !== undefined) { // Firefox\n      delta = -evt.detail;\n    }\n    if (delta > 0) {\n      this.wheel++;\n    }\n    else {\n      this.wheel--;\n    }\n    // console.log(this.wheel);\n    this.signal.dispatch('wheel', this.wheel);\n  }\n}\n\nMouseCaster.OVER = 'over';\nMouseCaster.OUT = 'out';\nMouseCaster.DOWN = 'down';\nMouseCaster.UP = 'up';\nMouseCaster.CLICK = 'click'; // only fires if the user clicked down and up while on the same object\nMouseCaster.WHEEL = 'wheel';\n\nexport default MouseCaster;","import PM_PRNG from 'prng-parkmiller-js';\nimport SimplexNoise from 'simplex-noise';\n\nvar rng1 = PM_PRNG.create(1000000);\nvar rng2 = PM_PRNG.create(\"hello\");\nvar gen1 = new SimplexNoise(rng1.nextDouble.bind(rng1));\nvar gen2 = new SimplexNoise(rng2.nextDouble.bind(rng2));\n\nfunction componentToHex(c) {\n  var hex = c.toString(16);\n  return hex.length == 1 ? \"0\" + hex : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n  return \"0x\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport const Tools = {\n\n  clamp: function (val, min, max) {\n    return Math.max(min, Math.min(max, val));\n  },\n\n  sign: function (val) {\n    return val && val / Math.abs(val);\n  },\n\n\t/**\n\t * If one value is passed, it will return something from -val to val.\n\t * Else it returns a value between the range specified by min, max.\n\t */\n  random: function (min, max) {\n    if (arguments.length === 1) {\n      return (Math.random() * min) - (min * 0.5);\n    }\n    return Math.random() * (max - min) + min;\n  },\n\n  noise1: function (nx, ny) { return gen1.noise2D(nx, ny) / 2 + 0.5; },\n  noise2: function (nx, ny) { return gen2.noise2D(nx, ny) / 2 + 0.5; },\n\n\n  // from min to (and including) max\n  randomInt: function (min, max) {\n    if (arguments.length === 1) {\n      return (Math.random() * min) - (min * 0.5) | 0;\n    }\n    return (Math.random() * (max - min + 1) + min) | 0;\n  },\n\n  normalize: function (v, min, max) {\n    return (v - min) / (max - min);\n  },\n\n  getShortRotation: function (angle) {\n    angle %= this.TAU;\n    if (angle > this.PI) {\n      angle -= this.TAU;\n    }\n    else if (angle < -this.PI) {\n      angle += this.TAU;\n    }\n    return angle;\n  },\n\n  generateID: function () {\n    return Math.random().toString(36).slice(2) + Date.now();\n  },\n\n  isPlainObject: function (obj) {\n    if (typeof (obj) !== 'object' || obj.nodeType || obj === obj.window) {\n      return false;\n    }\n    // The try/catch suppresses exceptions thrown when attempting to access the 'constructor' property of certain host objects, ie. |window.location|\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=814622\n    try {\n      if (obj.constructor && !Object.prototype.hasOwnProperty.call(obj.constructor.prototype, 'isPrototypeOf')) {\n        return false;\n      }\n    }\n    catch (err) {\n      return false;\n    }\n    // If the function hasn't returned already, we're confident that\n    // |obj| is a plain object, created by {} or constructed with new Object\n    return true;\n  },\n\n  // https://github.com/KyleAMathews/deepmerge/blob/master/index.js\n  merge: function (target, src) {\n    var self = this, array = Array.isArray(src);\n    var dst = array && [] || {};\n    if (array) {\n      target = target || [];\n      dst = dst.concat(target);\n      src.forEach(function (e, i) {\n        if (typeof dst[i] === 'undefined') {\n          dst[i] = e;\n        }\n        else if (self.isPlainObject(e)) {\n          dst[i] = self.merge(target[i], e);\n        }\n        else {\n          if (target.indexOf(e) === -1) {\n            dst.push(e);\n          }\n        }\n      });\n      return dst;\n    }\n    if (target && self.isPlainObject(target)) {\n      Object.keys(target).forEach(function (key) {\n        dst[key] = target[key];\n      });\n    }\n    Object.keys(src).forEach(function (key) {\n      if (!src[key] || !self.isPlainObject(src[key])) {\n        dst[key] = src[key];\n      }\n      else {\n        if (!target[key]) {\n          dst[key] = src[key];\n        }\n        else {\n          dst[key] = self.merge(target[key], src[key]);\n        }\n      }\n    });\n    return dst;\n  },\n\n  now: function () {\n    return window.nwf ? window.nwf.system.Performance.elapsedTime : window.performance.now();\n  },\n\n  empty: function (node) {\n    while (node.lastChild) {\n      node.removeChild(node.lastChild);\n    }\n  },\n\n\t/*\n\t\t@source: http://jsperf.com/radix-sort\n\t */\n  radixSort: function (arr, idxBegin, idxEnd, bit) {\n    idxBegin = idxBegin || 0;\n    idxEnd = idxEnd || arr.length;\n    bit = bit || 31;\n    if (idxBegin >= (idxEnd - 1) || bit < 0) {\n      return;\n    }\n    var idx = idxBegin;\n    var idxOnes = idxEnd;\n    var mask = 0x1 << bit;\n    while (idx < idxOnes) {\n      if (arr[idx] & mask) {\n        --idxOnes;\n        var tmp = arr[idx];\n        arr[idx] = arr[idxOnes];\n        arr[idxOnes] = tmp;\n      }\n      else {\n        ++idx;\n      }\n    }\n    this.radixSort(arr, idxBegin, idxOnes, bit - 1);\n    this.radixSort(arr, idxOnes, idxEnd, bit - 1);\n  },\n\n  randomizeRGB: function (base, range) {\n    var rgb = base.split(',');\n    var obj = {};\n    var color = 'rgb(';\n    var i, c;\n    var rgb_ = [];\n    range = this.randomInt(range);\n    for (i = 0; i < 3; i++) {\n      c = parseInt(rgb[i]) + range;\n      if (c < 0) c = 0;\n      else if (c > 255) c = 255;\n      color += c + ',';\n      rgb_.push(c);\n    }\n    color = color.substring(0, color.length - 1);\n    color += ')';\n    return color;\n  },\n\n  getJSON: function (config) {\n    var xhr = new XMLHttpRequest();\n    var cache = typeof config.cache === 'undefined' ? false : config.cache;\n    var uri = cache ? config.url : config.url + '?t=' + Math.floor(Math.random() * 10000) + Date.now();\n    xhr.onreadystatechange = function () {\n      if (this.status === 200) {\n        var json = null;\n        try {\n          json = JSON.parse(this.responseText);\n        }\n        catch (err) {\n          // console.warn('[Tools.getJSON] Error: '+config.url+' is not a json resource');\n          return;\n        }\n        config.callback.call(config.scope || null, json);\n        return;\n      }\n      else if (this.status !== 0) {\n        console.warn('[Tools.getJSON] Error: ' + this.status + ' (' + this.statusText + ') :: ' + config.url);\n      }\n    }\n    xhr.open('GET', uri, true);\n    xhr.setRequestHeader('Accept', 'application/json');\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.send('');\n  }\n}\n\nexport default Tools;","import Cell from './grids/Cell';\n//export { default as Cell } from './grids/Cell';\nimport HexGrid from './grids/HexGrid';\n//export { default as HexGrid } from './grids/HexGrid';\nimport SqrGrid from './grids/SqrGrid';\n//export { default as SqrGrid } from './grids/SqrGrid';\nimport Tile from './grids/Tile';\n//export { default as Tile } from './grids/Tile';\nimport LinkedList from './lib/LinkedList';\n//export { default as LinkedList } from './lib/LinkedList';\nimport Signal from './lib/Signal';\n//export { default as Signal } from './lib/Signal';\nimport AStarFinder from './pathing/AStarFinder';\n//export { default as AStarFinder } from './pathing/AStarFinder';\nimport PathUtil from './pathing/PathUtil';\n//export { default as PathUtil } from './pathing/PathUtil';\nimport Loader from './utils/Loader';\n//export { default as Loader } from './utils/Loader';\nimport MouseCaster from './utils/MouseCaster';\n//export { default as MouseCaster } from './utils/MouseCaster';\nimport Scene from './utils/Scene';\n//export { default as Scene } from './utils/Scene';\nimport SelectionManager from './utils/SelectionManager';\n//export { default as SelectionManager } from './utils/SelectionManager';\nimport Tools from './utils/Tools';\n//export { default as Tools } from './utils/Tools';\nimport Board from './Board';\n// export { default as Board } from './Board';\n\n\nexport const TM = {\n  VERSION: '1.0.0',\n\n  PI: Math.PI,\n  TAU: Math.PI * 2,\n  DEG_TO_RAD: 0.0174532925,\n  RAD_TO_DEG: 57.2957795,\n  SQRT3: Math.sqrt(3), // used often in hex conversions\n\n  Cell,\n  HexGrid,\n  SqrGrid,\n  Tile,\n  LinkedList,\n  Signal,\n  AStarFinder,\n  PathUtil,\n  Loader,\n  MouseCaster,\n  Scene,\n  SelectionManager,\n  Tools,\n  Board,\n\n  // useful enums for type checking. change to whatever fits your game. these are just examples\n  TILE: 'tile', // visual representation of a grid cell\n  ENT: 'entity', // dynamic things\n  STR: 'structure', // static things\n\n  HEX: 'hex',\n  SQR: 'square',\n  ABS: 'abstract',\n}\n\nexport default TM;","import TM from '../tm';\n\n// Coordinate data for a cell\nexport default class Cell {\n  constructor(q, r, s, h) {\n    this.q = q || 0; // x grid coordinate (using different letters so that it won't be confused with pixel/world coordinates)\n    this.r = r || 0; // y grid coordinate\n    this.s = s || 0; // z grid coordinate\n    this.h = h || 1; // 3D height of the cell, used by visual representation and pathfinder, cannot be less than 1\n    this.tile = null; // optional link to the visual representation's class instance\n    this.userData = {}; // populate with any extra data needed in your game\n    this.walkable = true; // if true, pathfinder will use as a through node\n\n    // rest of these are used by the pathfinder and overwritten at runtime, so don't touch\n    this._calcCost = 0;\n    this._priority = 0;\n    this._visited = false;\n    this._parent = null;\n    this.uniqueID = TM.LinkedList.generateID();\n  }\n  set(q, r, s) {\n    this.q = q;\n    this.r = r;\n    this.s = s;\n    return this;\n  }\n\n  copy(cell) {\n    this.q = cell.q;\n    this.r = cell.r;\n    this.s = cell.s;\n    this.h = cell.h;\n    this.tile = cell.tile || null;\n    this.userData = cell.userData || {};\n    this.walkable = cell.walkable;\n    return this;\n  }\n\n  add(cell) {\n    this.q += cell.q;\n    this.r += cell.r;\n    this.s += cell.s;\n    return this;\n  }\n\n  equals(cell) {\n    return this.q === cell.q && this.r === cell.r && this.s === cell.s;\n  }\n}","import TM from '../tm';\nimport * as THREE from 'three';\n/*\n\tGraph of squares. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\tInterface:\n\ttype\n\tsize - number of cells (in radius); only used if the map is generated\n\tcellSize\n\tcells - a hash so we can have sparse maps\n\tnumCells\n\textrudeSettings\n\tautogenerated\n\tcellShape\n\tcellGeo\n\tcellShapeGeo\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nexport default class SqrGrid {\n  constructor(config) {\n    config = config || {};\n    /*  ______________________________________________\n      GRID INTERFACE:\n    */\n    this.type = TM.SQR;\n    this.size = 5; // only used for generated maps\n    this.cellSize = typeof config.cellSize === 'undefined' ? 10 : config.cellSize;\n    this.cells = {};\n    this.numCells = 0;\n\n    this.extrudeSettings = null;\n    this.autogenerated = false;\n\n    // create base shape used for building geometry\n    var verts = [];\n    verts.push(new THREE.Vector3());\n    verts.push(new THREE.Vector3(-this.cellSize, this.cellSize));\n    verts.push(new THREE.Vector3(this.cellSize, this.cellSize));\n    verts.push(new THREE.Vector3(this.cellSize, -this.cellSize));\n    // copy the verts into a shape for the geometry to use\n    this.cellShape = new THREE.Shape();\n    this.cellShape.moveTo(-this.cellSize, -this.cellSize);\n    this.cellShape.lineTo(-this.cellSize, this.cellSize);\n    this.cellShape.lineTo(this.cellSize, this.cellSize);\n    this.cellShape.lineTo(this.cellSize, -this.cellSize);\n    this.cellShape.lineTo(-this.cellSize, -this.cellSize);\n\n    this.cellGeo = new THREE.Geometry();\n    this.cellGeo.vertices = verts;\n    this.cellGeo.verticesNeedUpdate = true;\n\n    this.cellShapeGeo = new THREE.ShapeGeometry(this.cellShape);\n\n    /*  ______________________________________________\n      PRIVATE\n    */\n\n    this._fullCellSize = this.cellSize * 2;\n    this._hashDelimeter = '.';\n    // pre-computed permutations\n    this._directions = [new TM.Cell(+1, 0, 0), new TM.Cell(0, -1, 0),\n    new TM.Cell(-1, 0, 0), new TM.Cell(0, +1, 0)];\n    this._diagonals = [new TM.Cell(-1, -1, 0), new TM.Cell(-1, +1, 0),\n    new TM.Cell(+1, +1, 0), new TM.Cell(+1, -1, 0)];\n    // cached objects\n    this._list = [];\n    this._vec3 = new THREE.Vector3();\n    this._cel = new TM.Cell();\n    this._conversionVec = new THREE.Vector3();\n    this._geoCache = [];\n    this._matCache = [];\n  }\n  /*\n\t\t________________________________________________________________________\n\t\tHigh-leves that the Board interfaces with (all grids implement)\n\t */\n\n  cellToPixel(cell) {\n    this._vec3.x = cell.q * this._fullCellSize;\n    this._vec3.y = cell.h;\n    this._vec3.z = cell.r * this._fullCellSize;\n    return this._vec3;\n  }\n\n  pixelToCell(pos) {\n    var q = Math.round(pos.x / this._fullCellSize);\n    var r = Math.round(pos.z / this._fullCellSize);\n    return this._cel.set(q, r, 0);\n  }\n\n  getCellAt(pos) {\n    var q = Math.round(pos.x / this._fullCellSize);\n    var r = Math.round(pos.z / this._fullCellSize);\n    this._cel.set(q, r);\n    return this.cells[this.cellToHash(this._cel)];\n  }\n\n  getNeighbors(cell, diagonal, filter) {\n    // always returns an array\n    var i, n, l = this._directions.length;\n    this._list.length = 0;\n    for (i = 0; i < l; i++) {\n      this._cel.copy(cell);\n      this._cel.add(this._directions[i]);\n      n = this.cells[this.cellToHash(this._cel)];\n      if (!n || (filter && !filter(cell, n))) {\n        continue;\n      }\n      this._list.push(n);\n    }\n    if (diagonal) {\n      for (i = 0; i < l; i++) {\n        this._cel.copy(cell);\n        this._cel.add(this._diagonals[i]);\n        n = this.cells[this.cellToHash(this._cel)];\n        if (!n || (filter && !filter(cell, n))) {\n          continue;\n        }\n        this._list.push(n);\n      }\n    }\n    return this._list;\n  }\n\n  getRandomCell() {\n    var c, i = 0, x = TM.Tools.randomInt(0, this.numCells);\n    for (c in this.cells) {\n      if (i === x) {\n        return this.cells[c];\n      }\n      i++;\n    }\n    return this.cells[c];\n  }\n\n  cellToHash(cell) {\n    return cell.q + this._hashDelimeter + cell.r; // s is not used in a square grid\n  }\n\n  distance(cellA, cellB) {\n    var d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r));\n    d += cellB.h - cellA.h; // include vertical size\n    return d;\n  }\n\n  clearPath() {\n    var i, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      c._calcCost = 0;\n      c._priority = 0;\n      c._parent = null;\n      c._visited = false;\n    }\n  }\n\n  traverse(cb) {\n    var i;\n    for (i in this.cells) {\n      cb(this.cells[i]);\n    }\n  }\n\n  generateTile(cell, scale, material) {\n    var height = Math.abs(cell.h);\n    if (height < 1) height = 1;\n\n    var geo = this._geoCache[height];\n    if (!geo) {\n      this.extrudeSettings.amount = height;\n      geo = new THREE.ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n      this._geoCache[height] = geo;\n    }\n\n    /*mat = this._matCache[c.matConfig.mat_cache_id];\n    if (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n      mat.map = Loader.loadTexture(c.matConfig.imgURL);\n      delete c.matConfig.imgURL;\n      mat = new THREE[c.matConfig.type](c.matConfig);\n      this._matCache[c.matConfig.mat_cache_id] = mat;\n    }*/\n\n    var t = new TM.Tile({\n      size: this.cellSize,\n      scale: scale,\n      cell: cell,\n      geometry: geo,\n      material: material\n    });\n\n    cell.tile = t;\n\n    return t;\n  }\n\n  generateTiles(config) {\n    config = config || {};\n    var tiles = [];\n    var settings = {\n      tileScale: 0.95,\n      cellSize: this.cellSize,\n      material: null,\n      extrudeSettings: {\n        amount: 1,\n        bevelEnabled: true,\n        bevelSegments: 1,\n        steps: 1,\n        bevelSize: 0.5,\n        bevelThickness: 0.5\n      }\n    }\n    settings = TM.Tools.merge(settings, config);\n\n    /*if (!settings.material) {\n      settings.material = new THREE.MeshPhongMaterial({\n        color: TM.Tools.randomizeRGB('30, 30, 30', 10)\n      });\n    }*/\n\n    // overwrite with any new dimensions\n    this.cellSize = settings.cellSize;\n    this._fullCellSize = this.cellSize * 2;\n\n    this.autogenerated = true;\n    this.extrudeSettings = settings.extrudeSettings;\n\n    var i, t, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      t = this.generateTile(c, settings.tileScale, settings.material);\n      t.position.copy(this.cellToPixel(c));\n      t.position.y = 0;\n      tiles.push(t);\n    }\n    return tiles;\n  }\n\n  // create a flat, square-shaped grid\n  generate(config) {\n    config = config || {};\n    this.size = typeof config.size === 'undefined' ? this.size : config.size;\n    var x, y, c;\n    var half = Math.ceil(this.size / 2);\n    for (x = -half; x < half; x++) {\n      for (y = -half; y < half; y++) {\n        c = new TM.Cell(x, y + 1);\n        this.add(c);\n      }\n    }\n  }\n\n  generateOverlay(size, overlayObj, overlayMat) {\n    var x, y;\n    var half = Math.ceil(size / 2);\n    for (x = -half; x < half; x++) {\n      for (y = -half; y < half; y++) {\n        this._cel.set(x, y); // define the cell\n        var line = new THREE.Line(this.cellGeo, overlayMat);\n        line.position.copy(this.cellToPixel(this._cel));\n        line.rotation.x = 90 * TM.DEG_TO_RAD;\n        overlayObj.add(line);\n      }\n    }\n  }\n\n  add(cell) {\n    var h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      // console.warn('A cell already exists there');\n      return;\n    }\n    this.cells[h] = cell;\n    this.numCells++;\n\n    return cell;\n  }\n\n  remove(cell) {\n    var h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      delete this.cells[h];\n      this.numCells--;\n    }\n  }\n\n  dispose() {\n    this.cells = null;\n    this.numCells = 0;\n    this.cellShape = null;\n    this.cellGeo.dispose();\n    this.cellGeo = null;\n    this.cellShapeGeo.dispose();\n    this.cellShapeGeo = null;\n    this._list = null;\n    this._vec3 = null;\n    this._conversionVec = null;\n    this._geoCache = null;\n    this._matCache = null;\n  }\n\n  /*\n    Load a grid from a parsed json object.\n    json = {\n      extrudeSettings,\n      size,\n      cellSize,\n      autogenerated,\n      cells: [],\n      materials: [\n        {\n          cache_id: 0,\n          type: 'MeshLambertMaterial',\n          color, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n          imgURL: url\n        }\n        {\n          cacheId: 1, ...\n        }\n        ...\n      ]\n    }\n  */\n  load(url, callback, scope) {\n    TM.Tools.getJSON({\n      url: url,\n      callback(json) {\n        this.fromJSON(json);\n        callback.call(scope || null, json);\n      },\n      cache: false,\n      scope: this\n    });\n  }\n\n  fromJSON(json) {\n    var i, c;\n    var cells = json.cells;\n\n    this.cells = {};\n    this.numCells = 0;\n\n    this.size = json.size;\n    this.cellSize = json.cellSize;\n    this._fullCellSize = this.cellSize * 2;\n    this.extrudeSettings = json.extrudeSettings;\n    this.autogenerated = json.autogenerated;\n\n    for (i = 0; i < cells.length; i++) {\n      c = new TM.Cell();\n      c.copy(cells[i]);\n      this.add(c);\n    }\n  }\n\n  toJSON() {\n    var json = {\n      size: this.size,\n      cellSize: this.cellSize,\n      extrudeSettings: this.extrudeSettings,\n      autogenerated: this.autogenerated\n    };\n    var cells = [];\n    var c, k;\n\n    for (k in this.cells) {\n      c = this.cells[k];\n      cells.push({\n        q: c.q,\n        r: c.r,\n        s: c.s,\n        h: c.h,\n        walkable: c.walkable,\n        userData: c.userData\n      });\n    }\n    json.cells = cells;\n\n    return json;\n  }\n}","import TM from '../tm';\nimport * as THREE from 'three';\n\n// Visual representation of a cell\nexport default class Tile {\n  \n  constructor(config) {\n    config = config || {};\n    var settings = {\n      cell: null, // required TM.Cell\n      geometry: null, // required threejs geometry (hex or square?)\n      material: null // not required but it would improve performance significantly\n    };\n    settings = TM.Tools.merge(settings, config);\n\n    if (!settings.cell || !settings.geometry) {\n      throw new Error('Missing TM.Tile configuration');\n    }\n\n    this.cell = settings.cell;\n    if (this.cell.tile && this.cell.tile !== this) this.cell.tile.dispose(); // remove whatever was there\n    this.cell.tile = this;\n\n    this.uniqueID = TM.Tools.generateID();\n\n    this.geometry = settings.geometry;\n    this.material = settings.material;\n    if (!this.material) {\n      this.material = new THREE.MeshPhongMaterial({\n        color: TM.Tools.randomizeRGB('0, 105, 148', 13)\n      });\n    }\n\n    this.objectType = TM.TILE;\n    this.entity = null;\n    this.userData = {};\n\n    this.selected = false;\n    this.highlight = '0x0084cc';\n\n    this.mesh = new THREE.Mesh(this.geometry, this.material);\n    this.mesh.userData.structure = this;\n\n    // create references so we can control orientation through this (Tile), instead of drilling down\n    this.position = this.mesh.position;\n    this.rotation = this.mesh.rotation;\n\n    // rotate it to face \"up\" (the threejs coordinate space is Y+)\n    this.rotation.x = -90 * TM.DEG_TO_RAD;\n    this.mesh.scale.set(settings.scale, settings.scale, 1);\n\n    if (this.material.emissive) {\n      this._emissive = this.material.emissive.getHex();\n    }\n    else {\n      this._emissive = null;\n    }\n  }\n  select() {\n    if (this.material.emissive) {\n      this.material.emissive.setHex(this.highlight);\n    }\n    this.selected = true;\n    console.log(this.userData.terrain)\n    console.log(this.userData.elevation);\n    console.log(this.position);\n    return this;\n  }\n\n  deselect() {\n    if (this._emissive !== null && this.material.emissive) {\n      this.material.emissive.setHex(this._emissive);\n    }\n    this.selected = false;\n    return this;\n  }\n\n  toggle() {\n    if (this.selected) {\n      this.deselect();\n    }\n    else {\n      this.select();\n    }\n    return this;\n  }\n\n  dispose() {\n    if (this.cell && this.cell.tile) this.cell.tile = null;\n    this.cell = null;\n    this.position = null;\n    this.rotation = null;\n    if (this.mesh.parent) this.mesh.parent.remove(this.mesh);\n    this.mesh.userData.structure = null;\n    this.mesh = null;\n    this.material = null;\n    this.userData = null;\n    this.entity = null;\n    this.geometry = null;\n    this._emissive = null;\n  }\n  \n  setTerrain(e, m) {\n    \n    this.userData.elevation = e;\n    this.userData.moisture = m;\n\n    if (e < 0.1) {\n      this.userData.terrain = 'OCEAN';\n      return;\n    }\n    if (e < 0.12) {\n      this.userData.terrain = 'BEACH';\n      this.material.color.set(TM.Tools.randomizeRGB('212,192,155', 13));\n      return;\n    }\n\n    if (e > 0.8) {\n      if (m < 0.1) {\n        this.userData.terrain = 'SCORCHED';\n        this.material.color.set(TM.Tools.randomizeRGB('171,95,58', 13));\n        return;\n      }\n      if (m < 0.2) {\n        this.userData.terrain = 'BARE';\n        this.material.color.set(TM.Tools.randomizeRGB('215,171,114', 13));\n        return;\n      }\n      if (m < 0.5) {\n        this.userData.terrain = 'TUNDRA';\n        this.material.color.set(TM.Tools.randomizeRGB('152,171,180', 13));\n        return;\n      }\n      this.userData.terrain = 'SNOW';\n      this.material.color.set(TM.Tools.randomizeRGB('223,217,221', 13));\n      return;\n    }\n\n    if (e > 0.6) {\n      if (m < 0.33) {\n        this.userData.terrain = 'TEMPERATE_DESERT';\n        this.material.color.set(TM.Tools.randomizeRGB('200,184,158', 13));\n        return;\n      }\n      if (m < 0.66) {\n        this.userData.terrain = 'SHRUBLAND';\n        this.material.color.set(TM.Tools.randomizeRGB('125,124,62', 13));\n        return;\n      };\n      this.userData.terrain = 'TAIGA';\n      this.material.color.set(TM.Tools.randomizeRGB('16,86,76', 13));\n      return;\n    }\n\n    if (e > 0.3) {\n      if (m < 0.16) {\n        this.userData.terrain = 'TEMPERATE_DESERT';\n        this.material.color.set(TM.Tools.randomizeRGB('200,184,158', 13));\n        return;\n      }\n      if (m < 0.50) {\n        this.userData.terrain = 'GRASSLAND';\n        this.material.color.set(TM.Tools.randomizeRGB('147,217,69', 13));\n        return;\n      }\n      //if (m < 0.83) return 'TEMPERATE_DECIDUOUS_FOREST';\n      this.userData.terrain = 'FOREST';\n      this.material.color.set(TM.Tools.randomizeRGB('16,59,35', 13));\n      return;\n    }\n\n    if (m < 0.16) {\n      this.userData.terrain = 'SUBTROPICAL_DESERT';\n      this.material.color.set(TM.Tools.randomizeRGB('152,79,15', 13));\n      return;\n    }\n    if (m < 0.33) {\n      this.userData.terrain = 'GRASSLAND';\n      this.material.color.set(TM.Tools.randomizeRGB('147,217,69', 13));\n      return;\n    }\n    this.userData.terrain = 'TROPICAL_RAIN_FOREST';\n    this.material.color.set(TM.Tools.randomizeRGB('79,159,27', 13));\n    return;\n  }\n}","import TM from '../tm';\n/*\n\tA* path-finder based upon http://www.redblobgames.com/pathfinding/a-star/introduction.html\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\n// 'utils/Tools', 'lib/LinkedList'\nexport default class AStarFinder {\n  constructor(finderConfig) {\n    finderConfig = finderConfig || {};\n\n    var settings = {\n      allowDiagonal: false,\n      heuristicFilter: null\n    };\n    settings = TM.Tools.merge(settings, finderConfig);\n\n    this.allowDiagonal = settings.allowDiagonal;\n    this.heuristicFilter = settings.heuristicFilter;\n\n    this.list = new TM.LinkedList();\n  }\n  /*\n\t\tFind and return the path.\n\t\t@return Array<Cell> The path, including both start and end positions. Null if it failed.\n\t */\n  findPath(startNode, endNode, heuristic, grid) {\n    var current, costSoFar, neighbors, n, i, l;\n    heuristic = heuristic || this.heuristicFilter;\n    // clear old values from previous finding\n    grid.clearPath();\n    this.list.clear();\n\n    // push the start current into the open list\n    this.list.add(startNode);\n\n    // while the open list is not empty\n    while (this.list.length > 0) {\n      // sort so lowest cost is first\n      this.list.sort(this.compare);\n\n      // pop the position of current which has the minimum `_calcCost` value.\n      current = this.list.shift();\n      current._visited = true;\n\n      // if reached the end position, construct the path and return it\n      if (current === endNode) {\n        return TM.PathUtil.backtrace(endNode);\n      }\n\n      // cycle through each neighbor of the current current\n      neighbors = grid.getNeighbors(current, this.allowDiagonal, heuristic);\n      for (i = 0, l = neighbors.length; i < l; i++) {\n        n = neighbors[i];\n\n        if (!n.walkable) {\n          continue;\n        }\n\n        costSoFar = current._calcCost + grid.distance(current, n);\n\n        // check if the neighbor has not been inspected yet, or can be reached with smaller cost from the current node\n        if (!n._visited || costSoFar < n._calcCost) {\n          n._visited = true;\n          n._parent = current;\n          n._calcCost = costSoFar;\n          // console.log(n);\n          // _priority is the most important property, since it makes the algorithm \"greedy\" and seek the goal.\n          // otherwise it behaves like a brushfire/breadth-first\n          n._priority = costSoFar + grid.distance(endNode, n);\n\n          // check neighbor if it's the end current as well--often cuts steps by a significant amount\n          if (n === endNode) {\n            return TM.PathUtil.backtrace(endNode);\n          }\n          // console.log(n);\n          this.list.add(n);\n        }\n        // console.log(this.list);\n      } // end for each neighbor\n    } // end while not open list empty\n    // failed to find the path\n    return null;\n  }\n\n  compare(nodeA, nodeB) {\n    return nodeA._priority - nodeB._priority;\n  }\n}","/*\n\t@source https://github.com/qiao/PathFinding.js/\n*/\nexport default class PathUtil {\n  /**\n\t * Backtrace according to the parent records and return the path.\n\t * (including both start and end nodes)\n\t * @param {Node} node End node\n\t * @return {Array.<Array.<number>>} the path\n\t */\n  backtrace(node) {\n    var path = [node];\n    while (node._parent) {\n      node = node._parent;\n      path.push(node);\n    }\n    return path.reverse();\n  }\n\n  /**\n   * Backtrace from start and end node, and return the path.\n   * (including both start and end nodes)\n   * @param {Node}\n   * @param {Node}\n   */\n  biBacktrace(nodeA, nodeB) {\n    var pathA = this.backtrace(nodeA),\n      pathB = this.backtrace(nodeB);\n    return pathA.concat(pathB.reverse());\n  }\n\n  /**\n   * Compute the length of the path.\n   * @param {Array.<Array.<number>>} path The path\n   * @return {number} The length of the path\n   */\n  pathLength(path) {\n    var i, sum = 0, a, b, dx, dy;\n    for (i = 1; i < path.length; ++i) {\n      a = path[i - 1];\n      b = path[i];\n      dx = a[0] - b[0];\n      dy = a[1] - b[1];\n      sum += Math.sqrt(dx * dx + dy * dy);\n    }\n    return sum;\n  }\n\n\n  /**\n   * Given the start and end coordinates, return all the coordinates lying\n   * on the line formed by these coordinates, based on Bresenham's algorithm.\n   * http://en.wikipedia.org/wiki/Bresenham's_line_algorithm#Simplification\n   * @param {number} x0 Start x coordinate\n   * @param {number} y0 Start y coordinate\n   * @param {number} x1 End x coordinate\n   * @param {number} y1 End y coordinate\n   * @return {Array.<Array.<number>>} The coordinates on the line\n   */\n  interpolate(x0, y0, x1, y1) {\n    var abs = Math.abs,\n      line = [],\n      sx, sy, dx, dy, err, e2;\n\n    dx = abs(x1 - x0);\n    dy = abs(y1 - y0);\n\n    sx = (x0 < x1) ? 1 : -1;\n    sy = (y0 < y1) ? 1 : -1;\n\n    err = dx - dy;\n\n    while (x0 !== x1 || y0 !== y1) {\n      line.push([x0, y0]);\n\n      e2 = 2 * err;\n      if (e2 > -dy) {\n        err = err - dy;\n        x0 = x0 + sx;\n      }\n      if (e2 < dx) {\n        err = err + dx;\n        y0 = y0 + sy;\n      }\n    }\n\n    return line;\n  }\n\n\n  /**\n   * Given a compressed path, return a new path that has all the segments\n   * in it interpolated.\n   * @param {Array.<Array.<number>>} path The path\n   * @return {Array.<Array.<number>>} expanded path\n   */\n  expandPath(path) {\n    var expanded = [],\n      len = path.length,\n      coord0, coord1,\n      interpolated,\n      interpolatedLen,\n      i, j;\n\n    if (len < 2) {\n      return expanded;\n    }\n\n    for (i = 0; i < len - 1; ++i) {\n      coord0 = path[i];\n      coord1 = path[i + 1];\n\n      interpolated = this.interpolate(coord0[0], coord0[1], coord1[0], coord1[1]);\n      interpolatedLen = interpolated.length;\n      for (j = 0; j < interpolatedLen - 1; ++j) {\n        expanded.push(interpolated[j]);\n      }\n    }\n    expanded.push(path[len - 1]);\n\n    return expanded;\n  }\n\n\n  /**\n   * Smoothen the give path.\n   * The original path will not be modified; a new path will be returned.\n   * @param {PF.Grid} grid\n   * @param {Array.<Array.<number>>} path The path\n   */\n  smoothenPath(grid, path) {\n    var len = path.length,\n      x0 = path[0][0],        // path start x\n      y0 = path[0][1],        // path start y\n      x1 = path[len - 1][0],  // path end x\n      y1 = path[len - 1][1],  // path end y\n      sx, sy,                 // current start coordinate\n      ex, ey,                 // current end coordinate\n      newPath,\n      lastValidCoord,\n      i, j, coord, line, testCoord, blocked;\n\n    sx = x0;\n    sy = y0;\n    newPath = [[sx, sy]];\n\n    for (i = 2; i < len; ++i) {\n      coord = path[i];\n      ex = coord[0];\n      ey = coord[1];\n      line = this.interpolate(sx, sy, ex, ey);\n\n      blocked = false;\n      for (j = 1; j < line.length; ++j) {\n        testCoord = line[j];\n\n        if (!grid.isWalkableAt(testCoord[0], testCoord[1])) {\n          blocked = true;\n          break;\n        }\n      }\n      if (blocked) {\n        lastValidCoord = path[i - 1];\n        newPath.push(lastValidCoord);\n        sx = lastValidCoord[0];\n        sy = lastValidCoord[1];\n      }\n    }\n    newPath.push([x1, y1]);\n\n    return newPath;\n  }\n\n\n  /**\n   * Compress a path, remove redundant nodes without altering the shape\n   * The original path is not modified\n   * @param {Array.<Array.<number>>} path The path\n   * @return {Array.<Array.<number>>} The compressed path\n   */\n  compressPath(path) {\n\n    // nothing to compress\n    if (path.length < 3) {\n      return path;\n    }\n\n    var compressed = [],\n      sx = path[0][0], // start x\n      sy = path[0][1], // start y\n      px = path[1][0], // second point x\n      py = path[1][1], // second point y\n      dx = px - sx, // direction between the two points\n      dy = py - sy, // direction between the two points\n      lx, ly,\n      ldx, ldy,\n      sq, i;\n\n    // normalize the direction\n    sq = Math.sqrt(dx * dx + dy * dy);\n    dx /= sq;\n    dy /= sq;\n\n    // start the new path\n    compressed.push([sx, sy]);\n\n    for (i = 2; i < path.length; i++) {\n\n      // store the last point\n      lx = px;\n      ly = py;\n\n      // store the last direction\n      ldx = dx;\n      ldy = dy;\n\n      // next point\n      px = path[i][0];\n      py = path[i][1];\n\n      // next direction\n      dx = px - lx;\n      dy = py - ly;\n\n      // normalize\n      sq = Math.sqrt(dx * dx + dy * dy);\n      dx /= sq;\n      dy /= sq;\n\n      // if the direction has changed, store the point\n      if (dx !== ldx || dy !== ldy) {\n        compressed.push([lx, ly]);\n      }\n    }\n\n    // store the last point\n    compressed.push([px, py]);\n\n    return compressed;\n  }\n}","import TM from '../tm';\nimport * as THREE from 'three';\nimport OrbitControls from 'three-orbitcontrols'\n/*\n\tSets up and manages a THREEjs container, camera, and light, making it easy to get going.\n\tAlso provides camera control.\n\n\tAssumes full screen.\n */\n// 'utils/Tools'\nexport default class Scene {\n  constructor(sceneConfig, controlConfig) {\n    var sceneSettings = {\n      element: document.body,\n      alpha: true,\n      antialias: true,\n      clearColor: '#fff',\n      sortObjects: false,\n      fog: null,\n      light: new THREE.DirectionalLight(0xffffff),\n      lightPosition: null,\n      cameraType: 'PerspectiveCamera',\n      cameraPosition: null, // {x, y, z}\n      orthoZoom: 4\n    };\n\n    var controlSettings = {\n      minDistance: 100,\n      maxDistance: 1000,\n      zoomSpeed: 2,\n      noZoom: false\n    };\n\n    sceneSettings = TM.Tools.merge(sceneSettings, sceneConfig);\n    if (typeof controlConfig !== 'boolean') {\n      controlSettings = TM.Tools.merge(controlSettings, controlConfig);\n    }\n\n    this.renderer = new THREE.WebGLRenderer({\n      alpha: sceneSettings.alpha,\n      antialias: sceneSettings.antialias\n    });\n    this.renderer.setClearColor(sceneSettings.clearColor, 0);\n    this.renderer.sortObjects = sceneSettings.sortObjects;\n\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n\n    this.orthoZoom = sceneSettings.orthoZoom;\n\n    this.container = new THREE.Scene();\n    this.container.fog = sceneSettings.fog;\n\n    this.container.add(new THREE.AmbientLight(0xdddddd));\n\n    if (!sceneSettings.lightPosition) {\n      sceneSettings.light.position.set(-1, 1, -1).normalize();\n    }\n    this.container.add(sceneSettings.light);\n\n    if (sceneSettings.cameraType === 'OrthographicCamera') {\n      var width = window.innerWidth / this.orthoZoom;\n      var height = window.innerHeight / this.orthoZoom;\n      this.camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, 1, 5000);\n    }\n    else {\n      this.camera = new THREE.PerspectiveCamera(50, this.width / this.height, 1, 5000);\n    }\n\n    this.contolled = !!controlConfig;\n    if (this.contolled) {\n      this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n      this.controls.minDistance = controlSettings.minDistance;\n      this.controls.maxDistance = controlSettings.maxDistance;\n      this.controls.zoomSpeed = controlSettings.zoomSpeed;\n      this.controls.noZoom = controlSettings.noZoom;\n    }\n\n    if (sceneSettings.cameraPosition) {\n      this.camera.position.copy(sceneSettings.cameraPosition);\n    }\n\n    window.addEventListener('resize', function onWindowResize() {\n      this.width = window.innerWidth;\n      this.height = window.innerHeight;\n      if (this.camera.type === 'OrthographicCamera') {\n        var width = this.width / this.orthoZoom;\n        var height = this.height / this.orthoZoom;\n        this.camera.left = width / -2;\n        this.camera.right = width / 2;\n        this.camera.top = height / 2;\n        this.camera.bottom = height / -2;\n      }\n      else {\n        this.camera.aspect = this.width / this.height;\n      }\n      this.camera.updateProjectionMatrix();\n      this.renderer.setSize(this.width, this.height);\n    }.bind(this), false);\n\n    this.attachTo(sceneSettings.element);\n  }\n\n  attachTo(element) {\n    element.style.width = this.width + 'px';\n    element.style.height = this.height + 'px';\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(this.width, this.height);\n    element.appendChild(this.renderer.domElement);\n  }\n\n  add(mesh) {\n    this.container.add(mesh);\n  }\n\n  remove(mesh) {\n    this.container.remove(mesh);\n  }\n\n  render() {\n    if (this.contolled) this.controls.update();\n    this.renderer.render(this.container, this.camera);\n  }\n\n  updateOrthoZoom() {\n    if (this.orthoZoom <= 0) {\n      this.orthoZoom = 0;\n      return;\n    }\n    var width = this.width / this.orthoZoom;\n    var height = this.height / this.orthoZoom;\n    this.camera.left = width / -2;\n    this.camera.right = width / 2;\n    this.camera.top = height / 2;\n    this.camera.bottom = height / -2;\n    this.camera.updateProjectionMatrix();\n  }\n\n  focusOn(obj) {\n    this.camera.lookAt(obj.position);\n  }\n}","import TM from '../tm';\n// 'utils/Tools', 'lib/LinkedList', 'utils/MouseCaster', 'lib/Signal'\nexport default class SelectionManager {\n  constructor(mouse) {\n    this.mouse = mouse;\n\n    this.onSelect = new TM.Signal();\n    this.onDeselect = new TM.Signal();\n\n    this.selected = null;\n    // deselect if player clicked on the same thing twice\n    this.toggleSelection = false;\n\n    // allow multiple entities to be selected at once\n    // this.multiselect = false; // todo\n    // this.allSelected = new LinkedList();\n\n    this.mouse.signal.add(this.onMouse, this);\n  }\n  select(obj, fireSignal) {\n    if (!obj) return;\n    fireSignal = fireSignal || true;\n\n    if (this.selected !== obj) {\n      // deselect previous object\n      this.clearSelection(fireSignal);\n    }\n    if (obj.selected) {\n      if (this.toggleSelection) {\n        if (fireSignal) {\n          this.onDeselect.dispatch(obj);\n        }\n        obj.deselect();\n      }\n    }\n    else {\n      obj.select();\n    }\n\n    this.selected = obj;\n    if (fireSignal) {\n      this.onSelect.dispatch(obj);\n    }\n  }\n\n  clearSelection(fireSignal) {\n    fireSignal = fireSignal || true;\n    if (this.selected) {\n      if (fireSignal) {\n        this.onDeselect.dispatch(this.selected);\n      }\n      this.selected.deselect();\n    }\n    this.selected = null;\n  }\n\n  onMouse(type, obj) {\n    switch (type) {\n      case TM.MouseCaster.DOWN:\n        if (!obj) {\n          this.clearSelection();\n        }\n        break;\n\n      case TM.MouseCaster.CLICK:\n        this.select(obj);\n        break;\n    }\n  }\n}","import * as THREE from 'three';\nimport TM from './tm';\n\nexport default class Board {\n  constructor(grid, finderConfig) {\n    if (!grid) throw new Error('You must pass in a grid system for the board to use.');\n\n    this.tiles = [];\n    this.tileGroup = null; // only for tiles\n\n    this.group = new THREE.Object3D(); // can hold all entities, also holds tileGroup, never trashed\n\n    this.grid = null;\n    this.overlay = null;\n    this.finder = new TM.AStarFinder(finderConfig);\n    // need to keep a resource cache around, so this Loader does that, use it instead of THREE.ImageUtils\n    TM.Loader.init();\n\n    this.setGrid(grid);\n  }\n  setEntityOnTile(entity, tile) {\n    // snap an entity's position to a tile; merely copies position\n    var pos = this.grid.cellToPixel(tile.cell);\n    entity.position.copy(pos);\n    // adjust for any offset after the entity was set directly onto the tile\n    entity.position.y += entity.heightOffset || 0;\n    // remove entity from old tile\n    if (entity.tile) {\n      entity.tile.entity = null;\n    }\n    // set new situation\n    entity.tile = tile;\n    tile.entity = entity;\n  }\n\n  addTile(tile) {\n    var i = this.tiles.indexOf(tile);\n    if (i === -1) this.tiles.push(tile);\n    else return;\n\n    this.snapTileToGrid(tile);\n    tile.position.y = 0;\n\n    this.tileGroup.add(tile.mesh);\n    this.grid.add(tile.cell);\n\n    tile.cell.tile = tile;\n  }\n\n  removeTile(tile) {\n    if (!tile) return; // was already removed somewhere\n    var i = this.tiles.indexOf(tile);\n    this.grid.remove(tile.cell);\n\n    if (i !== -1) this.tiles.splice(i, 1);\n    // this.tileGroup.remove(tile.mesh);\n\n    tile.dispose();\n  }\n\n  removeAllTiles() {\n    if (!this.tileGroup) return;\n    var tiles = this.tileGroup.children;\n    for (var i = 0; i < tiles.length; i++) {\n      this.tileGroup.remove(tiles[i]);\n    }\n  }\n\n  getTileAtCell(cell) {\n    var h = this.grid.cellToHash(cell);\n    return cell.tile || (typeof this.grid.cells[h] !== 'undefined' ? this.grid.cells[h].tile : null);\n  }\n\n  snapToGrid(pos) {\n    var cell = this.grid.pixelToCell(pos);\n    pos.copy(this.grid.cellToPixel(cell));\n  }\n\n  snapTileToGrid(tile) {\n    if (tile.cell) {\n      tile.position.copy(this.grid.cellToPixel(tile.cell));\n    }\n    else {\n      var cell = this.grid.pixelToCell(tile.position);\n      tile.position.copy(this.grid.cellToPixel(cell));\n    }\n    return tile;\n  }\n\n  getRandomTile() {\n    var i = TM.Tools.randomInt(0, this.tiles.length - 1);\n    return this.tiles[i];\n  }\n\n  findPath(startTile, endTile, heuristic) {\n    return this.finder.findPath(startTile.cell, endTile.cell, heuristic, this.grid);\n  }\n\n  setGrid(newGrid) {\n    this.group.remove(this.tileGroup);\n    if (this.grid && newGrid !== this.grid) {\n      this.removeAllTiles();\n      this.tiles.forEach(function (t) {\n        this.grid.remove(t.cell);\n        t.dispose();\n      });\n      this.grid.dispose();\n    }\n    this.grid = newGrid;\n    this.tiles = [];\n    this.tileGroup = new THREE.Object3D();\n    this.group.add(this.tileGroup);\n  }\n\n  generateOverlay(size) {\n    var mat = new THREE.LineBasicMaterial({\n      color: 0x000000,\n      opacity: 0.9\n    });\n\n    if (this.overlay) {\n      this.group.remove(this.overlay);\n    }\n\n    this.overlay = new THREE.Object3D();\n\n    this.grid.generateOverlay(size, this.overlay, mat);\n\n    this.group.add(this.overlay);\n  }\n\n  generateTilemap(config) {\n    this.reset();\n\n    var tiles = this.grid.generateTiles(config);\n    this.tiles = tiles;\n\n    this.tileGroup = new THREE.Object3D();\n    for (var i = 0; i < tiles.length; i++) {\n      this.tileGroup.add(tiles[i].mesh);\n    }\n\n    this.group.add(this.tileGroup);\n  }\n\n  generateTerrain() {\n    // reset terrain eventually\n\n    if (this.grid.type === TM.HEX) {\n      var size = this.grid.size;\n      var x, y, z;\n      let i = 0;\n      for (x = -size; x < size + 1; x++) {\n        for (y = -size; y < size + 1; y++) {\n          z = -x - y;\n          if (Math.abs(x) <= size && Math.abs(y) <= size && Math.abs(z) <= size) {\n            var nx = x / this.grid._cellWidth - 0.5, ny = z / this.grid._cellLength - 0.5;\n            var e = (1.00 * TM.Tools.noise1(1 * nx, 1 * ny)\n              + 0.50 * TM.Tools.noise1(2 * nx, 2 * ny)\n              + 0.25 * TM.Tools.noise1(4 * nx, 4 * ny)\n              + 0.13 * TM.Tools.noise1(8 * nx, 8 * ny)\n              + 0.06 * TM.Tools.noise1(16 * nx, 16 * ny)\n              + 0.03 * TM.Tools.noise1(32 * nx, 32 * ny));\n            e /= (1.00 + 0.50 + 0.25 + 0.13 + 0.06 + 0.03);\n            e = Math.pow(e, 5.00);\n            var m = (1.00 * TM.Tools.noise2(1 * nx, 1 * ny)\n              + 0.75 * TM.Tools.noise2(2 * nx, 2 * ny)\n              + 0.33 * TM.Tools.noise2(4 * nx, 4 * ny)\n              + 0.33 * TM.Tools.noise2(8 * nx, 8 * ny)\n              + 0.33 * TM.Tools.noise2(16 * nx, 16 * ny)\n              + 0.50 * TM.Tools.noise2(32 * nx, 32 * ny));\n            m /= (1.00 + 0.75 + 0.33 + 0.33 + 0.33 + 0.50);\n            this.tiles[i].setTerrain(e, m);\n            i++;\n          }\n        }\n      }\n    }\n  }\n\n  reset() {\n    // removes all tiles from the scene, but leaves the grid intact\n    this.removeAllTiles();\n    if (this.tileGroup) this.group.remove(this.tileGroup);\n  }\n}"],"sourceRoot":""}