module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=require("THREE")},function(e,t,i){var n,s;void 0===(s="function"==typeof(n=function(e,t){var i=function(){this.seed=1};i.prototype.nextInt=function(){return this.gen()},i.prototype.nextDouble=function(){return this.gen()/2147483647},i.prototype.nextBoolean=function(){return this.gen()%2==0},i.prototype.nextIntRange=function(e,t){return Math.round(e+(t-e)*this.nextDouble())},i.prototype.nextDoubleRange=function(e,t){return e+(t-e)*this.nextDouble()},i.prototype.gen=function(){return this.seed=16807*this.seed%2147483647},t.create=function(e){var t=new i;return t.seed=void 0===e?1:e,t}})?n.call(t,i,t,e):n)||(e.exports=s)},function(e,t,i){var n;!function(){"use strict";var s=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,a=1/6,r=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;function h(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,i=0,n=1,s=(o=4022871197,function(e){e=e.toString();for(var t=0;t<e.length;t++){var i=.02519603282416938*(o+=e.charCodeAt(t));i-=o=i>>>0,o=(i*=o)>>>0,o+=4294967296*(i-=o)}return 2.3283064365386963e-10*(o>>>0)});var o;e=s(" "),t=s(" "),i=s(" ");for(var a=0;a<arguments.length;a++)(e-=s(arguments[a]))<0&&(e+=1),(t-=s(arguments[a]))<0&&(t+=1),(i-=s(arguments[a]))<0&&(i+=1);return s=null,function(){var s=2091639*e+2.3283064365386963e-10*n;return e=t,t=i,i=s-(n=0|s)}}(e):Math.random,this.p=c(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}function c(e){var t,i=new Uint8Array(256);for(t=0;t<256;t++)i[t]=t;for(t=0;t<255;t++){var n=t+~~(e()*(256-t)),s=i[t];i[t]=i[n],i[n]=s}return i}h.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var i,n,a=this.permMod12,r=this.perm,l=this.grad3,h=0,c=0,u=0,d=(e+t)*s,v=Math.floor(e+d),p=Math.floor(t+d),g=(v+p)*o,m=e-(v-g),f=t-(p-g);m>f?(i=1,n=0):(i=0,n=1);var b=m-i+o,y=f-n+o,_=m-1+2*o,w=f-1+2*o,S=255&v,T=255&p,k=.5-m*m-f*f;if(k>=0){var E=3*a[S+r[T]];h=(k*=k)*k*(l[E]*m+l[E+1]*f)}var O=.5-b*b-y*y;if(O>=0){var D=3*a[S+i+r[T+n]];c=(O*=O)*O*(l[D]*b+l[D+1]*y)}var x=.5-_*_-w*w;if(x>=0){var C=3*a[S+1+r[T+1]];u=(x*=x)*x*(l[C]*_+l[C+1]*w)}return 70*(h+c+u)},noise3D:function(e,t,i){var n,s,o,r,l,h,c,u,d,v,p=this.permMod12,g=this.perm,m=this.grad3,f=(e+t+i)*(1/3),b=Math.floor(e+f),y=Math.floor(t+f),_=Math.floor(i+f),w=(b+y+_)*a,S=e-(b-w),T=t-(y-w),k=i-(_-w);S>=T?T>=k?(l=1,h=0,c=0,u=1,d=1,v=0):S>=k?(l=1,h=0,c=0,u=1,d=0,v=1):(l=0,h=0,c=1,u=1,d=0,v=1):T<k?(l=0,h=0,c=1,u=0,d=1,v=1):S<k?(l=0,h=1,c=0,u=0,d=1,v=1):(l=0,h=1,c=0,u=1,d=1,v=0);var E=S-l+a,O=T-h+a,D=k-c+a,x=S-u+2*a,C=T-d+2*a,M=k-v+2*a,P=S-1+.5,z=T-1+.5,A=k-1+.5,L=255&b,j=255&y,R=255&_,N=.6-S*S-T*T-k*k;if(N<0)n=0;else{var I=3*p[L+g[j+g[R]]];n=(N*=N)*N*(m[I]*S+m[I+1]*T+m[I+2]*k)}var G=.6-E*E-O*O-D*D;if(G<0)s=0;else{var U=3*p[L+l+g[j+h+g[R+c]]];s=(G*=G)*G*(m[U]*E+m[U+1]*O+m[U+2]*D)}var H=.6-x*x-C*C-M*M;if(H<0)o=0;else{var q=3*p[L+u+g[j+d+g[R+v]]];o=(H*=H)*H*(m[q]*x+m[q+1]*C+m[q+2]*M)}var F=.6-P*P-z*z-A*A;if(F<0)r=0;else{var V=3*p[L+1+g[j+1+g[R+1]]];r=(F*=F)*F*(m[V]*P+m[V+1]*z+m[V+2]*A)}return 32*(n+s+o+r)},noise4D:function(e,t,i,n){var s,o,a,h,c,u,d,v,p,g,m,f,b,y,_,w,S,T=this.perm,k=this.grad4,E=(e+t+i+n)*r,O=Math.floor(e+E),D=Math.floor(t+E),x=Math.floor(i+E),C=Math.floor(n+E),M=(O+D+x+C)*l,P=e-(O-M),z=t-(D-M),A=i-(x-M),L=n-(C-M),j=0,R=0,N=0,I=0;P>z?j++:R++,P>A?j++:N++,P>L?j++:I++,z>A?R++:N++,z>L?R++:I++,A>L?N++:I++;var G=P-(u=j>=3?1:0)+l,U=z-(d=R>=3?1:0)+l,H=A-(v=N>=3?1:0)+l,q=L-(p=I>=3?1:0)+l,F=P-(g=j>=2?1:0)+2*l,V=z-(m=R>=2?1:0)+2*l,Y=A-(f=N>=2?1:0)+2*l,W=L-(b=I>=2?1:0)+2*l,B=P-(y=j>=1?1:0)+3*l,X=z-(_=R>=1?1:0)+3*l,Z=A-(w=N>=1?1:0)+3*l,K=L-(S=I>=1?1:0)+3*l,Q=P-1+4*l,J=z-1+4*l,$=A-1+4*l,ee=L-1+4*l,te=255&O,ie=255&D,ne=255&x,se=255&C,oe=.6-P*P-z*z-A*A-L*L;if(oe<0)s=0;else{var ae=T[te+T[ie+T[ne+T[se]]]]%32*4;s=(oe*=oe)*oe*(k[ae]*P+k[ae+1]*z+k[ae+2]*A+k[ae+3]*L)}var re=.6-G*G-U*U-H*H-q*q;if(re<0)o=0;else{var le=T[te+u+T[ie+d+T[ne+v+T[se+p]]]]%32*4;o=(re*=re)*re*(k[le]*G+k[le+1]*U+k[le+2]*H+k[le+3]*q)}var he=.6-F*F-V*V-Y*Y-W*W;if(he<0)a=0;else{var ce=T[te+g+T[ie+m+T[ne+f+T[se+b]]]]%32*4;a=(he*=he)*he*(k[ce]*F+k[ce+1]*V+k[ce+2]*Y+k[ce+3]*W)}var ue=.6-B*B-X*X-Z*Z-K*K;if(ue<0)h=0;else{var de=T[te+y+T[ie+_+T[ne+w+T[se+S]]]]%32*4;h=(ue*=ue)*ue*(k[de]*B+k[de+1]*X+k[de+2]*Z+k[de+3]*K)}var ve=.6-Q*Q-J*J-$*$-ee*ee;if(ve<0)c=0;else{var pe=T[te+1+T[ie+1+T[ne+1+T[se+1]]]]%32*4;c=(ve*=ve)*ve*(k[pe]*Q+k[pe+1]*J+k[pe+2]*$+k[pe+3]*ee)}return 27*(s+o+a+h+c)}},h._buildPermutationTable=c,void 0===(n=function(){return h}.call(t,i,t,e))||(e.exports=n),t.SimplexNoise=h,e.exports=h}()},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.r(t);var o=function(){function e(t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"q",void 0),s(this,"r",void 0),s(this,"s",void 0),s(this,"h",void 0),s(this,"tile",void 0),s(this,"userData",void 0),s(this,"walkable",void 0),s(this,"_calcCost",void 0),s(this,"_priority",void 0),s(this,"_visited",void 0),s(this,"_parent",void 0),s(this,"uniqueID",void 0),this.q=t||0,this.r=i||0,this.s=n||0,this.h=o||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=ve.LinkedList.generateID()}var t,i,o;return t=e,(i=[{key:"set",value:function(e,t,i){return this.q=e,this.r=t,this.s=i,this}},{key:"copy",value:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this}},{key:"add",value:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this}},{key:"equals",value:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},{key:"resetPath",value:function(){this._calcCost=0,this._priority=0,this._parent=null,this._visited=!1}}])&&n(t.prototype,i),o&&n(t,o),e}(),a=i(0);function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"cell",void 0),l(this,"geometry",void 0),l(this,"material",void 0),l(this,"mesh",void 0),l(this,"selected",void 0),l(this,"highlight",void 0),l(this,"userData",void 0),l(this,"entity",void 0),l(this,"position",void 0),l(this,"rotation",void 0),l(this,"uniqueID",void 0),l(this,"objectType",void 0),l(this,"_emissive",void 0);var i={cell:null,geometry:null,material:null};if(t&&(i=ve.Tools.merge(i,t)),!i.cell||!i.geometry)throw new Error("Missing Engine.Tile configuration");this.cell=i.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=ve.Tools.generateID(),this.geometry=i.geometry,this.material=i.material,this.material||(this.material=new a.MeshPhongMaterial({color:ve.Tools.randomizeRGB("0, 105, 148",13)})),this.objectType=ve.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight=33996,this.mesh=new a.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*ve.DEG_TO_RAD,this.mesh.scale.set(i.scale,i.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null}var t,i,n;return t=e,(i=[{key:"select",value:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this}},{key:"deselect",value:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this}},{key:"toggle",value:function(){return this.selected?this.deselect():this.select(),this}},{key:"dispose",value:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},{key:"setTerrain",value:function(e,t){if(this.userData.elevation=e,this.userData.moisture=t,!(e<.02))return e<.06?(this.userData.terrain="BEACH",void this.material.color.set(ve.Tools.randomizeRGB("194,178,128",13))):e<.3?(this.userData.terrain="PLAIN",void this.material.color.set(ve.Tools.randomizeRGB("70,118,58",13))):e<1?(this.userData.terrain="MOUNTAIN",void this.material.color.set(ve.Tools.randomizeRGB("107,110,112",13))):void 0;this.userData.terrain="OCEAN"}}])&&r(t.prototype,i),n&&r(t,n),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),e}function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"gridShape",void 0),d(this,"gridSize",void 0),d(this,"cellSize",void 0),d(this,"cells",void 0),d(this,"numCells",void 0),d(this,"autogenerated",void 0),d(this,"extrudeSettings",void 0),d(this,"cellShape",void 0),d(this,"cellGeo",void 0),d(this,"cellShapeGeo",void 0),d(this,"_cellWidth",void 0),d(this,"_cellLength",void 0),d(this,"_hashDelimeter",void 0),d(this,"_directions",void 0),d(this,"_diagonals",void 0),d(this,"_list",void 0),d(this,"_vec3",void 0),d(this,"_cel",void 0),d(this,"_geoCache",void 0),d(this,"_matCache",void 0);var i,n={gridShape:ve.HEX,gridSize:10,cellSize:10,cellShape:ve.HEX};t&&(n=ve.Tools.merge(n,t)),this.gridShape=n.gridShape,this.gridSize=n.gridSize,this.cellSize=n.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var s=[];for(i=0;i<6;i++)s.push(this._createVertex(i));for(this.cellShape=new a.Shape,this.cellShape.moveTo(s[0].x,s[0].y),i=1;i<6;i++)this.cellShape.lineTo(s[i].x,s[i].y);this.cellShape.lineTo(s[0].x,s[0].y),this.cellShape.autoClose=!0,this.cellGeo=new a.BufferGeometry,this.cellGeo.vertices=s,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new a.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*ve.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new o(1,-1,0),new o(1,0,-1),new o(0,1,-1),new o(-1,1,0),new o(-1,0,1),new o(0,-1,1)],this._diagonals=[new o(2,-1,-1),new o(1,1,-2),new o(-1,2,-1),new o(-2,1,1),new o(-1,-1,2),new o(1,-2,1)],this._list=[],this._vec3=new a.Vector3,this._cel=new o,this._geoCache=[],this._matCache=[],this.generateGrid(n)}return u(e,null,[{key:"TWO_THIRDS",get:function(){return 2/3}}]),u(e,[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3}},{key:"pixelToCell",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),n=(-t.x/3+ve.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,n,-i-n),this._cubeRound(this._cel)}},{key:"getCellAt",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),n=(-t.x/3+ve.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,n,-i-n),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var n,s,o=this._directions.length;for(this._list.length=0,n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);if(null==t||!0===t)for(n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=ve.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e;for(e in this.cells)this.cells[e].resetPath()}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var n=Math.abs(e.h);n<1&&(n=1);var s=this._geoCache[n];s||(this.extrudeSettings.amount=n,s=new a.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=s);var o=new h({scale:t,cell:e,geometry:s,material:i}),r=e.q/this._cellWidth-.5,l=e.s/this._cellLength-.5,c=1*ve.Tools.noise1(1*r,1*l)+.5*ve.Tools.noise1(2*r,2*l)+.25*ve.Tools.noise1(4*r,4*l)+.13*ve.Tools.noise1(8*r,8*l)+.06*ve.Tools.noise1(16*r,16*l)+.03*ve.Tools.noise1(32*r,32*l);c/=1.97,c=Math.pow(c,5);var u=1*ve.Tools.noise2(1*r,1*l)+.75*ve.Tools.noise2(2*r,2*l)+.33*ve.Tools.noise2(4*r,4*l)+.33*ve.Tools.noise2(8*r,8*l)+.33*ve.Tools.noise2(16*r,16*l)+.5*ve.Tools.noise2(32*r,32*l);return u/=3.24,o.setTerrain(c,u),e.tile=o,o}},{key:"generateTiles",value:function(e){e=e||{};var t,i,n,s=[],o={tileScale:.95,extrudeSettings:{amount:10,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in e&&(o=ve.Tools.merge(o,e)),this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,o.tileScale,o.material)).position.copy(this.cellToPixel(n)),i.position.y=0,s.push(i);return s}},{key:"generateGrid",value:function(e){var t;if(this.gridSize=void 0===e.gridSize?this.gridSize:e.gridSize,this.gridShape=void 0===e.gridShape?this.gridShape:e.gridShape,this.gridShape===ve.RCT)for(var i=-this.gridSize;i<this.gridSize;i++)for(var n=i>>1,s=-n;s<this.gridSize-n;s++)t=new o(i,s,-i-s),this.add(t);else if(this.gridShape===ve.HEX){var a,r,l;for(a=-this.gridSize;a<this.gridSize+1;a++)for(r=-this.gridSize;r<this.gridSize+1;r++)l=-a-r,Math.abs(a)<=this.gridSize&&Math.abs(r)<=this.gridSize&&Math.abs(l)<=this.gridSize&&(t=new o(a,r,l),this.add(t))}}},{key:"generateOverlay",value:function(e,t,i){var n,s,o,r=this.cellShape.createPointsGeometry(6);for(n=-e;n<e+1;n++)for(s=-e;s<e+1;s++)if(o=-n-s,Math.abs(n)<=e&&Math.abs(s)<=e&&Math.abs(o)<=e){this._cel.set(n,s,o);var l=new a.Line(r,i);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*ve.DEG_TO_RAD,t.add(l)}t.position.y=.5}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);return this.cells[t]&&(delete this.cells[t],this.numCells--),e}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){var n=this;ve.Tools.getJSON({url:e,callback:function(e){n.fromJSON(e),t.call(i||null,e)},cache:!1,scope:n})}},{key:"fromJSON",value:function(e){var t,i,n=e.cells;this.cells={},this.numCells=0,this.gridSize=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*ve.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated;var s=Object.keys(e).length;for(t=0;t<s;t++)(i=new o).copy(n[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.gridSize,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated,cells:null},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}},{key:"_createVertex",value:function(e){var t=ve.TAU/6*e;return new a.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)}},{key:"_cubeRound",value:function(e){var t=Math.round(e.q),i=Math.round(e.r),n=Math.round(e.s),s=Math.abs(t-e.q),o=Math.abs(i-e.r),a=Math.abs(n-e.s);return s>o&&s>a?t=-i-n:o>a?i=-t-n:n=-t-i,this._cel.set(t,i,n)}}]),e}();function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"gridShape",void 0),g(this,"gridSize",void 0),g(this,"cellSize",void 0),g(this,"cells",void 0),g(this,"numCells",void 0),g(this,"extrudeSettings",void 0),g(this,"cellShape",void 0),g(this,"cellGeo",void 0),g(this,"cellShapeGeo",void 0),g(this,"autogenerated",void 0),g(this,"_fullCellSize",void 0),g(this,"_hashDelimeter",void 0),g(this,"_directions",void 0),g(this,"_diagonals",void 0),g(this,"_list",void 0),g(this,"_vec3",void 0),g(this,"_cel",void 0),g(this,"_geoCache",void 0),g(this,"_matCache",void 0),t=t||{},this.gridShape=ve.SQR,this.gridSize=5,this.cellSize=void 0===t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var i=[];i.push(new a.Vector3),i.push(new a.Vector3(-this.cellSize,this.cellSize)),i.push(new a.Vector3(this.cellSize,this.cellSize)),i.push(new a.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new a.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new a.BufferGeometry,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new a.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new ve.Cell(1,0,0),new ve.Cell(0,-1,0),new ve.Cell(-1,0,0),new ve.Cell(0,1,0)],this._diagonals=[new ve.Cell(-1,-1,0),new ve.Cell(-1,1,0),new ve.Cell(1,1,0),new ve.Cell(1,-1,0)],this._list=[],this._vec3=new a.Vector3,this._cel=new ve.Cell,this._geoCache=[],this._matCache=[],this.generateGrid(t)}var t,i,n;return t=e,(i=[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3}},{key:"pixelToCell",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)}},{key:"getCellAt",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,0,i),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var n,s,o=this._directions.length;for(this._list.length=0,n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);if(t)for(n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=ve.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var n=Math.abs(e.h);n<1&&(n=1);var s=this._geoCache[n];s||(this.extrudeSettings.amount=n,s=new a.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=s);var o=new h({scale:t,cell:e,geometry:s,material:i});return e.tile=o,o}},{key:"generateTiles",value:function(e){e=e||{};var t,i,n,s=[],o={tileScale:.95,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in e&&(o=ve.Tools.merge(o,e)),this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,o.tileScale,null)).position.copy(this.cellToPixel(n)),i.position.y=0,s.push(i);return s}},{key:"generateGrid",value:function(e){var t,i,n;e=e||{},this.gridSize=void 0===e.gridSize?this.gridSize:e.gridSize;var s=Math.ceil(this.gridSize/2);for(t=-s;t<s;t++)for(i=-s;i<s;i++)n=new ve.Cell(t,i+1),this.add(n)}},{key:"generateOverlay",value:function(e,t,i){var n,s,o=Math.ceil(e/2);for(n=-o;n<o;n++)for(s=-o;s<o;s++){this._cel.set(n,s,void 0);var r=new a.Line(this.cellGeo,i);r.position.copy(this.cellToPixel(this._cel)),r.rotation.x=90*ve.DEG_TO_RAD,t.add(r)}}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);return this.cells[t]&&(delete this.cells[t],this.numCells--),e}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){ve.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})}},{key:"fromJSON",value:function(e){var t,i,n=e.cells;for(this.cells={},this.numCells=0,this.gridSize=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(i=new ve.Cell).copy(n[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.gridSize,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}}])&&p(t.prototype,i),n&&p(t,n),e}();function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var y=function e(){b(this,e),this.obj=null,this.next=null,this.prev=null,this.free=!0},_=function(){function e(){b(this,e),this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}var t,i,n;return t=e,n=[{key:"generateID",value:function(e){return Math.random().toString(36).slice(2)+Date.now()}}],(i=[{key:"getNode",value:function(e){return this.objToNodeMap[e.uniqueID]}},{key:"addNode",value:function(t){var i=new y;if(!t.uniqueID)try{t.uniqueID=e.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return i.obj=t,i.free=!1,this.objToNodeMap[t.uniqueID]=i,i}},{key:"swapObjects",value:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t}},{key:"add",value:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")}},{key:"has",value:function(e){return!!this.objToNodeMap[e.uniqueID]}},{key:"moveUp",value:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw Error("Oops, trying to move an object that isn't in the list");if(t.prev){var i=t.prev,n=i.prev;t==this.last&&(this.last=i);var s=t.next;n&&(n.next=t),t.next=i,t.prev=i.prev,i.next=s,i.prev=t,this.first==i&&(this.first=t)}}},{key:"moveDown",value:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}}},{key:"sort",value:function(e){var t,i,n=this.sortArray,s=this.first;for(n.length=0;s;)n.push(s.obj),s=s.next;for(this.clear(),n.sort(e),i=n.length,t=0;t<i;t++)this.add(n[t])}},{key:"remove",value:function(e){var t=this.getNode(e);return!(!t||t.free||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,0))}},{key:"shift",value:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"pop",value:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"concat",value:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next}},{key:"clear",value:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0}},{key:"dispose",value:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null}},{key:"dump",value:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}])&&f(t.prototype,i),n&&f(t,n),e}();function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,t,i){return t&&S(e.prototype,t),i&&S(e,i),e}var k=function(){function e(t,i,n,s,o){w(this,e),this._listener=i,this.isOnce=n,this.context=s,this.signal=t,this._priority=o||0}return T(e,[{key:"execute",value:function(t){var i,n;return e.active&&this._listener&&(n=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,n),this.isOnce&&this.detach()),i}},{key:"detach",value:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null}},{key:"isBound",value:function(){return!!this.signal&&!!this._listener}},{key:"_destroy",value:function(){delete this.signal,delete this._listener,delete this.context}},{key:"toString",value:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+e.active+"]"}}]),e}();k.active=!0,k.params=null;
/**
    * @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
    * @author       Richard Davey <rich@photonstorm.com>
    * @copyright    2014 Photon Storm Ltd.
    * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
    */
var E=function(){function e(){w(this,e),this._bindings=[],this._prevParams=null}return T(e,[{key:"validateListener",value:function(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a.".replace("{fn}",t))}},{key:"_registerListener",value:function(t,i,n,s){var o,a=this._indexOfListener(t,n);if(-1!==a){if((o=this._bindings[a]).isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else o=new k(this,t,i,n,s),this._addBinding(o);return e.memorize&&this._prevParams&&o.execute(this._prevParams),o}},{key:"_addBinding",value:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)}},{key:"_indexOfListener",value:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1}},{key:"has",value:function(e,t){return-1!==this._indexOfListener(e,t)}},{key:"add",value:function(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)}},{key:"addOnce",value:function(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)}},{key:"remove",value:function(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e}},{key:"removeAll",value:function(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)}},{key:"getNumListeners",value:function(){return this._bindings.length}},{key:"halt",value:function(){e._shouldPropagate=!1}},{key:"dispatch",value:function(){if(e.active){var t,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(e.memorize&&(this._prevParams=i),n){t=this._bindings.slice(),e._shouldPropagate=!0;do{n--}while(t[n]&&e._shouldPropagate&&!1!==t[n].execute(i))}}}},{key:"forget",value:function(){this._prevParams=null}},{key:"dispose",value:function(){this.removeAll(),delete this._bindings,delete this._prevParams}},{key:"toString",value:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}]),e}();function O(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}E.memorize=!1,E._shouldPropagate=!0,E.active=!0;var D=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"backtrace",value:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()}},{key:"biBacktrace",value:function(e,t){var i=this.backtrace(e),n=this.backtrace(t);return i.concat(n.reverse())}},{key:"pathLength",value:function(e){var t,i,n,s,o,a=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],s=i[0]-n[0],o=i[1]-n[1],a+=Math.sqrt(s*s+o*o);return a}},{key:"interpolate",value:function(e,t,i,n){var s,o,a,r,l,h,c=Math.abs,u=[];for(s=e<i?1:-1,o=t<n?1:-1,l=(a=c(i-e))-(r=c(n-t));e!==i||t!==n;)u.push([e,t]),(h=2*l)>-r&&(l-=r,e+=s),h<a&&(l+=a,t+=o);return u}},{key:"expandPath",value:function(e){var t,i,n,s,o,a,r=[],l=e.length;if(l<2)return r;for(o=0;o<l-1;++o)for(t=e[o],i=e[o+1],s=(n=this.interpolate(t[0],t[1],i[0],i[1])).length,a=0;a<s-1;++a)r.push(n[a]);return r.push(e[l-1]),r}},{key:"smoothenPath",value:function(e,t){var i,n,s,o,a,r,l,h,c,u,d,v,p=t.length,g=t[0][0],m=t[0][1],f=t[p-1][0],b=t[p-1][1];for(a=[[i=g,n=m]],l=2;l<p;++l){for(s=(c=t[l])[0],o=c[1],u=this.interpolate(i,n,s,o),v=!1,h=1;h<u.length;++h)if(d=u[h],!e.isWalkableAt(d[0],d[1])){v=!0;break}v&&(r=t[l-1],a.push(r),i=r[0],n=r[1])}return a.push([f,b]),a}},{key:"compressPath",value:function(e){if(e.length<3)return e;var t,i,n,s,o,a,r=[],l=e[0][0],h=e[0][1],c=e[1][0],u=e[1][1],d=c-l,v=u-h;for(d/=o=Math.sqrt(d*d+v*v),v/=o,r.push([l,h]),a=2;a<e.length;a++)t=c,i=u,n=d,s=v,d=(c=e[a][0])-t,v=(u=e[a][1])-i,v/=o=Math.sqrt(d*d+v*v),(d/=o)===n&&v===s||r.push([t,i]);return r.push([c,u]),r}}])&&O(t.prototype,i),n&&O(t,n),e}()),x=i(1),C=i.n(x),M=i(2),P=i.n(M);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var A=C.a.create(Date.now()*Math.random()*100),L=C.a.create(Date.now()*Math.random()*100),j=new P.a(A.nextDouble.bind(A)),R=new P.a(L.nextDouble.bind(L));var N={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},noise1:function(e,t){return j.noise2D(e,t)/2+.5},noise2:function(e,t){return R.noise2D(e,t)/2+.5},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!==z(e)||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var i=this,n=Array.isArray(t),s=n&&[]||{};return n?(e=e||[],s=s.concat(e),t.forEach((function(t,n){void 0===s[n]?s[n]=t:i.isPlainObject(t)?s[n]=i.merge(e[n],t):-1===e.indexOf(t)&&s.push(t)})),s):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){s[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&i.isPlainObject(t[n])&&e[n]?s[n]=i.merge(e[n],t[n]):s[n]=t[n]})),s)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,n){if(n=n||31,!((t=t||0)>=(i=i||e.length)-1||n<0)){for(var s=t,o=i,a=1<<n;s<o;)if(e[s]&a){--o;var r=e[s];e[s]=e[o],e[o]=r}else++s;this.radixSort(e,t,o,n-1),this.radixSort(e,o,i,n-1)}},randomizeRGB:function(e,t){var i,n,s=e.split(","),o="rgb(",a=[];for(t=this.randomInt(t),i=0;i<3;i++)(n=parseInt(s[i])+t)<0?n=0:n>255&&(n=255),o+=n+",",a.push(n);return o=o.substring(0,o.length-1),o+=")"},getJSON:function(e){var t=new XMLHttpRequest,i=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}};function I(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G(this,"allowDiagonal",void 0),G(this,"heuristicFilter",void 0),G(this,"list",void 0);var i={allowDiagonal:!1,heuristicFilter:null};t&&(i=N.merge(i,t)),this.allowDiagonal=i.allowDiagonal,this.heuristicFilter=i.heuristicFilter,this.list=new _}var t,i,n;return t=e,(i=[{key:"findPath",value:function(e,t,i,n){var s,o,a,r,l,h;for(i=i||this.heuristicFilter,n.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(s=this.list.shift().obj)._visited=!0,s===t)return D.backtrace(t);for(l=0,h=(a=n.getNeighbors(s,this.allowDiagonal,i)).length;l<h;l++)if((r=a[l]).walkable&&(o=s._calcCost+n.distance(s,r),!r._visited||o<r._calcCost)){if(r._visited=!0,r._parent=s,r._calcCost=o,r._priority=o+n.distance(t,r),r===t)return D.backtrace(t);this.list.add(r)}}return null}},{key:"compare",value:function(e,t){return e._priority-t._priority}}])&&I(t.prototype,i),n&&I(t,n),e}(),H={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new a.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new a.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,n){var s=new a.Texture(null,t);return this.imageLoader.load(e,(function(e){s.image=e,s.needsUpdate=!0,i&&i(s)}),null,(function(e){n&&n(e)})),s.sourceFile=e,s}};function q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var V=function(){function e(t,i,n){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"down",void 0),F(this,"rightDown",void 0),F(this,"pickedObject",void 0),F(this,"selectedObject",void 0),F(this,"allHits",void 0),F(this,"active",void 0),F(this,"shift",void 0),F(this,"ctrl",void 0),F(this,"wheel",void 0),F(this,"position",void 0),F(this,"screenPosition",void 0),F(this,"signal",void 0),F(this,"group",void 0),F(this,"_camera",void 0),F(this,"_raycaster",void 0),F(this,"_preventDefault",void 0),F(this,"element",void 0),this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new a.Vector3,this.screenPosition=new a.Vector2,this.signal=new ve.Signal,this.group=t,this._camera=i,this._raycaster=new a.Raycaster,this._preventDefault=!1,this.element=n||document,this.element.addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),this.element.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),this.element.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),this.element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),this.element.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1),this.element.addEventListener("touchstart",(function(e){s._onDocumentMouseDown(e.touches[0])}),!1),this.element.addEventListener("touchmove",(function(e){s._onDocumentMouseDown(e.touches[0])}),!1),this.element.addEventListener("touchend",(function(e){return s._onDocumentMouseUp(e.touches[0]||e.changedTouches[0])}),!1)}var t,i,n;return t=e,(i=[{key:"dispose",value:function(e){this.signal.removeAll(e),this.element.removeEventListener("mousemove",this._onDocumentMouseDown,!1),this.element.removeEventListener("touchmove",this._onDocumentMouseMove,!1),this.element.removeEventListener("mousedown",this._onDocumentMouseDown,!1),this.element.removeEventListener("touchstart",this._onDocumentMouseDown,!1),this.element.removeEventListener("mouseup",this._onDocumentMouseUp,!1),this.element.removeEventListener("touchend",this._onDocumentMouseUp,!1),this.element.removeEventListener("mousewheel",this._onMouseWheel,!1),this.element.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1)}},{key:"update",value:function(){if(this.active){var e,t,i=this.rayCast();i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!==t&&(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch("over",this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}}},{key:"preventDefault",value:function(){this._preventDefault=!0}},{key:"_onDocumentMouseDown",value:function(e){if((e=e||window.event).preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,this.signal.dispatch("down",this.pickedObject)}},{key:"_onDocumentMouseUp",value:function(e){if(e.preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch("up",this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch("click",this.pickedObject),this.down=1!==e.which&&this.down,this.rightDown=3!==e.which&&this.rightDown}},{key:"_onDocumentMouseMove",value:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1,this.signal.dispatch("move",e)}},{key:"_onMouseWheel",value:function(e){if(this.active){e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch("wheel",this.wheel)}}},{key:"rayCast",value:function(){return this._raycaster.setFromCamera(this.screenPosition,this._camera),this._raycaster.intersectObject(this.group,!0)}}])&&q(t.prototype,i),n&&q(t,n),e}();F(V,"OVER",void 0),F(V,"OUT",void 0),F(V,"DOWN",void 0),F(V,"UP",void 0),F(V,"CLICK",void 0),F(V,"WHEEL",void 0),F(V,"MOVE",void 0),V.OVER="over",V.OUT="out",V.DOWN="down",V.UP="up",V.CLICK="click",V.WHEEL="wheel",V.MOVE="move";var Y=V,W=function(e,t,i){var n,s,o,r,l;this.object=e,this.view=i,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new a.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=10,this.autoRotate=!1,this.autoRotateSpeed=1,this.enableKeys=!0,this.keys={LEFT:65,UP:87,RIGHT:68,BOTTOM:83},this.mouseButtons={LEFT:a.MOUSE.ROTATE,MIDDLE:a.MOUSE.DOLLY,RIGHT:a.MOUSE.PAN},this.touches={ONE:a.TOUCH.DOLLY_PAN,TWO:a.TOUCH.ROTATE},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(c),h.update(),p=v.NONE},this.setZoom=function(e){console.log("set zoom"),h.enableZoom=e,h.enableZoom?h.domElement.addEventListener("wheel",Z,!1):(console.log(h.domElement),h.domElement.removeEventListener("wheel",Z,!1))},this.update=(n=new a.Vector3,s=(new a.Quaternion).setFromUnitVectors(e.up,new a.Vector3(0,1,0)),o=s.clone().inverse(),r=new a.Vector3,l=new a.Quaternion,function(){var e=h.object.position;return n.copy(e).sub(h.target),n.applyQuaternion(s),m.setFromVector3(n),h.autoRotate&&p===v.NONE&&P(2*Math.PI/60/60*h.autoRotateSpeed),h.enableDamping?(m.theta+=f.theta*h.dampingFactor,m.phi+=f.phi*h.dampingFactor):(m.theta+=f.theta,m.phi+=f.phi),m.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,m.theta)),m.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=b,m.radius=Math.max(h.minDistance,Math.min(h.maxDistance,m.radius)),!0===h.enableDamping?h.target.addScaledVector(y,h.dampingFactor):h.target.add(y),n.setFromSpherical(m),n.applyQuaternion(o),e.copy(h.target).add(n),h.object.lookAt(h.target),!0===h.enableDamping?(f.theta*=1-h.dampingFactor,f.phi*=1-h.dampingFactor,y.multiplyScalar(1-h.dampingFactor)):(f.set(0,0,0),y.set(0,0,0)),b=1,!!(_||r.distanceToSquared(h.object.position)>g||8*(1-l.dot(h.object.quaternion))>g)&&(h.dispatchEvent(c),r.copy(h.object.position),l.copy(h.object.quaternion),_=!1,!0)}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",ee,!1),h.domElement.removeEventListener("mousedown",W,!1),h.domElement.removeEventListener("wheel",Z,!1),h.domElement.removeEventListener("touchstart",Q,!1),h.domElement.removeEventListener("touchend",$,!1),h.domElement.removeEventListener("touchmove",J,!1),document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",X,!1),window.removeEventListener("keydown",K,!1)},this.rotateUp=z;var h=this,c={type:"change"},u={type:"start"},d={type:"end"},v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=v.NONE,g=1e-6,m=new a.Spherical,f=new a.Spherical,b=1,y=new a.Vector3,_=!1,w=new a.Vector2,S=new a.Vector2,T=new a.Vector2,k=new a.Vector2,E=new a.Vector2,O=new a.Vector2,D=new a.Vector2,x=new a.Vector2,C=new a.Vector2;function M(){return Math.pow(.95,h.zoomSpeed)}function P(e){f.theta-=e}function z(e){f.phi-=e}var A,L=(A=new a.Vector3,function(e,t){A.setFromMatrixColumn(t,0),A.multiplyScalar(-e),y.add(A)}),j=function(){var e=new a.Vector3;return function(t,i){!0===h.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(h.object.up,e)),e.multiplyScalar(t),y.add(e)}}();function R(e){h.object.isPerspectiveCamera?b/=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function N(e){h.object.isPerspectiveCamera?b*=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function I(e){w.set(e.clientX,e.clientY)}function G(e){k.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,i)}}function H(e){if(1==e.touches.length)k.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);k.set(t,i)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);D.set(0,n)}function F(e){if(1==e.touches.length)S.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(t,i)}T.subVectors(S,w).multiplyScalar(h.rotateSpeed);var n=h.domElement===document?h.domElement.body:h.domElement;P(2*Math.PI*T.x/n.clientHeight),z(2*Math.PI*T.y/n.clientHeight),w.copy(S)}function V(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,i)}O.subVectors(E,k).multiplyScalar(h.panSpeed),h.pan(O.x,O.y),k.copy(E)}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);x.set(0,n),C.set(0,Math.pow(x.y/D.y,h.zoomSpeed)),R(C.y),D.copy(x)}function W(e){if(!1!==h.enabled){switch(e.preventDefault(),h.domElement.focus?h.domElement.focus():window.focus(),e.button){case 0:switch(h.mouseButtons.LEFT){case a.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enablePan)return;if(null===h.view._mouseCaster.pickedObject)return;for(;h.view.controls.animations.length>=1;)h.view.controls.cancelAnimation();G(e),p=v.PAN}else{if(!1===h.enableRotate)return;I(e),p=v.ROTATE}break;case a.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enableRotate)return;I(e),p=v.ROTATE}else{if(!1===h.enablePan)return;if(null===h.view._mouseCaster.pickedObject)return;G(e),p=v.PAN}break;default:p=v.NONE}break;case 1:switch(h.mouseButtons.MIDDLE){case a.MOUSE.DOLLY:if(!1===h.enableZoom)return;!function(e){D.set(e.clientX,e.clientY)}(e),p=v.DOLLY;break;default:p=v.NONE}break;case 2:switch(h.mouseButtons.RIGHT){case a.MOUSE.ROTATE:if(!1===h.enableRotate)return;I(e),p=v.ROTATE;break;case a.MOUSE.PAN:if(!1===h.enablePan)return;if(null===h.view._mouseCaster.pickedObject)return;G(e),p=v.PAN;break;default:p=v.NONE}}p!==v.NONE&&(document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",X,!1),h.dispatchEvent(u))}}function B(e){if(!1!==h.enabled)switch(e.preventDefault(),p){case v.ROTATE:if(!1===h.enableRotate)return;!function(e){S.set(e.clientX,e.clientY),T.subVectors(S,w).multiplyScalar(h.rotateSpeed);var t=h.domElement===document?h.domElement.body:h.domElement;P(2*Math.PI*T.x/t.clientHeight),z(2*Math.PI*T.y/t.clientHeight),w.copy(S),h.update()}(e);break;case v.DOLLY:if(!1===h.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),C.subVectors(x,D),C.y>0?R(M()):C.y<0&&N(M()),D.copy(x),h.update()}(e);break;case v.PAN:if(!1===h.enablePan)return;!function(e){for(;h.view.controls.animations.length>=1;)h.view.controls.cancelAnimation();E.set(e.clientX,e.clientY),O.subVectors(E,k).multiplyScalar(h.panSpeed),h.pan(O.x,O.y);var t=h.view.map.grid.pixelToCell(h.object.position);h.view.map.getTileAtCell(t)||h.pan(-O.x,-O.y),k.copy(E),h.update()}(e)}}function X(e){!1!==h.enabled&&(document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",X,!1),h.dispatchEvent(d),p=v.NONE)}function Z(e){!1===h.enabled||!1===h.enableZoom||p!==v.NONE&&p!==v.ROTATE||(e.preventDefault(),h.dispatchEvent(u),function(e){e.deltaY<0?N(M()):e.deltaY>0&&R(M()),h.update()}(e),h.dispatchEvent(d))}function K(e){!1!==h.enabled&&!1!==h.enableKeys&&!1!==h.enablePan&&function(e){var t=!1;switch(e.keyCode){case h.keys.UP:h.pan(0,h.keyPanSpeed),t=!0;break;case h.keys.BOTTOM:h.pan(0,-h.keyPanSpeed),t=!0;break;case h.keys.LEFT:h.pan(h.keyPanSpeed,0),t=!0;break;case h.keys.RIGHT:h.pan(-h.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),h.update())}(e)}function Q(e){if(!1!==h.enabled){switch(e.touches.length){case 1:switch(h.touches.ONE){case a.TOUCH.ROTATE:if(!1===h.enableRotate)return;U(e),p=v.TOUCH_ROTATE;break;case a.TOUCH.PAN:if(!1===h.enablePan)return;H(e),p=v.TOUCH_PAN;break;default:p=v.NONE}break;case 2:switch(h.touches.TWO){case a.TOUCH.DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;!function(e){h.enableZoom&&q(e),h.enablePan&&H(e)}(e),p=v.TOUCH_DOLLY_PAN;break;case a.TOUCH.DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;!function(e){h.enableZoom&&q(e),h.enableRotate&&U(e)}(e),p=v.TOUCH_DOLLY_ROTATE;break;default:p=v.NONE}break;default:p=v.NONE}p!==v.NONE&&h.dispatchEvent(u)}}function J(e){if(!1!==h.enabled)switch(e.preventDefault(),p){case v.TOUCH_ROTATE:if(!1===h.enableRotate)return;F(e),h.update();break;case v.TOUCH_PAN:if(!1===h.enablePan)return;V(e),h.update();break;case v.TOUCH_DOLLY_PAN:if(!1===h.enableZoom&&!1===h.enablePan)return;!function(e){h.enableZoom&&Y(e),h.enablePan&&V(e)}(e),h.update();break;case v.TOUCH_DOLLY_ROTATE:if(!1===h.enableZoom&&!1===h.enableRotate)return;!function(e){h.enableZoom&&Y(e),h.enableRotate&&F(e)}(e),h.update();break;default:p=v.NONE}}function $(e){!1!==h.enabled&&(h.dispatchEvent(d),p=v.NONE)}function ee(e){!1!==h.enabled&&e.preventDefault()}this.pan=function(){var e=new a.Vector3;return function(t,i){var n=h.domElement===document?h.domElement.body:h.domElement;if(h.object.isPerspectiveCamera){var s=h.object.position;e.copy(s).sub(h.target);var o=e.length();o*=Math.tan(h.object.fov/2*Math.PI/180),L(2*t*o/n.clientHeight,h.object.matrix),j(2*i*o/n.clientHeight,h.object.matrix)}else h.object.isOrthographicCamera?(L(t*(h.object.right-h.object.left)/h.object.zoom/n.clientWidth,h.object.matrix),j(i*(h.object.top-h.object.bottom)/h.object.zoom/n.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)}}(),h.domElement.addEventListener("contextmenu",ee,!1),h.domElement.addEventListener("mousedown",W,!1),h.domElement.addEventListener("wheel",Z,!1),h.domElement.addEventListener("touchstart",Q,!1),h.domElement.addEventListener("touchend",$,!1),h.domElement.addEventListener("touchmove",J,!1),window.addEventListener("keydown",K,!1),this.update()};W.prototype=Object.create(a.EventDispatcher.prototype),W.prototype.constructor=W;var B=function(e,t){W.call(this,e,t),this.mouseButtons.LEFT=a.MOUSE.PAN,this.mouseButtons.RIGHT=a.MOUSE.ROTATE,this.touches.ONE=a.TOUCH.PAN,this.touches.TWO=a.TOUCH.DOLLY_ROTATE};function X(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}(B.prototype=Object.create(a.EventDispatcher.prototype)).constructor=B;var K=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.easeInOutQuad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.durationMs=t,this.update=i,this.easingFunction=n,Z(this,"progress",0)}var t,i,n;return t=e,(i=[{key:"animate",value:function(e){return this.progress=this.progress+1e3*e/this.durationMs,this.update(this.easingFunction(this.progress)),this.progress>=1}}])&&X(t.prototype,i),n&&X(t,n),e}();function Q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t,i){return t&&Q(e.prototype,t),i&&Q(e,i),e}Z(K,"easeInOutQuad",(function(e){return e<.5?2*e*e:(4-2*e)*e-1})),Z(K,"easeLinear",(function(e){return e}));var $=function(){function e(t,i){var n,s,o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=t,o=void 0,(s="controls")in(n=this)?Object.defineProperty(n,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[s]=o,!t)throw new Error("Controller missing View reference");i?this._initControls(i):(this._view.controlled=!1,this.controls=new W(this._view.camera,this._view.renderer.domElement,this._view))}return J(e,[{key:"active",set:function(e){this._view.controlled=e},get:function(){return this._view.controlled}}]),J(e,[{key:"_initControls",value:function(e){this._view.controlled=e.controlled,this.controls=new W(this._view.camera,this._view.renderer.domElement,this._view),this.controls.minDistance=e.minDistance,this.controls.maxDistance=e.maxDistance,this.controls.zoomSpeed=e.zoomSpeed,this._view.hotEdges=e.hotEdges,this.controls.autoRotate=e.autoRotate,this.controls.enableDamping=e.enableDamping,this.controls.dampingFactor=e.dampingFactor,this.controls.screenSpacePanning=e.screenSpacePanning,this.controls.minPolarAngle=e.minPolarAngle,this.controls.maxPolarAngle=e.maxPolarAngle,e.horizontalRotation||(e.maxAzimuthAngle&&(this.controls.maxAzimuthAngle=e.maxAzimuthAngle),e.minAzimuthAngle&&(this.controls.minAzimuthAngle=e.minAzimuthAngle)),this.controls.mouseButtons={LEFT:a.MOUSE.RIGHT,MIDDLE:a.MOUSE.MIDDLE,RIGHT:a.MOUSE.LEFT}}},{key:"update",value:function(){this.controls.update()}},{key:"dispose",value:function(){this.controls.dispose()}},{key:"panInDirection",value:function(e,t,i,n){this._view.animationManager.animations.length>=1&&this._view.animationManager.cancelAnimation(),e&&i?this.controls.pan(15,15):e&&n?this.controls.pan(15,-15):t&&i?this.controls.pan(-15,15):t&&n?this.controls.pan(-15,-15):t?this.controls.pan(-15,0):e?this.controls.pan(15,0):i?this.controls.pan(0,15):this.controls.pan(0,-15),this.controls.update()}},{key:"panCameraTo",value:function(e,t){var i=this;e instanceof o&&(e=e.tile);var n=this.controls.target.clone(),s=e.position.clone();this._view.animationManager.addAnimation(new K(t,(function(t){i._view.focusOn(e),i.controls.target=n.lerp(s,t),i.controls.update()}))),this._view.animationManager.animations.length>1&&this._view.animationManager.cancelAnimation()}},{key:"toggleControls",value:function(){this._view.controlled?this._view.controlled=!1:this._view.controlled=!0}},{key:"updateControlSettings",value:function(e){this._view.settings.cameraControlSettings=ve.Tools.merge(this._view.settings.cameraControlSettings,e),this.controls.minDistance=e.minDistance||this.controls.minDistance,this.controls.maxDistance=e.maxDistance||this.controls.maxDistance,this.controls.zoomSpeed=e.zoomSpeed||this.controls.zoomSpeed,void 0!==e.hotEdges?this._view.hotEdges=e.hotEdges:this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,void 0!==e.autoRotate?(this.toggleHorizontalRotation(e.autoRotate),this.controls.autoRotate=e.autoRotate):this.controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,void 0!==e.enableDamping?this.controls.enableDamping=e.enableDamping:this.controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this.controls.dampingFactor=e.dampingFactor||this._view.settings.cameraControlSettings.dampingFactor,void 0!==e.screenSpacePanning?this.controls.screenSpacePanning=e.screenSpacePanning:this.controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,e.minPolarAngle&&(this.controls.minPolarAngle=e.minPolarAngle),e.maxPolarAngle&&(this.controls.maxPolarAngle=e.maxPolarAngle),e.maxAzimuthAngle&&(this.controls.maxAzimuthAngle=e.maxAzimuthAngle),e.minAzimuthAngle&&(this.controls.minAzimuthAngle=e.minAzimuthAngle)}},{key:"toggleHorizontalRotation",value:function(e){e?(this.controls.dispose(),this.controls=new W(this._view.camera,this._view.renderer.domElement,this._view),this.controls.minDistance=this._view.settings.cameraControlSettings.minDistance,this.controls.maxDistance=this._view.settings.cameraControlSettings.maxDistance,this.controls.zoomSpeed=this._view.settings.cameraControlSettings.zoomSpeed,this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,this.controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,this.controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this.controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,this.controls.minPolarAngle=this._view.settings.cameraControlSettings.minPolarAngle,this.controls.maxPolarAngle=this._view.settings.cameraControlSettings.maxPolarAngle,this.controls.mouseButtons={LEFT:a.MOUSE.RIGHT,MIDDLE:a.MOUSE.MIDDLE,RIGHT:a.MOUSE.LEFT}):(this.controls.dispose(),this.controls=new W(this._view.camera,this._view.renderer.domElement,this._view),this.controls.minDistance=this._view.settings.cameraControlSettings.minDistance,this.controls.maxDistance=this._view.settings.cameraControlSettings.maxDistance,this.controls.zoomSpeed=this._view.settings.cameraControlSettings.zoomSpeed,this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,this.controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,this.controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this.controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,this.controls.minPolarAngle=this._view.settings.cameraControlSettings.minPolarAngle,this.controls.maxPolarAngle=this._view.settings.cameraControlSettings.maxPolarAngle,this._view.settings.cameraControlSettings.maxAzimuthAngle&&(this.controls.maxAzimuthAngle=this._view.settings.cameraControlSettings.maxAzimuthAngle),this._view.settings.cameraControlSettings.minAzimuthAngle&&(this.controls.minAzimuthAngle=this._view.settings.cameraControlSettings.minAzimuthAngle),this.controls.mouseButtons={LEFT:a.MOUSE.RIGHT,MIDDLE:a.MOUSE.MIDDLE,RIGHT:a.MOUSE.LEFT})}},{key:"rotateUp",value:function(e){this.controls.rotateUp(e)}}]),e}();function ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ie=function(){function e(t,i,n,s){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.container=i,this.camera=n,te(this,"animations",[]),te(this,"_lastTimestamp",performance.now()),te(this,"_animationID",void 0),te(this,"_onAnimate",{}),te(this,"_paused",!1);s&&(this._onAnimate[this.genID()]=s),this._onAnimate[this.genID()]=function(e){for(var t=o.animations,i=0;i<t.length;i++){var n=t[i];if(n)n.animate(e)&&(t[i]=t[t.length-1],t[t.length-1]=n,t.pop())}}}var t,i,n;return t=e,(i=[{key:"addOnAnimate",value:function(e){var t=this.genID();return this._onAnimate[t]=e,t}},{key:"addAnimation",value:function(e){this.animations.push(e)}},{key:"cancelOnAnimate",value:function(e){delete this._onAnimate[e]}},{key:"cancelAnimation",value:function(){this.animations.shift()}},{key:"dispose",value:function(){window.cancelAnimationFrame(this._animationID),delete this.animations}},{key:"animate",value:function(e){if(!this._paused){var t=(e-this._lastTimestamp)/1e3;for(var i in this._lastTimestamp=e,this._onAnimate)this._onAnimate[i](t)}this.renderer.render(this.container,this.camera),this._animationID=requestAnimationFrame(this.animate.bind(this))}},{key:"toggleAnimationLoop",value:function(){this._paused=!this._paused}},{key:"genID",value:function(){return"_"+Math.random().toString(36).substr(2,9)}},{key:"paused",set:function(e){this._paused=e}}])&&ee(t.prototype,i),n&&ee(t,n),e}();function ne(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var oe=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),se(this,"map",void 0),se(this,"width",void 0),se(this,"height",void 0),se(this,"renderer",void 0),se(this,"container",void 0),se(this,"camera",void 0),se(this,"controlled",void 0),se(this,"settings",void 0),se(this,"controls",void 0),se(this,"animationManager",void 0),se(this,"_selectedTile",void 0),se(this,"_onTileSelected",void 0),se(this,"_onLoaded",void 0),se(this,"_mouseCaster",void 0),se(this,"_hoverTile",void 0),se(this,"hotEdges",void 0),se(this,"_panning",!1),se(this,"_panningLeft",!1),se(this,"_panningRight",!1),se(this,"_panningUp",!1),se(this,"_panningDown",!1),i=i||{};var n={element:document.body,alpha:!0,antialias:!0,clearColor:"0x6495ED",sortObjects:!1,fog:null,light:new a.DirectionalLight(16777215),lightPosition:null,cameraPosition:null,sceneMarginSize:20,cameraControlSettings:{controlled:!0,enableDamping:!1,dampingFactor:.05,minDistance:25,maxDistance:1250,zoomSpeed:3,hotEdges:!0,autoRotate:!1,screenSpacePanning:!1,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/3,minAzimuthAngle:0,maxAzimuthAngle:-Math.PI,horizontalRotation:!1}};i.cameraControlSettings&&(n.cameraControlSettings=N.merge(n.cameraControlSettings,i.cameraControlSettings)),i&&(n=N.merge(n,i)),this.settings=n,this._initSceneSettings(),this.attachTo(n.element),this.addMap(t),this.animationManager.animate(0)}var t,i,n;return t=e,(i=[{key:"add",value:function(e){this.container.add(e)}},{key:"addMap",value:function(e){this.map=e,this.container.add(e.group)}},{key:"attachTo",value:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)}},{key:"dispose",value:function(){window.removeEventListener("resize",this.onWindowResize,!1),this.controls.dispose(),this._mouseCaster.dispose(this),this.animationManager.dispose(),delete this.animationManager,delete this.container,delete this.camera,delete this.controls,delete this._mouseCaster}},{key:"focusOn",value:function(e){e instanceof h&&(e=e.position),this.camera.lookAt(e)}},{key:"panCameraTo",value:function(e,t){this.controls.panCameraTo(e,t)}},{key:"panInDirection",value:function(e,t,i,n){this.controls.panInDirection(e,t,i,n)}},{key:"remove",value:function(e){this.container.remove(e)}},{key:"toggleAnimationLoop",value:function(){this.animationManager.toggleAnimationLoop()}},{key:"toggleControls",value:function(){this.controls.toggleControls()}},{key:"toggleHorizontalRotation",value:function(e){this.controls.toggleHorizontalRotation(e)}},{key:"updateControlSettings",value:function(e){this.controls.updateControlSettings(e)}},{key:"updateSettings",value:function(e){this.updateControlSettings(e.cameraControlSettings)}},{key:"_initSceneSettings",value:function(){this.renderer=new a.WebGLRenderer({alpha:this.settings.alpha,antialias:this.settings.antialias}),this.renderer.setClearColor(6591981),this.renderer.sortObjects=this.settings.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight;var e=this,t=document.createElement("div");t.style.cssText="position:absolute;left:0;height:100%;width:"+this.settings.sceneMarginSize+"px;",t.addEventListener("mouseover",(function(){e._panning=!0,e._panningLeft=!0}),!1),t.addEventListener("mouseleave",(function(){e._panning=!1,e._panningLeft=!1}),!1);var i=document.createElement("div");i.style.cssText="position:absolute;top:0;width:100%;height:"+this.settings.sceneMarginSize+"px;",i.addEventListener("mouseover",(function(){e._panning=!0,e._panningUp=!0}),!1),i.addEventListener("mouseleave",(function(){e._panning=!1,e._panningUp=!1}),!1);var n=document.createElement("div");n.style.cssText="position:absolute;left:0;top:0;height:"+this.settings.sceneMarginSize+"px;width:"+this.settings.sceneMarginSize+"px",n.addEventListener("mouseenter",(function(){e._panning=!0,e._panningUp=!0,e._panningLeft=!0}),!1),n.addEventListener("mouseleave",(function(){e._panning=!1,e._panningUp=!1,e._panningLeft=!1}),!1);var s=document.createElement("div");s.style.cssText="position:absolute;right:0;height:100%;width:"+this.settings.sceneMarginSize+"px;",s.addEventListener("mouseover",(function(){e._panning=!0,e._panningRight=!0}),!1),s.addEventListener("mouseleave",(function(){e._panning=!1,e._panningRight=!1}),!1);var o=document.createElement("div");o.style.cssText="position:absolute;right:0;top:0;height:"+this.settings.sceneMarginSize+"px;width:"+this.settings.sceneMarginSize+"px",o.addEventListener("mouseenter",(function(){e._panning=!0,e._panningUp=!0,e._panningRight=!0}),!1),o.addEventListener("mouseleave",(function(){e._panning=!1,e._panningUp=!1,e._panningRight=!1}),!1);var r=document.createElement("div");r.style.cssText="position:absolute;bottom:0;width:100%;height:"+this.settings.sceneMarginSize+"px;",r.addEventListener("mouseover",(function(){e._panning=!0,e._panningDown=!0}),!1),r.addEventListener("mouseleave",(function(){e._panning=!1,e._panningDown=!1}),!1);var l=document.createElement("div");l.style.cssText="position:absolute;left:0;bottom:0;height:"+this.settings.sceneMarginSize+"px;width:"+this.settings.sceneMarginSize+"px",l.addEventListener("mouseenter",(function(){e._panning=!0,e._panningDown=!0,e._panningLeft=!0}),!1),l.addEventListener("mouseleave",(function(){e._panning=!1,e._panningDown=!1,e._panningLeft=!1}),!1);var h=document.createElement("div");if(h.style.cssText="position:absolute;right:0;bottom:0;height:"+this.settings.sceneMarginSize+"px;width:"+this.settings.sceneMarginSize+"px",h.addEventListener("mouseenter",(function(){e._panning=!0,e._panningDown=!0,e._panningRight=!0}),!1),h.addEventListener("mouseleave",(function(){e._panning=!1,e._panningDown=!1,e._panningRight=!1}),!1),this.settings.element.appendChild(t),this.settings.element.appendChild(i),this.settings.element.appendChild(n),this.settings.element.appendChild(s),this.settings.element.appendChild(o),this.settings.element.appendChild(r),this.settings.element.appendChild(l),this.settings.element.appendChild(h),this.container=new a.Scene,this.container.fog=this.settings.fog,this.container.add(new a.AmbientLight(14540253)),this.settings.lightPosition){var c=this.settings.lightPosition;this.settings.light.position.set(c.x,c.y,c.z).normalize(),this.settings.light.intensity=1.2}else this.settings.light.position.set(1,1,3).normalize(),this.settings.light.intensity=1.2;this.container.add(this.settings.light),this.camera=new a.PerspectiveCamera(50,this.width/this.height,1,5e3),this.settings.cameraPosition&&this.camera.position.copy(this.settings.cameraPosition),this._initControls(this.settings.cameraControlSettings),this._initMouseCaster(),this._initAnimationManager(),this.settings.element.addEventListener("resize",this.onWindowResize.bind(this),!1)}},{key:"_initControls",value:function(e){this.controls=new $(this,e)}},{key:"_initAnimationManager",value:function(){var e=this;this.animationManager=new ie(this.renderer,this.container,this.camera,function(){e.controlled&&e.hotEdges&&e._panning&&e._hoverTile&&e.panInDirection(e._panningLeft,e._panningRight,e._panningUp,e._panningDown),e.controls.update(),e._mouseCaster.update()}.bind(this))}},{key:"_initMouseCaster",value:function(){this._mouseCaster=new Y(this.container,this.camera);var e=this;this._mouseCaster.signal.add((function(t,i){if(e.controlled){if(t===Y.CLICK){e.controls.panCameraTo(i,2500);var n=e.map.grid.pixelToCell(e._mouseCaster.position),s=e.map.getTileAtCell(n);s&&s.toggle()}t===Y.OVER&&null!==i&&(i.select(),e._hoverTile=i),t===Y.OUT&&null!==i&&(i.deselect(),e._hoverTile=null)}}),this)}},{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height,!0)}},{key:"mouseCaster",set:function(e){this._mouseCaster=e}},{key:"onLoaded",set:function(e){this._onLoaded=e}},{key:"onTileSelected",set:function(e){this._onTileSelected=e}},{key:"selectedTile",get:function(){return this._selectedTile}}])&&ne(t.prototype,i),n&&ne(t,n),e}();function ae(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mouse=t,this.onSelect=new ve.Signal,this.onDeselect=new ve.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)}var t,i,n;return t=e,(i=[{key:"select",value:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))}},{key:"clearSelection",value:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null}},{key:"onMouse",value:function(e,t){switch(e){case ve.MouseCaster.DOWN:t||this.clearSelection();break;case ve.MouseCaster.CLICK:this.select(t)}}}])&&ae(t.prototype,i),n&&ae(t,n),e}();function le(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function he(e,t,i){return t&&le(e.prototype,t),i&&le(e,i),e}function ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ue=function(){function e(t,i,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce(this,"grid",void 0),ce(this,"pathFinder",void 0),ce(this,"tiles",void 0),ce(this,"group",void 0),ce(this,"tileGroup",void 0),ce(this,"tileOverlay",void 0),!t)throw new Error("You must pass in a grid system for the map to use.");this.tiles=[],this.tileGroup=null,this.group=new a.Object3D,this.grid=null,this.tileOverlay=null,this.pathFinder=new ve.AStarFinder(n),ve.Loader.init(),this.setGrid(t),this.generateTiles(i)}return he(e,[{key:"dispose",value:function(){delete this.tiles,delete this.tileGroup,delete this.group,delete this.tileOverlay,delete this.pathFinder}}]),he(e,[{key:"setEntityOnTile",value:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e}},{key:"addTile",value:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)}},{key:"removeTile",value:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}}},{key:"removeAllTiles",value:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])}},{key:"getTileAtCell",value:function(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)}},{key:"snapToGrid",value:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))}},{key:"snapTileToGrid",value:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e}},{key:"getRandomTile",value:function(){var e=ve.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]}},{key:"findPath",value:function(e,t,i){return this.pathFinder.findPath(e.cell,t.cell,i,this.grid)}},{key:"setGrid",value:function(e){if(this.group.remove(this.tileGroup),this.grid&&e!==this.grid){this.removeAllTiles();var t=this;this.tiles.forEach((function(e){t.grid.remove(e.cell),e.dispose()})),this.grid.dispose()}this.grid=e,this.tiles=[],this.tileGroup=new a.Object3D,this.group.add(this.tileGroup)}},{key:"generateOverlay",value:function(e){var t=new a.LineBasicMaterial({color:0,opacity:.9});this.tileOverlay&&this.group.remove(this.tileOverlay),this.tileOverlay=new a.Object3D,this.grid.generateOverlay(e,this.tileOverlay,t),this.group.add(this.tileOverlay)}},{key:"generateTiles",value:function(e){var t={tileScale:.965,extrudeSettings:{amount:10,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};e&&(t=ve.Tools.merge(t,e)),this.reset();var i=this.tiles=this.grid.generateTiles(t);this.tileGroup=new a.Object3D;for(var n=0;n<i.length;n++)this.tileGroup.add(i[n].mesh);this.group.add(this.tileGroup)}},{key:"reset",value:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}}]),e}();i.d(t,"Engine",(function(){return de}));var de={VERSION:"1.0.0",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),Cell:o,Grid:function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&void 0!==t.cellShape&&t.cellShape!==ve.HEX?t.cellShape===ve.SQR?new m(t):void 0:new v(t)},HexGrid:v,SqrGrid:m,Tile:h,LinkedList:_,Signal:E,AStarFinder:U,PathUtil:D,Loader:H,MouseCaster:Y,View:oe,SelectionManager:re,Tools:N,Map:ue,TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",RCT:"rectangle",ABS:"abstract"},ve=t.default=de}]);
//# sourceMappingURL=index.js.map