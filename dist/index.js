module.exports=function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t){e.exports=require("THREE")},function(e,t,i){var s,r;void 0===(r="function"==typeof(s=function(e,t){var i=function(){this.seed=1};i.prototype.nextInt=function(){return this.gen()},i.prototype.nextDouble=function(){return this.gen()/2147483647},i.prototype.nextBoolean=function(){return this.gen()%2==0},i.prototype.nextIntRange=function(e,t){return Math.round(e+(t-e)*this.nextDouble())},i.prototype.nextDoubleRange=function(e,t){return e+(t-e)*this.nextDouble()},i.prototype.gen=function(){return this.seed=16807*this.seed%2147483647},t.create=function(e){var t=new i;return t.seed=void 0===e?1:e,t}})?s.call(t,i,t,e):s)||(e.exports=r)},function(e,t,i){var s;!function(){"use strict";var r=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,o=1/6,l=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20;function h(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,i=0,s=1,r=(n=4022871197,function(e){e=e.toString();for(var t=0;t<e.length;t++){var i=.02519603282416938*(n+=e.charCodeAt(t));i-=n=i>>>0,n=(i*=n)>>>0,n+=4294967296*(i-=n)}return 2.3283064365386963e-10*(n>>>0)});var n;e=r(" "),t=r(" "),i=r(" ");for(var o=0;o<arguments.length;o++)(e-=r(arguments[o]))<0&&(e+=1),(t-=r(arguments[o]))<0&&(t+=1),(i-=r(arguments[o]))<0&&(i+=1);return r=null,function(){var r=2091639*e+2.3283064365386963e-10*s;return e=t,t=i,i=r-(s=0|r)}}(e):Math.random,this.p=c(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}function c(e){var t,i=new Uint8Array(256);for(t=0;t<256;t++)i[t]=t;for(t=0;t<255;t++){var s=t+~~(e()*(256-t)),r=i[t];i[t]=i[s],i[s]=r}return i}h.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var i,s,o=this.permMod12,l=this.perm,a=this.grad3,h=0,c=0,u=0,d=(e+t)*r,p=Math.floor(e+d),m=Math.floor(t+d),g=(p+m)*n,v=e-(p-g),f=t-(m-g);v>f?(i=1,s=0):(i=0,s=1);var b=v-i+n,_=f-s+n,T=v-1+2*n,w=f-1+2*n,S=255&p,y=255&m,O=.5-v*v-f*f;if(O>=0){var x=3*o[S+l[y]];h=(O*=O)*O*(a[x]*v+a[x+1]*f)}var D=.5-b*b-_*_;if(D>=0){var E=3*o[S+i+l[y+s]];c=(D*=D)*D*(a[E]*b+a[E+1]*_)}var M=.5-T*T-w*w;if(M>=0){var z=3*o[S+1+l[y+1]];u=(M*=M)*M*(a[z]*T+a[z+1]*w)}return 70*(h+c+u)},noise3D:function(e,t,i){var s,r,n,l,a,h,c,u,d,p,m=this.permMod12,g=this.perm,v=this.grad3,f=(e+t+i)*(1/3),b=Math.floor(e+f),_=Math.floor(t+f),T=Math.floor(i+f),w=(b+_+T)*o,S=e-(b-w),y=t-(_-w),O=i-(T-w);S>=y?y>=O?(a=1,h=0,c=0,u=1,d=1,p=0):S>=O?(a=1,h=0,c=0,u=1,d=0,p=1):(a=0,h=0,c=1,u=1,d=0,p=1):y<O?(a=0,h=0,c=1,u=0,d=1,p=1):S<O?(a=0,h=1,c=0,u=0,d=1,p=1):(a=0,h=1,c=0,u=1,d=1,p=0);var x=S-a+o,D=y-h+o,E=O-c+o,M=S-u+2*o,z=y-d+2*o,C=O-p+2*o,P=S-1+.5,j=y-1+.5,L=O-1+.5,R=255&b,A=255&_,N=255&T,k=.6-S*S-y*y-O*O;if(k<0)s=0;else{var G=3*m[R+g[A+g[N]]];s=(k*=k)*k*(v[G]*S+v[G+1]*y+v[G+2]*O)}var H=.6-x*x-D*D-E*E;if(H<0)r=0;else{var I=3*m[R+a+g[A+h+g[N+c]]];r=(H*=H)*H*(v[I]*x+v[I+1]*D+v[I+2]*E)}var U=.6-M*M-z*z-C*C;if(U<0)n=0;else{var q=3*m[R+u+g[A+d+g[N+p]]];n=(U*=U)*U*(v[q]*M+v[q+1]*z+v[q+2]*C)}var V=.6-P*P-j*j-L*L;if(V<0)l=0;else{var Y=3*m[R+1+g[A+1+g[N+1]]];l=(V*=V)*V*(v[Y]*P+v[Y+1]*j+v[Y+2]*L)}return 32*(s+r+n+l)},noise4D:function(e,t,i,s){var r,n,o,h,c,u,d,p,m,g,v,f,b,_,T,w,S,y=this.perm,O=this.grad4,x=(e+t+i+s)*l,D=Math.floor(e+x),E=Math.floor(t+x),M=Math.floor(i+x),z=Math.floor(s+x),C=(D+E+M+z)*a,P=e-(D-C),j=t-(E-C),L=i-(M-C),R=s-(z-C),A=0,N=0,k=0,G=0;P>j?A++:N++,P>L?A++:k++,P>R?A++:G++,j>L?N++:k++,j>R?N++:G++,L>R?k++:G++;var H=P-(u=A>=3?1:0)+a,I=j-(d=N>=3?1:0)+a,U=L-(p=k>=3?1:0)+a,q=R-(m=G>=3?1:0)+a,V=P-(g=A>=2?1:0)+2*a,Y=j-(v=N>=2?1:0)+2*a,B=L-(f=k>=2?1:0)+2*a,Z=R-(b=G>=2?1:0)+2*a,F=P-(_=A>=1?1:0)+3*a,W=j-(T=N>=1?1:0)+3*a,X=L-(w=k>=1?1:0)+3*a,K=R-(S=G>=1?1:0)+3*a,Q=P-1+4*a,J=j-1+4*a,$=L-1+4*a,ee=R-1+4*a,te=255&D,ie=255&E,se=255&M,re=255&z,ne=.6-P*P-j*j-L*L-R*R;if(ne<0)r=0;else{var oe=y[te+y[ie+y[se+y[re]]]]%32*4;r=(ne*=ne)*ne*(O[oe]*P+O[oe+1]*j+O[oe+2]*L+O[oe+3]*R)}var le=.6-H*H-I*I-U*U-q*q;if(le<0)n=0;else{var ae=y[te+u+y[ie+d+y[se+p+y[re+m]]]]%32*4;n=(le*=le)*le*(O[ae]*H+O[ae+1]*I+O[ae+2]*U+O[ae+3]*q)}var he=.6-V*V-Y*Y-B*B-Z*Z;if(he<0)o=0;else{var ce=y[te+g+y[ie+v+y[se+f+y[re+b]]]]%32*4;o=(he*=he)*he*(O[ce]*V+O[ce+1]*Y+O[ce+2]*B+O[ce+3]*Z)}var ue=.6-F*F-W*W-X*X-K*K;if(ue<0)h=0;else{var de=y[te+_+y[ie+T+y[se+w+y[re+S]]]]%32*4;h=(ue*=ue)*ue*(O[de]*F+O[de+1]*W+O[de+2]*X+O[de+3]*K)}var pe=.6-Q*Q-J*J-$*$-ee*ee;if(pe<0)c=0;else{var me=y[te+1+y[ie+1+y[se+1+y[re+1]]]]%32*4;c=(pe*=pe)*pe*(O[me]*Q+O[me+1]*J+O[me+2]*$+O[me+3]*ee)}return 27*(r+n+o+h+c)}},h._buildPermutationTable=c,void 0===(s=function(){return h}.call(t,i,t,e))||(e.exports=s),t.SimplexNoise=h,e.exports=h}()},function(e,t,i){var s=i(0);s.OrbitControls=function(e,t){var i,r,n,o,l;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new s.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:s.MOUSE.ROTATE,MIDDLE:s.MOUSE.DOLLY,RIGHT:s.MOUSE.PAN},this.touches={ONE:s.TOUCH.ROTATE,TWO:s.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(h),a.update(),p=d.NONE},this.update=(i=new s.Vector3,r=(new s.Quaternion).setFromUnitVectors(e.up,new s.Vector3(0,1,0)),n=r.clone().inverse(),o=new s.Vector3,l=new s.Quaternion,function(){var e=a.object.position;return i.copy(e).sub(a.target),i.applyQuaternion(r),g.setFromVector3(i),a.autoRotate&&p===d.NONE&&C(2*Math.PI/60/60*a.autoRotateSpeed),a.enableDamping?(g.theta+=v.theta*a.dampingFactor,g.phi+=v.phi*a.dampingFactor):(g.theta+=v.theta,g.phi+=v.phi),g.theta=Math.max(a.minAzimuthAngle,Math.min(a.maxAzimuthAngle,g.theta)),g.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=f,g.radius=Math.max(a.minDistance,Math.min(a.maxDistance,g.radius)),!0===a.enableDamping?a.target.addScaledVector(b,a.dampingFactor):a.target.add(b),i.setFromSpherical(g),i.applyQuaternion(n),e.copy(a.target).add(i),a.object.lookAt(a.target),!0===a.enableDamping?(v.theta*=1-a.dampingFactor,v.phi*=1-a.dampingFactor,b.multiplyScalar(1-a.dampingFactor)):(v.set(0,0,0),b.set(0,0,0)),f=1,!!(_||o.distanceToSquared(a.object.position)>m||8*(1-l.dot(a.object.quaternion))>m)&&(a.dispatchEvent(h),o.copy(a.object.position),l.copy(a.object.quaternion),_=!1,!0)}),this.dispose=function(){a.domElement.removeEventListener("contextmenu",ee,!1),a.domElement.removeEventListener("mousedown",Z,!1),a.domElement.removeEventListener("wheel",X,!1),a.domElement.removeEventListener("touchstart",Q,!1),a.domElement.removeEventListener("touchend",$,!1),a.domElement.removeEventListener("touchmove",J,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",W,!1),window.removeEventListener("keydown",K,!1)};var a=this,h={type:"change"},c={type:"start"},u={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,m=1e-6,g=new s.Spherical,v=new s.Spherical,f=1,b=new s.Vector3,_=!1,T=new s.Vector2,w=new s.Vector2,S=new s.Vector2,y=new s.Vector2,O=new s.Vector2,x=new s.Vector2,D=new s.Vector2,E=new s.Vector2,M=new s.Vector2;function z(){return Math.pow(.95,a.zoomSpeed)}function C(e){v.theta-=e}function P(e){v.phi-=e}var j,L=(j=new s.Vector3,function(e,t){j.setFromMatrixColumn(t,0),j.multiplyScalar(-e),b.add(j)}),R=function(){var e=new s.Vector3;return function(t,i){!0===a.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),b.add(e)}}(),A=function(){var e=new s.Vector3;return function(t,i){var s=a.domElement===document?a.domElement.body:a.domElement;if(a.object.isPerspectiveCamera){var r=a.object.position;e.copy(r).sub(a.target);var n=e.length();n*=Math.tan(a.object.fov/2*Math.PI/180),L(2*t*n/s.clientHeight,a.object.matrix),R(2*i*n/s.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(L(t*(a.object.right-a.object.left)/a.object.zoom/s.clientWidth,a.object.matrix),R(i*(a.object.top-a.object.bottom)/a.object.zoom/s.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function N(e){a.object.isPerspectiveCamera?f/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function k(e){a.object.isPerspectiveCamera?f*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function G(e){T.set(e.clientX,e.clientY)}function H(e){y.set(e.clientX,e.clientY)}function I(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,i)}}function U(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,i)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+i*i);D.set(0,s)}function V(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,i)}S.subVectors(w,T).multiplyScalar(a.rotateSpeed);var s=a.domElement===document?a.domElement.body:a.domElement;C(2*Math.PI*S.x/s.clientHeight),P(2*Math.PI*S.y/s.clientHeight),T.copy(w)}function Y(e){if(1==e.touches.length)O.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);O.set(t,i)}x.subVectors(O,y).multiplyScalar(a.panSpeed),A(x.x,x.y),y.copy(O)}function B(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+i*i);E.set(0,s),M.set(0,Math.pow(E.y/D.y,a.zoomSpeed)),N(M.y),D.copy(E)}function Z(e){if(!1!==a.enabled){switch(e.preventDefault(),a.domElement.focus?a.domElement.focus():window.focus(),e.button){case 0:switch(a.mouseButtons.LEFT){case s.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;H(e),p=d.PAN}else{if(!1===a.enableRotate)return;G(e),p=d.ROTATE}break;case s.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;G(e),p=d.ROTATE}else{if(!1===a.enablePan)return;H(e),p=d.PAN}break;default:p=d.NONE}break;case 1:switch(a.mouseButtons.MIDDLE){case s.MOUSE.DOLLY:if(!1===a.enableZoom)return;!function(e){D.set(e.clientX,e.clientY)}(e),p=d.DOLLY;break;default:p=d.NONE}break;case 2:switch(a.mouseButtons.RIGHT){case s.MOUSE.ROTATE:if(!1===a.enableRotate)return;G(e),p=d.ROTATE;break;case s.MOUSE.PAN:if(!1===a.enablePan)return;H(e),p=d.PAN;break;default:p=d.NONE}}p!==d.NONE&&(document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",W,!1),a.dispatchEvent(c))}}function F(e){if(!1!==a.enabled)switch(e.preventDefault(),p){case d.ROTATE:if(!1===a.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),S.subVectors(w,T).multiplyScalar(a.rotateSpeed);var t=a.domElement===document?a.domElement.body:a.domElement;C(2*Math.PI*S.x/t.clientHeight),P(2*Math.PI*S.y/t.clientHeight),T.copy(w),a.update()}(e);break;case d.DOLLY:if(!1===a.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),M.subVectors(E,D),M.y>0?N(z()):M.y<0&&k(z()),D.copy(E),a.update()}(e);break;case d.PAN:if(!1===a.enablePan)return;!function(e){O.set(e.clientX,e.clientY),x.subVectors(O,y).multiplyScalar(a.panSpeed),A(x.x,x.y),y.copy(O),a.update()}(e)}}function W(e){!1!==a.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",W,!1),a.dispatchEvent(u),p=d.NONE)}function X(e){!1===a.enabled||!1===a.enableZoom||p!==d.NONE&&p!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),a.dispatchEvent(c),function(e){e.deltaY<0?k(z()):e.deltaY>0&&N(z()),a.update()}(e),a.dispatchEvent(u))}function K(e){!1!==a.enabled&&!1!==a.enableKeys&&!1!==a.enablePan&&function(e){var t=!1;switch(e.keyCode){case a.keys.UP:A(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:A(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:A(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:A(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}(e)}function Q(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(a.touches.ONE){case s.TOUCH.ROTATE:if(!1===a.enableRotate)return;I(e),p=d.TOUCH_ROTATE;break;case s.TOUCH.PAN:if(!1===a.enablePan)return;U(e),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(a.touches.TWO){case s.TOUCH.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&q(e),a.enablePan&&U(e)}(e),p=d.TOUCH_DOLLY_PAN;break;case s.TOUCH.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&q(e),a.enableRotate&&I(e)}(e),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}p!==d.NONE&&a.dispatchEvent(c)}}function J(e){if(!1!==a.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===a.enableRotate)return;V(e),a.update();break;case d.TOUCH_PAN:if(!1===a.enablePan)return;Y(e),a.update();break;case d.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&B(e),a.enablePan&&Y(e)}(e),a.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&B(e),a.enableRotate&&V(e)}(e),a.update();break;default:p=d.NONE}}function $(e){!1!==a.enabled&&(a.dispatchEvent(u),p=d.NONE)}function ee(e){!1!==a.enabled&&e.preventDefault()}a.domElement.addEventListener("contextmenu",ee,!1),a.domElement.addEventListener("mousedown",Z,!1),a.domElement.addEventListener("wheel",X,!1),a.domElement.addEventListener("touchstart",Q,!1),a.domElement.addEventListener("touchend",$,!1),a.domElement.addEventListener("touchmove",J,!1),window.addEventListener("keydown",K,!1),this.update()},s.OrbitControls.prototype=Object.create(s.EventDispatcher.prototype),s.OrbitControls.prototype.constructor=s.OrbitControls,s.MapControls=function(e,t){s.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=s.MOUSE.PAN,this.mouseButtons.RIGHT=s.MOUSE.ROTATE,this.touches.ONE=s.TOUCH.PAN,this.touches.TWO=s.TOUCH.DOLLY_ROTATE},s.MapControls.prototype=Object.create(s.EventDispatcher.prototype),s.MapControls.prototype.constructor=s.MapControls,e.exports=t.default=s.OrbitControls},function(e,t,i){"use strict";i.r(t);var s=i(0);class r{constructor(e){e=e||{},this.type=O.HEX,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,i=[];for(t=0;t<6;t++)i.push(this._createVertex(t));for(this.cellShape=new s.Shape,this.cellShape.moveTo(i[0].x,i[0].y),t=1;t<6;t++)this.cellShape.lineTo(i[t].x,i[t].y);this.cellShape.lineTo(i[0].x,i[0].y),this.cellShape.autoClose=!0,this.cellGeo=new s.BufferGeometry,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new s.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*O.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new O.Cell(1,-1,0),new O.Cell(1,0,-1),new O.Cell(0,1,-1),new O.Cell(-1,1,0),new O.Cell(-1,0,1),new O.Cell(0,-1,1)],this._diagonals=[new O.Cell(2,-1,-1),new O.Cell(1,1,-2),new O.Cell(-1,2,-1),new O.Cell(-2,1,1),new O.Cell(-1,-1,2),new O.Cell(1,-2,1)],this._list=[],this._vec3=new s.Vector3,this._cel=new O.Cell,this._conversionVec=new s.Vector3,this._geoCache=[],this._matCache=[]}cellToPixel(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3}pixelToCell(e){var t=e.x*(r.TWO_THIRDS/this.cellSize),i=(-e.x/3+O.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel)}getCellAt(e){var t=e.x*(r.TWO_THIRDS/this.cellSize),i=(-e.x/3+O.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]}getNeighbors(e,t,i){var s,r,n=this._directions.length;for(this._list.length=0,s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._directions[s]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._diagonals[s]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list}getRandomCell(){var e,t=0,i=O.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}cellToHash(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s}distance(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s));return i+=t.h-e.h}clearPath(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1}traverse(e){var t;for(t in this.cells)e(this.cells[t])}generateTile(e,t,i){var r=Math.abs(e.h);r<1&&(r=1);var n=this._geoCache[r];n||(this.extrudeSettings.amount=r,n=new s.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=n);var o=new O.Tile({size:this.cellSize,scale:t,cell:e,geometry:n,material:i});return e.tile=o,o}generateTiles(e){e=e||{};var t,i,s,r=[],n={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:10,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in n=O.Tools.merge(n,e),this.cellSize=n.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*O.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=n.extrudeSettings,this.cells)s=this.cells[t],(i=this.generateTile(s,n.tileScale,n.material)).position.copy(this.cellToPixel(s)),i.position.y=0,r.push(i);return r}generate(e){var t,i,s,r;for(e=e||{},this.size=void 0===e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)s=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(s)<=this.size&&(console.log(t+","+i+","+s),r=new O.Cell(t,i,s),this.add(r))}generateOverlay(e,t,i){var r,n,o,l=this.cellShape.createPointsGeometry();for(r=-e;r<e+1;r++)for(n=-e;n<e+1;n++)if(o=-r-n,Math.abs(r)<=e&&Math.abs(n)<=e&&Math.abs(o)<=e){this._cel.set(r,n,o);var a=new s.Line(l,i);a.position.copy(this.cellToPixel(this._cel)),a.rotation.x=90*O.DEG_TO_RAD,t.add(a)}t.position.y=.5}add(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}remove(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}dispose(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null}load(e,t,i){var s=this;O.Tools.getJSON({url:e,callback:function(e){s.fromJSON(e),t.call(i||null,e)},cache:!1,scope:s})}fromJSON(e){var t,i,s=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*O.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<s.length;t++)(i=new O.Cell).copy(s[t]),this.add(i)}toJSON(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},s=[];for(t in this.cells)e=this.cells[t],s.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=s,i}_createVertex(e){var t=O.TAU/6*e;return new s.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)}_cubeRound(e){var t=Math.round(e.q),i=Math.round(e.r),s=Math.round(e.s),r=Math.abs(t-e.q),n=Math.abs(i-e.r),o=Math.abs(s-e.s);return r>n&&r>o?t=-i-s:n>o?i=-t-s:s=-t-i,this._cel.set(t,i,s)}}r.TWO_THIRDS=2/3;class n{constructor(){this.obj=null,this.next=null,this.prev=null,this.free=!0}}class o{constructor(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}static generateID(e){return Math.random().toString(36).slice(2)+Date.now()}getNode(e){return this.objToNodeMap[e.uniqueID]}addNode(e){var t=new n;if(!e.uniqueID)try{e.uniqueID=o.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return t.obj=e,t.free=!1,this.objToNodeMap[e.uniqueID]=t,t}swapObjects(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t}add(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")}has(e){return!!this.objToNodeMap[e.uniqueID]}moveUp(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prev){var i=t.prev,s=i.prev;t==this.last&&(this.last=i);var r=t.next;s&&(s.next=t),t.next=i,t.prev=i.prev,i.next=r,i.prev=t,this.first==i&&(this.first=t)}}moveDown(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}}sort(e){var t,i,s=this.sortArray,r=this.first;for(s.length=0;r;)s.push(r.obj),r=r.next;for(this.clear(),s.sort(e),i=s.length,t=0;t<i;t++)this.add(s[t])}remove(e){var t=this.getNode(e);return!(!t||t.free)&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,!0)}shift(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}pop(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}concat(e){for(var t=e.first;t;)this.add(t.obj),t=t.next}clear(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0}dispose(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null}dump(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}class l{constructor(e,t,i,s,r){this._listener=t,this.isOnce=i,this.context=s,this.signal=e,this._priority=r||0}execute(e){var t,i;return l.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this.isOnce&&this.detach()),t}detach(){return this.isBound()?this.signal.remove(this._listener,this.context):null}isBound(){return!!this.signal&&!!this._listener}_destroy(){delete this.signal,delete this._listener,delete this.context}toString(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+l.active+"]"}}l.active=!0,l.params=null;
/**
    * @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
    * @author       Richard Davey <rich@photonstorm.com>
    * @copyright    2014 Photon Storm Ltd.
    * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
    */
class a{constructor(){this._bindings=[],this._prevParams=null}validateListener(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a.".replace("{fn}",t))}_registerListener(e,t,i,s){var r,n=this._indexOfListener(e,i);if(-1!==n){if((r=this._bindings[n]).isOnce!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else r=new l(this,e,t,i,s),this._addBinding(r);return a.memorize&&this._prevParams&&r.execute(this._prevParams),r}_addBinding(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)}_indexOfListener(e,t){for(var i,s=this._bindings.length;s--;)if((i=this._bindings[s])._listener===e&&i.context===t)return s;return-1}has(e,t){return-1!==this._indexOfListener(e,t)}add(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)}addOnce(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)}remove(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e}removeAll(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)}getNumListeners(){return this._bindings.length}halt(){a._shouldPropagate=!1}dispatch(){if(a.active){var e,t=Array.prototype.slice.call(arguments),i=this._bindings.length;if(a.memorize&&(this._prevParams=t),i){e=this._bindings.slice(),a._shouldPropagate=!0;do{i--}while(e[i]&&a._shouldPropagate&&!1!==e[i].execute(t))}}}forget(){this._prevParams=null}dispose(){this.removeAll(),delete this._bindings,delete this._prevParams}toString(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}a.memorize=!1,a._shouldPropagate=!0,a.active=!0;var h={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new s.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new s.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,r){var n=new s.Texture(null,t);return this.imageLoader.load(e,(function(e){n.image=e,n.needsUpdate=!0,i&&i(n)}),null,(function(e){r&&r(e)})),n.sourceFile=e,n}};class c{constructor(e,t,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new s.Vector3,this.screenPosition=new s.Vector2,this.signal=new O.Signal,this.group=e,this._camera=t,this._raycaster=new s.Raycaster,this._preventDefault=!1,(i=i||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)}update(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch("over",this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}}preventDefault(){this._preventDefault=!0}_onDocumentMouseDown(e){if((e=e||window.event).preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,this.signal.dispatch("down",this.pickedObject)}_onDocumentMouseUp(e){if(e.preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch("up",this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch("click",this.pickedObject),this.down=1!==e.which&&this.down,this.rightDown=3!==e.which&&this.rightDown}_onDocumentMouseMove(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1}_onMouseWheel(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch("wheel",this.wheel)}}}c.OVER="over",c.OUT="out",c.DOWN="down",c.UP="up",c.CLICK="click",c.WHEEL="wheel";var u=c,d=i(3),p=i.n(d);var m=i(1),g=i.n(m),v=i(2),f=i.n(v),b=g.a.create(1e6),_=g.a.create("hello"),T=new f.a(b.nextDouble.bind(b)),w=new f.a(_.nextDouble.bind(_));var S={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},noise1:function(e,t){return T.noise2D(e,t)/2+.5},noise2:function(e,t){return w.noise2D(e,t)/2+.5},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!=typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var i=this,s=Array.isArray(t),r=s&&[]||{};return s?(e=e||[],r=r.concat(e),t.forEach((function(t,s){void 0===r[s]?r[s]=t:i.isPlainObject(t)?r[s]=i.merge(e[s],t):-1===e.indexOf(t)&&r.push(t)})),r):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){r[t]=e[t]})),Object.keys(t).forEach((function(s){t[s]&&i.isPlainObject(t[s])&&e[s]?r[s]=i.merge(e[s],t[s]):r[s]=t[s]})),r)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,s){if(s=s||31,!((t=t||0)>=(i=i||e.length)-1||s<0)){for(var r=t,n=i,o=1<<s;r<n;)if(e[r]&o){--n;var l=e[r];e[r]=e[n],e[n]=l}else++r;this.radixSort(e,t,n,s-1),this.radixSort(e,n,i,s-1)}},randomizeRGB:function(e,t){var i,s,r=e.split(","),n="rgb(",o=[];for(t=this.randomInt(t),i=0;i<3;i++)(s=parseInt(r[i])+t)<0?s=0:s>255&&(s=255),n+=s+",",o.push(s);return n=n.substring(0,n.length-1),n+=")"},getJSON:function(e){var t=new XMLHttpRequest,i=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}};i.d(t,"TM",(function(){return y}));const y={VERSION:"1.0.0",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),Cell:class{constructor(e,t,i,s){this.q=e||0,this.r=t||0,this.s=i||0,this.h=s||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=O.LinkedList.generateID()}set(e,t,i){return this.q=e,this.r=t,this.s=i,this}copy(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this}add(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this}equals(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},HexGrid:r,SqrGrid:class{constructor(e){e=e||{},this.type=O.SQR,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new s.Vector3),t.push(new s.Vector3(-this.cellSize,this.cellSize)),t.push(new s.Vector3(this.cellSize,this.cellSize)),t.push(new s.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new s.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new s.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new s.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new O.Cell(1,0,0),new O.Cell(0,-1,0),new O.Cell(-1,0,0),new O.Cell(0,1,0)],this._diagonals=[new O.Cell(-1,-1,0),new O.Cell(-1,1,0),new O.Cell(1,1,0),new O.Cell(1,-1,0)],this._list=[],this._vec3=new s.Vector3,this._cel=new O.Cell,this._conversionVec=new s.Vector3,this._geoCache=[],this._matCache=[]}cellToPixel(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3}pixelToCell(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)}getCellAt(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i),this.cells[this.cellToHash(this._cel)]}getNeighbors(e,t,i){var s,r,n=this._directions.length;for(this._list.length=0,s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._directions[s]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._diagonals[s]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list}getRandomCell(){var e,t=0,i=O.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}cellToHash(e){return e.q+this._hashDelimeter+e.r}distance(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r));return i+=t.h-e.h}clearPath(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1}traverse(e){var t;for(t in this.cells)e(this.cells[t])}generateTile(e,t,i){var r=Math.abs(e.h);r<1&&(r=1);var n=this._geoCache[r];n||(this.extrudeSettings.amount=r,n=new s.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=n);var o=new O.Tile({size:this.cellSize,scale:t,cell:e,geometry:n,material:i});return e.tile=o,o}generateTiles(e){e=e||{};var t,i,s,r=[],n={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in n=O.Tools.merge(n,e),this.cellSize=n.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=n.extrudeSettings,this.cells)s=this.cells[t],(i=this.generateTile(s,n.tileScale,n.material)).position.copy(this.cellToPixel(s)),i.position.y=0,r.push(i);return r}generate(e){var t,i,s;e=e||{},this.size=void 0===e.size?this.size:e.size;var r=Math.ceil(this.size/2);for(t=-r;t<r;t++)for(i=-r;i<r;i++)s=new O.Cell(t,i+1),this.add(s)}generateOverlay(e,t,i){var r,n,o=Math.ceil(e/2);for(r=-o;r<o;r++)for(n=-o;n<o;n++){this._cel.set(r,n);var l=new s.Line(this.cellGeo,i);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*O.DEG_TO_RAD,t.add(l)}}add(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}remove(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}dispose(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null}load(e,t,i){O.Tools.getJSON({url:e,callback(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})}fromJSON(e){var t,i,s=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<s.length;t++)(i=new O.Cell).copy(s[t]),this.add(i)}toJSON(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},s=[];for(t in this.cells)e=this.cells[t],s.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=s,i}},Tile:class{constructor(e){e=e||{};var t={cell:null,geometry:null,material:null};if(!(t=O.Tools.merge(t,e)).cell||!t.geometry)throw new Error("Missing TM.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=O.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new s.MeshPhongMaterial({color:O.Tools.randomizeRGB("0, 105, 148",13)})),this.objectType=O.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new s.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*O.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null}select(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,console.log(this.userData.terrain),console.log(this.userData.elevation),console.log(this.position),this}deselect(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this}toggle(){return this.selected?this.deselect():this.select(),this}dispose(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}setTerrain(e,t){if(this.userData.elevation=e,this.userData.moisture=t,e<.1)this.userData.terrain="OCEAN";else{if(e<.12)return this.userData.terrain="BEACH",void this.material.color.set(O.Tools.randomizeRGB("212,192,155",13));if(e>.8)return t<.1?(this.userData.terrain="SCORCHED",void this.material.color.set(O.Tools.randomizeRGB("171,95,58",13))):t<.2?(this.userData.terrain="BARE",void this.material.color.set(O.Tools.randomizeRGB("215,171,114",13))):t<.5?(this.userData.terrain="TUNDRA",void this.material.color.set(O.Tools.randomizeRGB("152,171,180",13))):(this.userData.terrain="SNOW",void this.material.color.set(O.Tools.randomizeRGB("223,217,221",13)));if(e>.6)return t<.33?(this.userData.terrain="TEMPERATE_DESERT",void this.material.color.set(O.Tools.randomizeRGB("200,184,158",13))):t<.66?(this.userData.terrain="SHRUBLAND",void this.material.color.set(O.Tools.randomizeRGB("125,124,62",13))):(this.userData.terrain="TAIGA",void this.material.color.set(O.Tools.randomizeRGB("16,86,76",13)));if(e>.3)return t<.16?(this.userData.terrain="TEMPERATE_DESERT",void this.material.color.set(O.Tools.randomizeRGB("200,184,158",13))):t<.5?(this.userData.terrain="GRASSLAND",void this.material.color.set(O.Tools.randomizeRGB("147,217,69",13))):(this.userData.terrain="FOREST",void this.material.color.set(O.Tools.randomizeRGB("16,59,35",13)));if(t<.16)return this.userData.terrain="SUBTROPICAL_DESERT",void this.material.color.set(O.Tools.randomizeRGB("152,79,15",13));if(t<.33)return this.userData.terrain="GRASSLAND",void this.material.color.set(O.Tools.randomizeRGB("147,217,69",13));this.userData.terrain="TROPICAL_RAIN_FOREST",this.material.color.set(O.Tools.randomizeRGB("79,159,27",13))}}},LinkedList:o,Signal:a,AStarFinder:class{constructor(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=O.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new O.LinkedList}findPath(e,t,i,s){var r,n,o,l,a,h;for(i=i||this.heuristicFilter,s.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(r=this.list.shift())._visited=!0,r===t)return O.PathUtil.backtrace(t);for(a=0,h=(o=s.getNeighbors(r,this.allowDiagonal,i)).length;a<h;a++)if((l=o[a]).walkable&&(n=r._calcCost+s.distance(r,l),!l._visited||n<l._calcCost)){if(l._visited=!0,l._parent=r,l._calcCost=n,l._priority=n+s.distance(t,l),l===t)return O.PathUtil.backtrace(t);this.list.add(l)}}return null}compare(e,t){return e._priority-t._priority}},PathUtil:class{backtrace(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()}biBacktrace(e,t){var i=this.backtrace(e),s=this.backtrace(t);return i.concat(s.reverse())}pathLength(e){var t,i,s,r,n,o=0;for(t=1;t<e.length;++t)i=e[t-1],s=e[t],r=i[0]-s[0],n=i[1]-s[1],o+=Math.sqrt(r*r+n*n);return o}interpolate(e,t,i,s){var r,n,o,l,a,h,c=Math.abs,u=[];for(r=e<i?1:-1,n=t<s?1:-1,a=(o=c(i-e))-(l=c(s-t));e!==i||t!==s;)u.push([e,t]),(h=2*a)>-l&&(a-=l,e+=r),h<o&&(a+=o,t+=n);return u}expandPath(e){var t,i,s,r,n,o,l=[],a=e.length;if(a<2)return l;for(n=0;n<a-1;++n)for(t=e[n],i=e[n+1],r=(s=this.interpolate(t[0],t[1],i[0],i[1])).length,o=0;o<r-1;++o)l.push(s[o]);return l.push(e[a-1]),l}smoothenPath(e,t){var i,s,r,n,o,l,a,h,c,u,d,p,m=t.length,g=t[0][0],v=t[0][1],f=t[m-1][0],b=t[m-1][1];for(o=[[i=g,s=v]],a=2;a<m;++a){for(r=(c=t[a])[0],n=c[1],u=this.interpolate(i,s,r,n),p=!1,h=1;h<u.length;++h)if(d=u[h],!e.isWalkableAt(d[0],d[1])){p=!0;break}p&&(l=t[a-1],o.push(l),i=l[0],s=l[1])}return o.push([f,b]),o}compressPath(e){if(e.length<3)return e;var t,i,s,r,n,o,l=[],a=e[0][0],h=e[0][1],c=e[1][0],u=e[1][1],d=c-a,p=u-h;for(d/=n=Math.sqrt(d*d+p*p),p/=n,l.push([a,h]),o=2;o<e.length;o++)t=c,i=u,s=d,r=p,d=(c=e[o][0])-t,p=(u=e[o][1])-i,p/=n=Math.sqrt(d*d+p*p),(d/=n)===s&&p===r||l.push([t,i]);return l.push([c,u]),l}},Loader:h,MouseCaster:u,Scene:class{constructor(e,t){var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new s.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},r={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(i=O.Tools.merge(i,e),"boolean"!=typeof t&&(r=O.Tools.merge(r,t)),this.renderer=new s.WebGLRenderer({alpha:i.alpha,antialias:i.antialias}),this.renderer.setClearColor(i.clearColor,0),this.renderer.sortObjects=i.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=i.orthoZoom,this.container=new s.Scene,this.container.fog=i.fog,this.container.add(new s.AmbientLight(14540253)),i.lightPosition||i.light.position.set(-1,1,-1).normalize(),this.container.add(i.light),"OrthographicCamera"===i.cameraType){var n=window.innerWidth/this.orthoZoom,o=window.innerHeight/this.orthoZoom;this.camera=new s.OrthographicCamera(n/-2,n/2,o/2,o/-2,1,5e3)}else this.camera=new s.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new p.a(this.camera,this.renderer.domElement),this.controls.minDistance=r.minDistance,this.controls.maxDistance=r.maxDistance,this.controls.zoomSpeed=r.zoomSpeed,this.controls.noZoom=r.noZoom),i.cameraPosition&&this.camera.position.copy(i.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(i.element)}attachTo(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)}add(e){this.container.add(e)}remove(e){this.container.remove(e)}render(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)}updateOrthoZoom(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}}focusOn(e){this.camera.lookAt(e.position)}},SelectionManager:class{constructor(e){this.mouse=e,this.onSelect=new O.Signal,this.onDeselect=new O.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)}select(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))}clearSelection(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null}onMouse(e,t){switch(e){case O.MouseCaster.DOWN:t||this.clearSelection();break;case O.MouseCaster.CLICK:this.select(t)}}},Tools:S,Board:class{constructor(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new s.Object3D,this.grid=null,this.overlay=null,this.finder=new O.AStarFinder(t),O.Loader.init(),this.setGrid(e)}setEntityOnTile(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e}addTile(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)}removeTile(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}}removeAllTiles(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])}getTileAtCell(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)}snapToGrid(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))}snapTileToGrid(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e}getRandomTile(){var e=O.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]}findPath(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)}setGrid(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach((function(e){this.grid.remove(e.cell),e.dispose()})),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new s.Object3D,this.group.add(this.tileGroup)}generateOverlay(e){var t=new s.LineBasicMaterial({color:0,opacity:.9});this.overlay&&this.group.remove(this.overlay),this.overlay=new s.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)}generateTilemap(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new s.Object3D;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)}generateTerrain(){if(this.grid.type===O.HEX){var e,t,i,s=this.grid.size;let a=0;for(e=-s;e<s+1;e++)for(t=-s;t<s+1;t++)if(i=-e-t,Math.abs(e)<=s&&Math.abs(t)<=s&&Math.abs(i)<=s){var r=e/this.grid._cellWidth-.5,n=i/this.grid._cellLength-.5,o=1*O.Tools.noise1(1*r,1*n)+.5*O.Tools.noise1(2*r,2*n)+.25*O.Tools.noise1(4*r,4*n)+.13*O.Tools.noise1(8*r,8*n)+.06*O.Tools.noise1(16*r,16*n)+.03*O.Tools.noise1(32*r,32*n);o/=1.97,o=Math.pow(o,5);var l=1*O.Tools.noise2(1*r,1*n)+.75*O.Tools.noise2(2*r,2*n)+.33*O.Tools.noise2(4*r,4*n)+.33*O.Tools.noise2(8*r,8*n)+.33*O.Tools.noise2(16*r,16*n)+.5*O.Tools.noise2(32*r,32*n);l/=3.24,this.tiles[a].setTerrain(o,l),a++}}}reset(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};var O=t.default=y}]);
//# sourceMappingURL=index.js.map